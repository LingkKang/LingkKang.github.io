<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Paper Notes: FlipBit - Save Energy for Flash Memory Write with Approximation</title>
    <link href="/2024/11/01/read-paper-flipbit/"/>
    <url>/2024/11/01/read-paper-flipbit/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Paper-Notes-FlipBit-Save-Energy-for-Flash-Memory-Write-with-Approximation"><a href="#Paper-Notes-FlipBit-Save-Energy-for-Flash-Memory-Write-with-Approximation" class="headerlink" title="Paper Notes: FlipBit - Save Energy for Flash Memory Write with Approximation"></a>Paper Notes: FlipBit - Save Energy for Flash Memory Write with Approximation</h1><blockquote><p>Alexander Buck, Karthik Ganesan, and Natalie Enright Jerger. FlipBit: Approximate Flash Memory for IoT Devices. <em>IEEE International Symposium on High-Performance Computer Architecture (HPCA)</em>, 2024. <a href="https://doi.org/10.1109/HPCA57654.2024.00072">https://doi.org/10.1109/HPCA57654.2024.00072</a></p></blockquote><h2 id="1-Observation-and-Motivation"><a href="#1-Observation-and-Motivation" class="headerlink" title="1. Observation and Motivation"></a>1. Observation and Motivation</h2><ol><li>Flash memory write is the <em>energy and latency bottleneck</em> for IoT devices.</li><li>Specific inside flash writing, it presents a <em>write asymmetry</em> property. That is, when setting a bit from <code>0</code> to <code>1</code>, it charges the entire block to <code>1</code> firstly, and then drains the unnecessary <code>1</code>s to <code>0</code>. This is energy-consuming. As for the opposite operation, it is quick and energy-efficient.</li><li>Such writing method also contributes to flash memory <em>wear-out</em>.</li><li>The data processed and stored by flash in IoT devices is often noisy, providing a room for <em>approximate computing</em>.</li></ol>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-5a35d934" role="button" aria-expanded="false" aria-controls="collapse-5a35d934">        <div class="fold-arrow">â–¶</div>Side Note on Data Noisiness (Click here to unfold/fold)      </div>      <div class="fold-collapse collapse" id="collapse-5a35d934">        <div class="fold-content">          <p>For data collected by sensors, which is often the case in IoT devices, it is common to have inherent uncertainty or variability in data.</p><p>For example, GPS data may contain noise on speed measurements due to limited sensor precision or signal interference. This may lead to unrealistic speed values.</p><p>Approximate computing leverages this inborn noisiness, regarding is as an opportunity to save energy, provide tolerance and improve performance.</p>        </div>      </div>    </div><h2 id="2-FlipBit-Approximate-Flash-Memory-Write"><a href="#2-FlipBit-Approximate-Flash-Memory-Write" class="headerlink" title="2. FlipBit: Approximate Flash Memory Write"></a>2. FlipBit: Approximate Flash Memory Write</h2><p>Thus, the proposed method for energy-efficient flash memory write is to <em>approximate</em> the data to be written, named <strong>FlipBit</strong>:</p><ol><li>If the data written to block only requires <code>1</code> to <code>0</code> changes, it is written directly.</li><li>If the write contains <code>0</code> to <code>1</code> changes, the operation is approximated to the nearest <code>1</code>-to-<code>0</code>-only write, which can be done in a single step.</li><li>If the approximate rate exceeds a threshold, the block will perform a <em>precise write</em> to avoid data divergence.</li></ol><p>This method can save energy and reduce wear-out, while maintaining the general data integrity.</p><p>For example, for a 8-bit flash memory block, assume it is currently <code>11010100</code> (212 in base 10) and the data required to be written is <code>11001111</code> (207 in base 10). According to the <strong>FlipBit</strong> method, the write operation would be approximated to <code>11010000</code> (208 in base 10), which only contains <code>1</code>-to-<code>0</code> changes with error rate of (208 - 207) &#x2F; 207 &#x3D; 0.00483 &#x3D; 0.483%.</p><table><thead><tr><th align="left"><strong>Bit</strong></th><th align="center">7</th><th align="center">6</th><th align="center">5</th><th align="center">4</th><th align="center">3</th><th align="center">2</th><th align="center">1</th><th align="center">0</th><th align="center"># <code>0</code> -&gt; <code>1</code></th><th align="center"># <code>1</code> -&gt; <code>0</code></th><th align="center">Base 10</th></tr></thead><tbody><tr><td align="left"><strong>Original</strong></td><td align="center"><code>1</code></td><td align="center"><code>1</code></td><td align="center"><code>0</code></td><td align="center"><code>1</code></td><td align="center"><code>0</code></td><td align="center"><code>1</code></td><td align="center"><code>0</code></td><td align="center"><code>0</code></td><td align="center">\</td><td align="center">\</td><td align="center">212</td></tr><tr><td align="left"><strong>Exact</strong></td><td align="center"><code>1</code></td><td align="center"><code>1</code></td><td align="center"><code>0</code></td><td align="center"><code>0</code></td><td align="center"><code>1</code></td><td align="center"><code>1</code></td><td align="center"><code>1</code></td><td align="center"><code>1</code></td><td align="center">3</td><td align="center">1</td><td align="center">207</td></tr><tr><td align="left"><strong>Approx</strong></td><td align="center"><code>1</code></td><td align="center"><code>1</code></td><td align="center"><code>0</code></td><td align="center"><code>1</code></td><td align="center"><code>0</code></td><td align="center"><code>0</code></td><td align="center"><code>0</code></td><td align="center"><code>0</code></td><td align="center">0</td><td align="center">1</td><td align="center">208</td></tr></tbody></table><h2 id="3-Implementation-and-Realization"><a href="#3-Implementation-and-Realization" class="headerlink" title="3. Implementation and Realization"></a>3. Implementation and Realization</h2><h3 id="3-1-Exhaustive-Searching"><a href="#3-1-Exhaustive-Searching" class="headerlink" title="3.1. Exhaustive Searching"></a>3.1. Exhaustive Searching</h3><p>The intuitive algorithm (aka the baseline algorithm) for <strong>FlipBit</strong> is to iterate through the search domain and find the value that minimizes the error rate (i.e., the closest to exact value). The search domain is defined as, bits combinations that only keep all <code>0</code>s in the original bits, where other bits are allowed to flip. As the memory block size increases, the search domain grows exponentially, leading to high computational complexity and implementation difficulty.</p><h3 id="3-2-One-Bit-Approximation"><a href="#3-2-One-Bit-Approximation" class="headerlink" title="3.2. One-Bit Approximation"></a>3.2. One-Bit Approximation</h3><p>By iterating through the bits from the most significant bit (MSB), the one-bit approximation algorithm set that if a approx bit is flipped from <code>1</code> (expect) to <code>0</code> (approx output), the approx bits after it whose original corresponding bits are <code>1</code> will be set to <code>1</code>, as a compensation to the deduction. This implies that the approximated value is always no larger than the exact value.</p><ul><li><code>set_ones</code> initialized to <code>False</code></li><li>for i in range(block_size):<ul><li><code>original_bit</code> is the <code>i</code>-th bit of the original data</li><li><code>exact_bit</code> is the <code>i</code>-th bit of the exact data</li><li><code>approx_bit</code> is the <code>i</code>-th bit of the approximate data</li><li>if <code>original_bit</code> is <code>1</code><ul><li>if <code>exact_bit</code> is <code>1</code> or <code>set_ones</code> is <code>True</code><ul><li><code>approx_bit</code> is <code>1</code></li></ul></li><li>else:<ul><li><code>approx_bit</code> is <code>0</code></li></ul></li></ul></li><li>else if <code>exact_bit</code> is <code>1</code><ul><li><code>set_ones</code> set to <code>True</code></li><li><code>approx_bit</code> is <code>0</code></li></ul></li><li>else:<ul><li><code>approx_bit</code> is <code>0</code></li></ul></li></ul></li></ul><p>This algorithm is easier to implement but may not always provide the optimal solution.</p>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-c988bd12" role="button" aria-expanded="false" aria-controls="collapse-c988bd12">        <div class="fold-arrow">â–¶</div>Python implementation (Click here to unfold/fold)      </div>      <div class="fold-collapse collapse" id="collapse-c988bd12">        <div class="fold-content">          <p>A Python implementation might make the flow clearer:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">one_bit_approx</span>(<span class="hljs-params">origin: <span class="hljs-built_in">str</span>, exact: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    output = []<br>    set_ones = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">for</span> orig_bit, exact_bit <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(origin, exact):<br>        <span class="hljs-keyword">if</span> orig_bit == <span class="hljs-string">&quot;1&quot;</span>:<br>            <span class="hljs-keyword">if</span> exact_bit == <span class="hljs-string">&quot;1&quot;</span> <span class="hljs-keyword">or</span> set_ones:<br>                output.append(<span class="hljs-string">&quot;1&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                output.append(<span class="hljs-string">&quot;0&quot;</span>)<br>        <span class="hljs-keyword">elif</span> exact_bit == <span class="hljs-string">&quot;1&quot;</span>:<br>            set_ones = <span class="hljs-literal">True</span><br>            output.append(<span class="hljs-string">&quot;0&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            output.append(<span class="hljs-string">&quot;0&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(output)<br></code></pre></td></tr></table></figure>        </div>      </div>    </div><h3 id="3-3-N-Bit-Approximation"><a href="#3-3-N-Bit-Approximation" class="headerlink" title="3.3. N-Bit Approximation"></a>3.3. N-Bit Approximation</h3><p>As a combination of previous two algorithms, the N-bit approximation algorithm is designed to check <code>n</code> bits at once.</p><p>This relies on truth tables to determine the optimal approximation.</p><p>In the truth table, <code>x</code> represents a context-agnostic bit, <code>_</code> represents an undecided bit.</p><table><thead><tr><th align="center"><strong>Original</strong></th><th align="center"><strong>Exact</strong></th><th align="center"><strong>Approx</strong></th><th align="center"><strong>Changes from Exact to Approx</strong></th><th align="left"><strong>Remark</strong></th></tr></thead><tbody><tr><td align="center"><code>0x</code></td><td align="center"><code>xx</code></td><td align="center"><code>0_</code></td><td align="center">Smaller or equal</td><td align="left">As long as the original bit is <code>0</code>, the approx bit cannot be <code>1</code></td></tr><tr><td align="center"><code>1x</code></td><td align="center"><code>1x</code></td><td align="center"><code>1_</code></td><td align="center">Equal</td><td align="left">Just like one-bit approx, if the original bit and the exact bit are both <code>1</code>, the approx bit should be <code>1</code></td></tr><tr><td align="center"><code>10</code></td><td align="center"><code>00</code></td><td align="center"><code>0_</code></td><td align="center">Equal</td><td align="left">Itâ€™s easy to set <code>1</code> to <code>0</code></td></tr><tr><td align="center"><code>10</code></td><td align="center"><code>01</code></td><td align="center"><code>1_</code></td><td align="center">Larger</td><td align="left">Keep the <code>1</code> bit, as its difficult to get <code>1</code> back</td></tr><tr><td align="center"><code>11</code></td><td align="center"><code>00</code></td><td align="center"><code>0_</code></td><td align="center">Equal</td><td align="left">Itâ€™s easy to set <code>1</code> to <code>0</code></td></tr><tr><td align="center"><code>11</code></td><td align="center"><code>01</code></td><td align="center"><code>0_</code></td><td align="center">Equal</td><td align="left">Itâ€™s easy to set <code>1</code> to <code>0</code></td></tr></tbody></table><p>The algorithm is as follows:</p><ul><li><code>set_ones</code> initialized to <code>False</code></li><li><code>set_zeros</code> initialized to <code>False</code></li><li>for i in range(block size):<ul><li><code>original_bit</code> is the <code>i</code>-th bit of the original data</li><li><code>exact_bit</code> is the <code>i</code>-th bit of the exact data</li><li><code>approx_bit</code> is the <code>i</code>-th bit of the approximate data</li><li>if <code>set_zeros</code> is <code>False</code>:<ul><li>if <code>original_bit</code> is <code>1</code>:<ul><li>if <code>exact_bit</code> is <code>1</code> or <code>set_ones</code> is <code>True</code>:<ul><li><code>approx_bit</code> is <code>1</code></li></ul></li><li>else if ReadTruthTable(original_bits, exact_bits) is <code>1</code>:<ul><li><code>approx_bit</code> is <code>1</code></li><li><code>set_zeros</code> set to <code>True</code></li></ul></li><li>else:<ul><li><code>approx_bit</code> is <code>0</code></li></ul></li></ul></li><li>else if <code>exact_bit</code> is <code>1</code>:<ul><li><code>set_ones</code> set to <code>True</code></li><li><code>approx_bit</code> is <code>0</code></li></ul></li><li>else:<ul><li><code>approx_bit</code> is <code>0</code></li></ul></li></ul></li><li>else:<ul><li><code>approx_bit</code> is <code>0</code></li></ul></li></ul></li></ul><p>Basically if <code>0x</code> (original) and <code>1x</code> (exact) condition (a subset of <code>0x</code> and <code>1x</code>, i.e., the first row in the truth table) is triggered, which might make the approx smaller than the exact, the <code>set_ones</code> flag would be triggered to compensate the loss by feeding <code>1</code>s to approx.</p><p>Similarly for <code>10</code> (original) and <code>01</code> (exact) condition, the <code>set_zeros</code> flag would be triggered to provide <code>0</code>s to make the approx closer to the exact.</p>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-28ab9646" role="button" aria-expanded="false" aria-controls="collapse-28ab9646">        <div class="fold-arrow">â–¶</div>Python implementation (Click here to unfold/fold)      </div>      <div class="fold-collapse collapse" id="collapse-28ab9646">        <div class="fold-content">          <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">n_bit_approx</span>(<span class="hljs-params">origin: <span class="hljs-built_in">str</span>, exact: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    output = []<br>    set_ones = <span class="hljs-literal">False</span><br>    set_zeros = <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">for</span> orig_bit, exact_bit <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(origin, exact):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> set_zeros:<br>            <span class="hljs-keyword">if</span> orig_bit == <span class="hljs-string">&quot;1&quot;</span>:<br>                <span class="hljs-keyword">if</span> exact_bit == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> set_ones:<br>                    output.append(<span class="hljs-string">&quot;1&quot;</span>)<br>                <span class="hljs-keyword">elif</span> read_truth_table(exact, origin, i):<br>                    output.append(<span class="hljs-string">&quot;1&quot;</span>)<br>            <span class="hljs-keyword">elif</span> exact_bit == <span class="hljs-string">&quot;1&quot;</span>:<br>                set_ones = <span class="hljs-literal">True</span><br>                output.append(<span class="hljs-string">&quot;0&quot;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                output.append(<span class="hljs-string">&quot;0&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            output.append(<span class="hljs-string">&quot;0&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>.join(output)<br></code></pre></td></tr></table></figure>        </div>      </div>    </div><p>While the N-bit approximation is presented in iteration, it can be parallelized on hardware with repeated logic units, thus is <em>hardware-friendly</em>.</p><h2 id="4-Evaluation"><a href="#4-Evaluation" class="headerlink" title="4. Evaluation"></a>4. Evaluation</h2><p>FlipBit is evaluated under two common IoT devicesâ€™ use cases: 1) sense and send data, and 2) compute and send data, with video capturing and deep neural network (DNN) inference as the representative applications.</p>]]></content>
    
    
    <categories>
      
      <category>Paper Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Memory</tag>
      
      <tag>Flash</tag>
      
      <tag>Approximate Computing</tag>
      
      <tag>IoT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Self-Host Vikunja To-Do List Web App</title>
    <link href="/2024/10/19/host-vikunja/"/>
    <url>/2024/10/19/host-vikunja/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Self-Host-Vikunja-To-Do-List-Web-App"><a href="#Self-Host-Vikunja-To-Do-List-Web-App" class="headerlink" title="Self-Host Vikunja To-Do List Web App"></a>Self-Host Vikunja To-Do List Web App</h1><p><a href="https://vikunja.io/">Vikunja</a> is an open-source to-do list web app, which is developed with Go and Vue.</p><h2 id="0-Environment"><a href="#0-Environment" class="headerlink" title="0. Environment"></a>0. Environment</h2><table><thead><tr><th>Software</th><th>Version</th></tr></thead><tbody><tr><td>Ubuntu</td><td>24.04.1 LTS</td></tr><tr><td>OpenSSL</td><td>3.0.13</td></tr><tr><td>Snap</td><td>2.65</td></tr><tr><td>Nginx</td><td>1.24.0</td></tr><tr><td>Docker</td><td>27.3.1 (install later)</td></tr><tr><td>Certbot</td><td>2.11.0 (install later)</td></tr></tbody></table><h2 id="1-Install-Docker"><a href="#1-Install-Docker" class="headerlink" title="1. Install Docker"></a>1. Install Docker</h2><p>Please refer to the instructions in the <a href="https://lingkang.dev/2024/08/29/host-maybe/#1-Install-Docker">Self-Host Maybe Finance Web App - 1. Install Docker</a> section.</p><h2 id="2-Setup-Docker-Compose"><a href="#2-Setup-Docker-Compose" class="headerlink" title="2. Setup Docker Compose"></a>2. Setup Docker Compose</h2><p>Vikunja is available via many different methods. In this guide, we plan to use Docker Compose to manage the Vikunja service and its dependencies.</p><h3 id="2-1-Prepare-for-environment-variables"><a href="#2-1-Prepare-for-environment-variables" class="headerlink" title="2.1. Prepare for environment variables"></a>2.1. Prepare for environment variables</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">mkdir</span> -p ~/app/todolist<br><span class="hljs-built_in">cd</span> ~/app/todolist<br><span class="hljs-built_in">touch</span> .<span class="hljs-built_in">env</span><br>openssl rand -hex 64 &gt; .<span class="hljs-built_in">env</span><br></code></pre></td></tr></table></figure><p>The generated hexadecimal string will be used as the secret key of Vikunja service.</p><p>Update your <code>.env</code> file with the following content:</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs TXT">VIKUNJA_SERVICE_JWTSECRET=&quot;your_generated_very_long_hex_secret&quot;<br>VIKUNJA_DATABASE_PASSWORD=&quot;your_postgres_password&quot;<br></code></pre></td></tr></table></figure><h3 id="2-2-Configure-Docker-Compose-file"><a href="#2-2-Configure-Docker-Compose-file" class="headerlink" title="2.2. Configure Docker Compose file"></a>2.2. Configure Docker Compose file</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">cd</span> ~/app/todolist<br>sudo <span class="hljs-built_in">mkdir</span> -p /var/app/vikunja/app-data<br>sudo <span class="hljs-built_in">mkdir</span> -p /var/app/vikunja/postgres-data<br><br>sudo <span class="hljs-built_in">chown</span> -R 1000 /var/app/vikunja/app-data<br>sudo <span class="hljs-built_in">chown</span> -R 1000 /var/app/vikunja/postgres-data<br><br><span class="hljs-built_in">touch</span> compose.yml<br></code></pre></td></tr></table></figure><p>Update your <code>compose.yml</code> file with the following content:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs YAML"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">vikunja:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">vikunja/vikunja:latest</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">VIKUNJA_SERVICE_PUBLICURL:</span> <span class="hljs-string">&quot;Your_Public_IP_or_Domain&quot;</span><br>      <span class="hljs-attr">VIKUNJA_DATABASE_HOST:</span> <span class="hljs-string">db</span><br>      <span class="hljs-attr">VIKUNJA_DATABASE_PASSWORD:</span> <span class="hljs-string">$&#123;VIKUNJA_DATABASE_PASSWORD:?&#125;</span><br>      <span class="hljs-attr">VIKUNJA_DATABASE_TYPE:</span> <span class="hljs-string">postgres</span><br>      <span class="hljs-attr">VIKUNJA_DATABASE_USER:</span> <span class="hljs-string">vikunja</span><br>      <span class="hljs-attr">VIKUNJA_DATABASE_DATABASE:</span> <span class="hljs-string">vikunja</span><br>      <span class="hljs-attr">VIKUNJA_SERVICE_JWTSECRET:</span> <span class="hljs-string">$&#123;VIKUNJA_SERVICE_JWTSECRET:?&#125;</span><br>    <span class="hljs-attr">ports:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-number">3456</span><span class="hljs-string">:3456</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/app/vikunja/app-data:/app/vikunja/files</span><br>    <span class="hljs-attr">depends_on:</span><br>      <span class="hljs-attr">db:</span><br>        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br><br>  <span class="hljs-attr">db:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">postgres:16</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-attr">POSTGRES_PASSWORD:</span> <span class="hljs-string">$&#123;VIKUNJA_DATABASE_PASSWORD:?&#125;</span><br>      <span class="hljs-attr">POSTGRES_USER:</span> <span class="hljs-string">vikunja</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/app/vikunja/postgres-data:/var/lib/postgresql/data</span><br>    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span><br>    <span class="hljs-attr">healthcheck:</span><br>      <span class="hljs-attr">test:</span> [<span class="hljs-string">&quot;CMD-SHELL&quot;</span>, <span class="hljs-string">&quot;pg_isready -h localhost -U $$POSTGRES_USER&quot;</span>]<br>      <span class="hljs-attr">interval:</span> <span class="hljs-string">30s</span><br>      <span class="hljs-attr">timeout:</span> <span class="hljs-string">5s</span><br>      <span class="hljs-attr">retries:</span> <span class="hljs-number">3</span><br>      <span class="hljs-attr">start_period:</span> <span class="hljs-string">60s</span><br></code></pre></td></tr></table></figure><h3 id="2-3-Start-the-Services"><a href="#2-3-Start-the-Services" class="headerlink" title="2.3. Start the Services"></a>2.3. Start the Services</h3><p>Start the services in the background:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo docker compose up -d<br></code></pre></td></tr></table></figure><p>Now the app is available at <code>http://localhost:3456</code> or <code>&lt;your_pub_ip&gt;:3456</code>. (Donâ€™t forget to open the port of the server in the firewall.)</p><p><img src="/./images/one_time/vikunja.png" alt="Successfully Hosted! ðŸŽ‰"></p><h2 id="3-Setup-SSL-Certificates"><a href="#3-Setup-SSL-Certificates" class="headerlink" title="3. Setup SSL Certificates"></a>3. Setup SSL Certificates</h2><p>This part is same as the <a href="https://lingkang.dev/2024/08/29/host-maybe/#3-Setup-SSL-Certificates">Self-Host Maybe Finance Web App - 3. Setup SSL Certificates</a> section.</p><h2 id="4-Disable-Default-nginx-Site"><a href="#4-Disable-Default-nginx-Site" class="headerlink" title="4. Disable Default nginx Site"></a>4. Disable Default <code>nginx</code> Site</h2><p>This part is optional. This part is also same as the <a href="https://lingkang.dev/2024/08/29/host-maybe/#4-Disable-default-Nginx-site">Self-Host Maybe Finance Web App - 4. Disable default Nginx site</a> section.</p><h2 id="5-Disable-New-Registration"><a href="#5-Disable-New-Registration" class="headerlink" title="5. Disable New Registration"></a>5. Disable New Registration</h2><p>At the moment, the self-hosted Vikunja instance allows anyone to register. If you want to disable new registration, you can set the <code>VIKUNJA_SERVICE_ENABLEREGISTRATION</code> environment variable to <code>false</code> in <code>compose.yml</code>.</p><p>For example:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs YAML"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">vikunja:</span><br>    <span class="hljs-string">...</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-string">...</span><br>      <span class="hljs-attr">VIKUNJA_SERVICE_ENABLEREGISTRATION:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-string">...</span><br></code></pre></td></tr></table></figure><p>When new registration is disabled, the login page will not display the registration link.</p><h2 id="6-Update-for-New-Version"><a href="#6-Update-for-New-Version" class="headerlink" title="6. Update for New Version"></a>6. Update for New Version</h2><p>To update the Vikunja service to the latest version, you can pull the latest image and restart the service:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">cd</span> ~/app/todolist<br>sudo docker compose stop<br>sudo docker compose pull<br>sudo docker compose up -d<br></code></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://vikunja.io/">Vikunja: The open-source, self-hostable to-do app</a></li><li><a href="https://kolaente.dev/vikunja/vikunja">vikunja&#x2F;vikunja: The to-do app to organize your life. Public API Roadmap here: - vikunja - Gitea</a></li><li><a href="https://vikunja.io/docs/installing">Vikunja: Installing</a></li><li><a href="https://vikunja.io/docs/full-docker-example">Vikunja: Full docker example</a></li><li><a href="https://vikunja.io/docs/config-options">Vikunja: Configuration options</a></li><li><a href="https://lingkang.dev/2024/08/29/host-maybe/">Self-Host Maybe Finance Web App - Lingkangâ€™s Blog</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Server</tag>
      
      <tag>Cloud</tag>
      
      <tag>Nginx</tag>
      
      <tag>Docker</tag>
      
      <tag>Self-Host</tag>
      
      <tag>Web App</tag>
      
      <tag>SSL</tag>
      
      <tag>Go</tag>
      
      <tag>Vue</tag>
      
      <tag>To-Do List</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Paper Notes: Dynamic Inference of Convolutional Neural Networks</title>
    <link href="/2024/10/16/read-paper-dyn-cnn/"/>
    <url>/2024/10/16/read-paper-dyn-cnn/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Paper-Notes-Dynamic-Inference-of-Convolutional-Neural-Networks"><a href="#Paper-Notes-Dynamic-Inference-of-Convolutional-Neural-Networks" class="headerlink" title="Paper Notes: Dynamic Inference of Convolutional Neural Networks"></a>Paper Notes: Dynamic Inference of Convolutional Neural Networks</h1><blockquote><p>Wenhan Xia, Hongxu Yin, Xiaoliang Dai and Niraj Kumar Jha. Fully Dynamic Inference With Deep Neural Networks. <em>IEEE Transactions on Emerging Topics in Computing</em>, 2020. <a href="https://doi.org/10.1109/TETC.2021.3056031">https://doi.org/10.1109/TETC.2021.3056031</a></p></blockquote><h2 id="Observation"><a href="#Observation" class="headerlink" title="Observation"></a>Observation</h2><p>CNN layers and features have heavy <strong>input-dependence</strong>, which can be exploited to reduce (i.e., be ignored) the computational cost of inference.</p><p>Thus, only salient layers for current input (which was decided by Layer Net, <em>L-Net</em>) are computed, while others are skipped. This also applies to the feature maps&#x2F; channels (which was decided by Channel Net, <em>C-Net</em>) within a layer.</p><h2 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h2><h3 id="L-Net"><a href="#L-Net" class="headerlink" title="L-Net"></a>L-Net</h3><p>The L-Net is inspired by the concept of block-based residual learning.</p>    <div class="fold">      <div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-637da550" role="button" aria-expanded="false" aria-controls="collapse-637da550">        <div class="fold-arrow">â–¶</div>Side Note on Block-Based Learning (Click here to unfold/fold)      </div>      <div class="fold-collapse collapse" id="collapse-637da550">        <div class="fold-content">          <h4 id="Side-Note-on-Block-Based-Learning"><a href="#Side-Note-on-Block-Based-Learning" class="headerlink" title="Side Note on Block-Based Learning"></a>Side Note on Block-Based Learning</h4><p>Introduced by He et al. in <a href="https://arxiv.org/abs/1512.03385">Deep Residual Learning for Image Recognition</a>, the block-based residual learning is a technique to improve the training of convolutional neural networks. The core idea is to add the output of a block with the input (i.e., residual), which is then passed through a non-linear activation function. This enables the network to grow deeper without the vanishing gradient problem.</p><p>For example, <code>ResNet</code> in PyTorch is constructed by several blocks.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> torchvision.models <span class="hljs-keyword">import</span> resnet18<br><br>model = resnet18()<br><span class="hljs-comment"># print(model._modules)</span><br><span class="hljs-built_in">print</span>(model._modules[<span class="hljs-string">&#x27;layer1&#x27;</span>])<br></code></pre></td></tr></table></figure><p>The output would be like:</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs TXT">Sequential(<br>  (0): BasicBlock(<br>    (conv1): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)<br>    (bn1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)<br>    (relu): ReLU(inplace=True)<br>    (conv2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)<br>    (bn2): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)<br>  )<br>  (1): BasicBlock(<br>    (conv1): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)<br>    (bn1): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)<br>    (relu): ReLU(inplace=True)<br>    (conv2): Conv2d(64, 64, kernel_size=(3, 3), stride=(1, 1), padding=(1, 1), bias=False)<br>    (bn2): BatchNorm2d(64, eps=1e-05, momentum=0.1, affine=True, track_running_stats=True)<br>  )<br>)<br></code></pre></td></tr></table></figure><p>The generated <a href="https://pytorch.org/vision/main/models/generated/torchvision.models.resnet18.html"><code>resnet18</code></a> has 4 main layers (besides some initial layers and fully connected layers afterwards), each of which are constructed by two blocks <a href="https://pytorch.org/vision/main/_modules/torchvision/models/resnet.html#:~:text=%3DFalse%29-,class%20BasicBlock"><code>BasicBlock</code></a>. The <code>BasicBlock</code> is where the residual adding is performed.</p><p>Letâ€™s see its <code>forward()</code> function:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicBlock</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x: Tensor</span>) -&gt; Tensor:<br>        identity = x<br><br>        out = self.conv1(x)<br>        out = self.bn1(out)<br>        out = self.relu(out)<br><br>        out = self.conv2(out)<br>        out = self.bn2(out)<br><br>        <span class="hljs-keyword">if</span> self.downsample <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            identity = self.downsample(x)<br><br>        out += identity<br>        out = self.relu(out)<br><br>        <span class="hljs-keyword">return</span> out<br></code></pre></td></tr></table></figure><p>Note the <code>out += identity</code> line, which is the key to the residual learning. (<em>Downsampling</em> is simply a technique to match the dimensions of <code>identity</code> and <code>out</code>.)</p><p>For ResNet 50 and above, the <code>BasicBlock</code> is replaced by <code>Bottleneck</code> block, which contains different structure of conv layers, but the residual learning is the same.</p><p><a class="btn" href="#L-Net" title="Jump back to the main content."><strong>Jump back to the main content.</strong></a></p>        </div>      </div>    </div><p>It mainly have 3 components:</p><ol><li>a global average pooling layer over the input feature map;</li><li>a fully connected layer;</li><li>a ReLU-1 activation function.</li></ol><p>The output of L-Net layer would be the <em>block salience score</em>, ranging from 0 to 1. The higher the score, the more salient the block is. This score is applied to the block output as a scaling factor, and if the score is 9, meaning that the block is <em>skipped</em>.</p><p>The philosophy is to design the additional layers to be lightweight, so that no significant overhead is introduced.</p><p>The L-Net would be attached to each block in parallel.</p><p><img src="/./images/NeuralNetwork/L-Net.png" alt="L-Net Structure (in dashed blue box)"></p><h3 id="C-Net"><a href="#C-Net" class="headerlink" title="C-Net"></a>C-Net</h3><p>Similarly for the convolutional computation inside each block, a convolutional layer may also be skipped if it is not salient for the current input. Thus, the C-Net is exactly the same as L-Net, except that</p><ol><li>Different <strong>location</strong> in the network, i.e., attached to each convolutional layer in parallel;</li><li>Different <strong>size</strong> of the net, i.e., the input size is the feature map of the convolutional layer, and the output size is a 1D vector of length equal to the number of channels in the feature map.</li></ol><p><img src="/./images/NeuralNetwork/C-Net.png" alt="C-Net Structure (in dashed gray box)"></p><h3 id="LC-Net"><a href="#LC-Net" class="headerlink" title="LC-Net"></a>LC-Net</h3><p>The actual implementation is a combination of L-Net and C-Net, which is called LC-Net. This is because part of L-Net and C-Net can be shared, such as the global average pooling layer at the beginning.</p><!-- ## References --><!-- - [torchvision.models.resnet â€” Torchvision main documentation](https://pytorch.org/vision/main/_modules/torchvision/models/resnet.html) --><!-- - [[1512.03385] Deep Residual Learning for Image Recognition](https://arxiv.org/abs/1512.03385) --><!-- - [ResNet â€” Torchvision main documentation](https://pytorch.org/vision/main/models/resnet.html) -->]]></content>
    
    
    <categories>
      
      <category>Paper Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Optimization</tag>
      
      <tag>Neural Network</tag>
      
      <tag>CNN</tag>
      
      <tag>Residual Learning</tag>
      
      <tag>Dynamic Inference</tag>
      
      <tag>Pruning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Self-Host Maybe Finance Web App</title>
    <link href="/2024/08/29/host-maybe/"/>
    <url>/2024/08/29/host-maybe/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Self-Host-Maybe-Finance-Web-App"><a href="#Self-Host-Maybe-Finance-Web-App" class="headerlink" title="Self-Host Maybe Finance Web App"></a>Self-Host Maybe Finance Web App</h1><p><a href="https://maybe.co/">Maybe</a> is an open-source personal finance web app that helps you track your income, expenses, and investments. It is built with <em>Ruby on Rails</em>.</p><p>In this post, I will show you how to host Maybe on your own Linux server using <em>Docker</em> and <em>Nginx</em>.</p><h2 id="0-Environment"><a href="#0-Environment" class="headerlink" title="0. Environment"></a>0. Environment</h2><table><thead><tr><th>Software</th><th>Version</th></tr></thead><tbody><tr><td>Ubuntu</td><td>22.04.4 LTS</td></tr><tr><td>Nginx</td><td>1.18.0</td></tr><tr><td>Snap</td><td>2.63</td></tr><tr><td>Docker</td><td>27.2.0 (install later)</td></tr><tr><td>Certbot</td><td>2.11.0 (install later)</td></tr></tbody></table><h2 id="1-Install-Docker"><a href="#1-Install-Docker" class="headerlink" title="1. Install Docker"></a>1. Install Docker</h2><p>This section is cherry-picked from the official Docker documentation: <a href="https://docs.docker.com/engine/install/ubuntu/">Install Docker Engine on Ubuntu | Docker Docs</a></p><h3 id="1-1-Set-up-Docker-APT-repository"><a href="#1-1-Set-up-Docker-APT-repository" class="headerlink" title="1.1. Set up Docker APT repository:"></a>1.1. Set up Docker APT repository:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt update<br>sudo apt install ca-certificates curl<br>sudo install -m 0755 -d /etc/apt/keyrings<br>sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc<br>sudo <span class="hljs-built_in">chmod</span> a+r /etc/apt/keyrings/docker.asc<br><br><span class="hljs-built_in">echo</span> \<br>  <span class="hljs-string">&quot;deb [arch=<span class="hljs-subst">$(dpkg --print-architecture)</span> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span><br><span class="hljs-string">  <span class="hljs-subst">$(. /etc/os-release &amp;&amp; echo <span class="hljs-string">&quot;<span class="hljs-variable">$VERSION_CODENAME</span>&quot;</span>)</span> stable&quot;</span> | \<br>  sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/docker.list &gt; /dev/null<br></code></pre></td></tr></table></figure><h3 id="1-2-Install-Docker"><a href="#1-2-Install-Docker" class="headerlink" title="1.2. Install Docker:"></a>1.2. Install Docker:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt update<br>sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin<br></code></pre></td></tr></table></figure><h3 id="1-3-Check-the-installation"><a href="#1-3-Check-the-installation" class="headerlink" title="1.3. Check the installation:"></a>1.3. Check the installation:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo docker run hello-world<br></code></pre></td></tr></table></figure><h2 id="2-Setup-Docker-Compose"><a href="#2-Setup-Docker-Compose" class="headerlink" title="2. Setup Docker Compose"></a>2. Setup Docker Compose</h2><p>The main doc is located at <a href="https://github.com/maybe-finance/maybe/blob/main/docs/hosting/docker.md"><code>maybe/docs/hosting/docker.md</code> at main</a> of Maybeâ€™s GitHub repository, but some details are modified here.+</p><h3 id="2-1-One-click-Setup"><a href="#2-1-One-click-Setup" class="headerlink" title="2.1. One-click Setup"></a>2.1. One-click Setup</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> -p ~/app/maybe_bookkeeping<br><span class="hljs-built_in">cd</span> ~/app/maybe_bookkeeping<br>curl -o compose.yml https://raw.githubusercontent.com/maybe-finance/maybe/main/docker-compose.example.yml<br><span class="hljs-built_in">touch</span> .<span class="hljs-built_in">env</span><br>openssl rand -hex 64 &gt; .<span class="hljs-built_in">env</span><br></code></pre></td></tr></table></figure><p>Now the <code>.env</code> file is created with a random secret key. Update the <code>.env</code> file as follows:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs conf">SECRET_KEY=&quot;your_secret_key&quot;<br>POSTGRES_PASSWORD=&quot;your_postgres_password&quot;<br></code></pre></td></tr></table></figure><h3 id="2-2-Optional-Configuration"><a href="#2-2-Optional-Configuration" class="headerlink" title="2.2. Optional Configuration"></a>2.2. Optional Configuration</h3><p>Update the <code>image</code> value of the <code>maybe</code> service in <code>compose.yml</code> to the stable version:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-attr">image:</span> <span class="hljs-string">ghcr.io/maybe-finance/maybe:stable</span><br></code></pre></td></tr></table></figure><p>By default, docker compose will put the data in <code>/var/lib/docker/volumes/</code> directory on Linux. You can change it by updating the <code>volumes</code> section of each service in <code>compose.yml</code>, and comment out the top-level <code>volumes</code> section.</p><p>for example, to put the data in <code>/var/app/maybe/postgres-data/</code> directory:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">postgres:</span><br>    <span class="hljs-string">...</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/app/maybe/postgres-data:/var/lib/postgresql/data</span><br><br><span class="hljs-attr">volume:</span><br><span class="hljs-comment">#  postgres-data: # REMEMBER TO COMMENT OUT THIS LINE</span><br></code></pre></td></tr></table></figure><p>Similarly for <code>app</code> service:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-string">...</span><br>    <span class="hljs-attr">volumes:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/app/maybe/app-data:/rails/storage</span><br><br><span class="hljs-attr">volume:</span><br><span class="hljs-comment">#  app-data: # REMEMBER TO COMMENT OUT THIS LINE</span><br></code></pre></td></tr></table></figure><h3 id="2-3-Start-the-Services"><a href="#2-3-Start-the-Services" class="headerlink" title="2.3. Start the Services"></a>2.3. Start the Services</h3><p>Start the services in the background:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker compose up -d<br></code></pre></td></tr></table></figure><p>Now it is available at <code>http://localhost:3000/</code> or <code>&lt;your_pub_ip&gt;:3000</code>. (Donâ€™t forget to open the port of the server in the firewall.)</p><h2 id="3-Setup-SSL-Certificates"><a href="#3-Setup-SSL-Certificates" class="headerlink" title="3. Setup SSL Certificates"></a>3. Setup SSL Certificates</h2><p>At the moment, when you access to your bookkeeping app, the web browser will warn you that the connection is not secure. To fix this, we need to install SSL certificates.</p><h3 id="3-1-Install-Certbot"><a href="#3-1-Install-Certbot" class="headerlink" title="3.1. Install Certbot"></a>3.1. Install Certbot</h3><p><a href="https://certbot.eff.org/">Certbot</a> is a free, open-source software for manually-administrated websites to enable HTTPS by using <a href="https://letsencrypt.org/">Letâ€™s Encrypt</a> certificates.</p><p>This section is mainly based on the official Certbot documentation: <a href="https://certbot.eff.org/instructions">Certbot Instructions | Certbot</a></p><p>The <code>snap</code> is pre-installed on Ubuntu 20.04.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snap --version<br></code></pre></td></tr></table></figure><p>Replace <code>yourdomain.com</code> with your actual domain name.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo snap install --classic certbot<br>sudo <span class="hljs-built_in">ln</span> -s /snap/bin/certbot /usr/bin/certbot<br>sudo certbot certonly --nginx -d yourdomain.com<br></code></pre></td></tr></table></figure><p>The certificates are stored in <code>/etc/letsencrypt/live/yourdomain.com/</code>.</p><h3 id="3-2-Configure-nginx-to-use-the-certificates"><a href="#3-2-Configure-nginx-to-use-the-certificates" class="headerlink" title="3.2. Configure nginx to use the certificates"></a>3.2. Configure <code>nginx</code> to use the certificates</h3><p>Update <code>/etc/nginx/sites-available/yourdomain.com</code> as follows:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span> yourdomain.com;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">301</span> https://<span class="hljs-variable">$host</span><span class="hljs-variable">$request_uri</span>;<br>    &#125;<br>&#125;<br><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">443</span> ssl;<br>    <span class="hljs-attribute">server_name</span> yourdomain.com;<br><br>    <span class="hljs-attribute">ssl_certificate</span> /etc/letsencrypt/live/yourdomain.com/fullchain.pem;<br>    <span class="hljs-attribute">ssl_certificate_key</span> /etc/letsencrypt/live/yourdomain.com/privkey.pem;<br>    <span class="hljs-attribute">include</span> /etc/letsencrypt/options-ssl-nginx.conf;<br>    <span class="hljs-attribute">ssl_dhparam</span> /etc/letsencrypt/ssl-dhparams.pem;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://localhost:3000;<br>        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Then save and check the configuration:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">ln</span> -s /etc/nginx/sites-available/yourdomain.com /etc/nginx/sites-enabled/<br>sudo nginx -t<br>sudo systemctl reload nginx<br></code></pre></td></tr></table></figure><p>Donâ€™t forget to add respective <code>A</code> DNS records (Or <code>AAAA</code> for IPv6) on your domain registrar.</p><h2 id="4-Disable-default-nginx-site"><a href="#4-Disable-default-nginx-site" class="headerlink" title="4. Disable default nginx site"></a>4. Disable default <code>nginx</code> site</h2><p>At the moment, the default <code>nginx</code> site is still enabled on port 80 (accessible at <code>http://your_pub_ip/</code> or <code>http://your_pub_ip:80</code>) with default Nginx welcome page.</p><p>To disable it:</p><p>Update <code>/etc/nginx/sites-available/default</code> as follows:</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span> default_server;<br>    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">80</span> default_server;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">return</span> <span class="hljs-number">403</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nginx -t<br>sudo systemctl reload nginx<br></code></pre></td></tr></table></figure><h2 id="5-Setup-Invitation-Registration"><a href="#5-Setup-Invitation-Registration" class="headerlink" title="5. Setup Invitation Registration"></a>5. Setup Invitation Registration</h2><p>For a self-hosted finance app, you may not want to allow anyone to register. Luckily, Maybe has an optional config to require an invite code to register.</p><p>Stop current services first:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~/app/maybe_bookkeeping<br>docker compose stop<br></code></pre></td></tr></table></figure><p>Add <code>REQUIRE_INVITE_CODE: &quot;true&quot;</code> to the <code>app</code> service in <code>compose.yml</code>:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">services:</span><br>  <span class="hljs-attr">app:</span><br>    <span class="hljs-string">...</span><br>    <span class="hljs-attr">environment:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">REQUIRE_INVITE_CODE=&quot;true&quot;</span><br></code></pre></td></tr></table></figure><p>Restart the services:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker compose up -d<br></code></pre></td></tr></table></figure><p>Now you can see that new registration will require an invite code.</p><p>You can run <code>rake invites:create</code> to create an invite code. <code>Rake</code> is a GNU Make-like program for Ruby-related tasks, so you probably need to have Ruby toolchain installed on your server.</p><h2 id="6-Update-for-Future-Versions"><a href="#6-Update-for-Future-Versions" class="headerlink" title="6. Update for Future Versions"></a>6. Update for Future Versions</h2><p>The latest version always have new features and bug fixes. To update the Maybe app to the latest version:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~/app/maybe_bookkeeping<br>docker compose stop      <span class="hljs-comment"># Stop the current services</span><br>docker compose pull      <span class="hljs-comment"># Pull the latest images</span><br>docker compose build app <span class="hljs-comment"># Rebuild the app service</span><br>docker compose up -d     <span class="hljs-comment"># Start the services</span><br></code></pre></td></tr></table></figure><h2 id="7-References"><a href="#7-References" class="headerlink" title="7. References"></a>7. References</h2><ol><li><a href="https://maybe.co/">Maybe: The OS for your personal finances</a></li><li><a href="https://github.com/maybe-finance/maybe">maybe-finance&#x2F;maybe: The OS for your personal finances</a></li><li><a href="https://docs.docker.com/compose/">Docker Compose | Docker Docs</a></li><li><a href="https://certbot.eff.org/">Certbot</a></li><li><a href="https://nginx.org/en/">nginx</a></li><li><a href="https://github.com/maybe-finance/maybe/issues/1138">How to get invite codes? Â· Issue #1138 Â· maybe-finance&#x2F;maybe</a></li><li><a href="https://ruby.github.io/rake/">Rake â€“ Ruby Make</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Server</tag>
      
      <tag>Cloud</tag>
      
      <tag>Nginx</tag>
      
      <tag>ECS</tag>
      
      <tag>Docker</tag>
      
      <tag>Finance</tag>
      
      <tag>Self-Host</tag>
      
      <tag>Web App</tag>
      
      <tag>SSL</tag>
      
      <tag>Ruby</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Paper Notes: PeeK - Pruning for K-th Shortest Paths</title>
    <link href="/2024/08/09/read-paper-peek/"/>
    <url>/2024/08/09/read-paper-peek/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Paper-Notes-PeeK-Pruning-for-K-th-Shortest-Paths"><a href="#Paper-Notes-PeeK-Pruning-for-K-th-Shortest-Paths" class="headerlink" title="Paper Notes: PeeK - Pruning for K-th Shortest Paths"></a>Paper Notes: PeeK - Pruning for K-th Shortest Paths</h1><blockquote><p>Wang Feng, Shiyang Chen, Hang Liu, and Yuede Ji. PeeK: A Prune-Centric Approach for K Shortest Path Computation. <em>International Conference for High Performance Computing, Networking, Storage, and Analysis</em>, 2023. <a href="https://doi.org/10.1145/3581784.3607110">https://doi.org/10.1145/3581784.3607110</a></p></blockquote><h2 id="Observation"><a href="#Observation" class="headerlink" title="Observation"></a>Observation</h2><p>The solution of KSP (K Shortest Paths) problem is typically a small sub set of all available paths, even though the <em>K</em> is very large in a very large graph.</p><h2 id="K-Upper-Bound-Pruning"><a href="#K-Upper-Bound-Pruning" class="headerlink" title="K Upper Bound Pruning"></a>K Upper Bound Pruning</h2><p>Based on the observation, the authors propose a <em>prune-centric</em> approach to KSP computation. The key idea is to prune the search space.</p><p><img src="/images/peek/pruning.png" alt="K Upper Bound Pruning"></p><blockquote><p>SSSP: Single Source Shortest Path</p><p>Start from the source node, get the shortest path to each node in the graph. Its result can basically represented as a tree, with the source node as the root. See figure <em>(b)</em>.</p></blockquote><blockquote><p>Reverse SSSP:</p><p>Start from the target node, get the shortest path from each node in the directed graph. Its result can basically represented as a tree, with the target node as the root, but in opposite direction. See figure <em>(c)</em>.</p></blockquote><p>By combining the SSSP tree and the reverse SSSP tree, we can get all possible paths from the source to the target. It can be divided into two cases:</p><ol><li>The vertices is not reachable from the source or to the target. For example, the vertex <code>a</code> can reach to the target <code>t</code> via <code>a -&gt; s -&gt; f -&gt; j -&gt; t</code>, but is not reachable from the source <code>s</code>.<ul><li>The distance sum is basically denoted as <em>infinity</em>.</li><li>This is common for a sparse directed graph, as the observation above.</li></ul></li><li>The vertices is reachable from the source and to the target. For example, the vertex <code>o</code> can reach to the target <code>t</code> via <code>o -&gt; r -&gt; l -&gt; t</code>, and is reachable from the source <code>s</code> by <code>s -&gt; g -&gt; l -&gt; o</code>.</li></ol><p>Marked as reachable, this situation can be further divided into two parts. For example, the path obtained from <code>o</code> is <code>s -&gt; g -&gt; l -&gt; o -&gt; r -&gt; l -&gt; t</code>, and is can be clearly simplified as <code>s -&gt; g -&gt; l -&gt; t</code>.</p><p>So the reachable paths are sorted by the distance sum, and only the top <em>K</em> paths are kept. The rest are <strong>pruned</strong>. For the illustration, the <em>K</em> &#x3D; 3 and paths with distance sum <code>11</code>, <code>12</code>, <code>14</code> are kept as potential search space. See figure <em>(d)</em>.</p><div class="note note-success">            <p>In actual implementation, vertices and edges that not presented in the first SSSP result can be <strong>pruned immediately</strong>, which helps to speed up the next SSSP computation.</p><p>This also applies to the second (reversed) SSSP, which can speed up the CSR format conversion.</p>          </div><h2 id="CSR-Representation-of-Sparse-Graph"><a href="#CSR-Representation-of-Sparse-Graph" class="headerlink" title="CSR Representation of Sparse Graph"></a>CSR Representation of Sparse Graph</h2><p><strong>CSR</strong> (Compressed Sparse Row) is also used to represent the graph. The CSR representation is a common way to store a sparse matrix, whereas a graph can be viewed as an adjacency matrix.</p><h2 id="Hand-on-Experiment-amp-Some-Thoughts"><a href="#Hand-on-Experiment-amp-Some-Thoughts" class="headerlink" title="Hand-on Experiment &amp; Some Thoughts"></a>Hand-on Experiment &amp; Some Thoughts</h2><p>I tried to run the provided code on my own machine, the testing script can be found at the <a href="#Appendix">appendix</a>.</p><p>The testing script includes:</p><ol><li>Graph generation with <code>PaRMAT</code></li><li>Graph conversion to CSR format (<code>make_csr</code>)</li><li>Reachable pairs generation (<code>make_reachable_src_dest</code>)</li><li>Running the <code>PeeK</code> algorithm with different threads</li></ol><p><img src="/images/peek/csr_creation_time_weight.png"></p><p>The above figure shows the percentage of the CSR conversion time over the total time. It is clear that, for a single threaded <code>PeeK</code> implementation, the CSR conversion time takes a significant part. Moreover, this part increases as the graph grows more dense. (Note that the fist point have sparsity rate of <em>97.98%</em>, and the last point have <em>1.01%</em>.) And actually, the running time of the <code>PeeK</code> algorithm is growing exponentially as the sparsity rate drops.</p><div class="note note-info">            <p><strong>Understanding 1</strong></p><p>The <code>PeeK</code> algorithm works better on a sparse graph. This also matches the behavior of <a href="#K-Upper-Bound-Pruning"><em>K upper bound pruning</em></a> â€“ the more sparse the graph is, the more vertices and edges can be pruned.</p>          </div><p>Additionally, running <code>make_csr</code> would consume extreme large memory, and it can be observed that the memory consumption will grow to a peak and gradually decrease. For such memory-bound computation, memory size and access are also potential bottlenecks.</p><div class="note note-info">            <p><strong>Understanding 2</strong></p><p>The CSR conversion time is potentially a bottleneck for the <code>PeeK</code> algorithm. However, converting a graph to CSR format is also difficult to be parallelized. </p>          </div><p>For the multi-threaded <code>PeeK</code> implementation, CSR conversion time is relatively less weighted, which looks good. However, the running time is actually 50 to 300 times slower than the single threaded implementation. This is not expected, and I think it is due to the overhead of the multi-threading. Probably thread-wise communication and synchronization are the main reasons.</p><div class="note note-info">            <p><strong>Understanding 3</strong></p><p>The overhead of the multi-threading is not negligible for relatively smaller graph. The multi-threading is not always the best choice.</p>          </div><p>For the experiment and comparison section in the paper, it seems that the <code>make_csr</code> part is not counted in its running time. This is a potential issue, as the CSR representation of graph is significant for the <code>PeeK</code> algorithm, and its running time is not negligible.</p><div class="note note-warning">            <p><strong>Bug found</strong></p><p>For a graph without enough paths to meet the <em>K</em> requirement, current implementation will fall into an infinite loop at <code>make_reachable_src_dest</code>. For example, a graph with 100 vertices and 100 edges, the <code>PeeK</code> algorithm try to meet <code>K = 128</code> and loop forever.</p><p>Although the number of edges can not represent the number of possible paths, it still demonstrates the potential bug in the implementation.</p>          </div><h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><p>Source code of the testing script:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br>LOG_FILE = <span class="hljs-string">&quot;test.log&quot;</span><br>MAX_VERTICES_NUM = <span class="hljs-number">100000</span><br><br>MAKE_CSR_COMMAND = [<br>    <span class="hljs-string">&quot;pwsh.exe&quot;</span>,<br>    <span class="hljs-string">&quot;-Command&quot;</span>,<br>    <span class="hljs-string">&quot;g++&quot;</span>,<br>    <span class="hljs-string">&quot;-O3&quot;</span>,<br>    <span class="hljs-string">&quot;-o&quot;</span>,<br>    <span class="hljs-string">&quot;make_csr.exe&quot;</span>,<br>    <span class="hljs-string">&quot;make_csr.cpp&quot;</span>,<br>]<br><br>REACHABLE_COMMAND = [<br>    <span class="hljs-string">&quot;pwsh.exe&quot;</span>,<br>    <span class="hljs-string">&quot;-Command&quot;</span>,<br>    <span class="hljs-string">&quot;g++&quot;</span>,<br>    <span class="hljs-string">&quot;-O3&quot;</span>,<br>    <span class="hljs-string">&quot;-I../includes&quot;</span>,<br>    <span class="hljs-string">&quot;-fopenmp&quot;</span>,<br>    <span class="hljs-string">&quot;-o&quot;</span>,<br>    <span class="hljs-string">&quot;make_reachable_src_dest.exe&quot;</span>,<br>    <span class="hljs-string">&quot;make_reachable_src_dest.cpp&quot;</span>,<br>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_max_edges_num</span>(<span class="hljs-params">vertices_num: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">int</span>:<br>    <span class="hljs-keyword">return</span> vertices_num * (vertices_num - <span class="hljs-number">1</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calc_graph_sparsity</span>(<span class="hljs-params">vertices_num: <span class="hljs-built_in">int</span>, edges_num: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">float</span>:<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> - edges_num / get_max_edges_num(vertices_num)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">compile_util</span>(<span class="hljs-params">command: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>], cwd: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Compile a cpp file.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(LOG_FILE, <span class="hljs-string">&quot;a&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(<span class="hljs-string">f&quot;@compile <span class="hljs-subst">&#123;command[-<span class="hljs-number">1</span>]&#125;</span>\n&quot;</span>)<br>        process = subprocess.run(<br>            command, shell=<span class="hljs-literal">True</span>, stdout=subprocess.PIPE, text=<span class="hljs-literal">True</span>, cwd=cwd<br>        )<br>        f.write(process.stdout)<br>        <span class="hljs-keyword">if</span> process.returncode != <span class="hljs-number">0</span>:<br>            f.write(<span class="hljs-string">&quot; &quot;</span>.join(command) + <span class="hljs-string">&quot;\n&quot;</span>)<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&quot;compile failed for <span class="hljs-subst">&#123;command[-<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_vertex_edge_pair</span>(<span class="hljs-params">v: <span class="hljs-built_in">int</span>, e: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-keyword">assert</span> get_max_edges_num(v) &gt;= e<br>    graph_file = <span class="hljs-string">f&quot;./out/edge_list_v<span class="hljs-subst">&#123;v&#125;</span>_e<span class="hljs-subst">&#123;e&#125;</span>.txt&quot;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(LOG_FILE, <span class="hljs-string">&quot;a&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(<span class="hljs-string">&quot;================================\n&quot;</span>)<br>        f.write(<span class="hljs-string">f&quot;vertices: <span class="hljs-subst">&#123;v&#125;</span> \t edges: <span class="hljs-subst">&#123;e&#125;</span> -&gt; <span class="hljs-subst">&#123;graph_file&#125;</span>\n&quot;</span>)<br>        f.write(<span class="hljs-string">f&quot;sparsity: <span class="hljs-subst">&#123;calc_graph_sparsity(vertices_num, e) * <span class="hljs-number">100</span>:<span class="hljs-number">.2</span>f&#125;</span>%\n&quot;</span>)<br>        f.write(<span class="hljs-string">&quot;@generate the graph (vertex edge pair)\n&quot;</span>)<br>        command = [<br>            <span class="hljs-string">&quot;pwsh.exe&quot;</span>,<br>            <span class="hljs-string">&quot;-Command&quot;</span>,<br>            <span class="hljs-string">&quot;./tools/PaRMAT/Release/PaRMAT.exe&quot;</span>,<br>            <span class="hljs-string">&quot;-nVertices&quot;</span>,<br>            <span class="hljs-built_in">str</span>(v),<br>            <span class="hljs-string">&quot;-nEdges&quot;</span>,<br>            <span class="hljs-built_in">str</span>(e),<br>            <span class="hljs-string">&quot;-a&quot;</span>,<br>            <span class="hljs-string">&quot;0.45&quot;</span>,<br>            <span class="hljs-string">&quot;-b&quot;</span>,<br>            <span class="hljs-string">&quot;0.22&quot;</span>,<br>            <span class="hljs-string">&quot;-c&quot;</span>,<br>            <span class="hljs-string">&quot;0.22&quot;</span>,<br>            <span class="hljs-string">&quot;-sorted&quot;</span>,<br>            <span class="hljs-string">&quot;-noEdgeToSelf&quot;</span>,<br>            <span class="hljs-string">&quot;-noDuplicateEdges&quot;</span>,<br>            <span class="hljs-string">&quot;-output&quot;</span>,<br>            graph_file,<br>        ]<br>        process = subprocess.run(<br>            command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class="hljs-literal">True</span><br>        )<br>        <span class="hljs-keyword">if</span> process.returncode != <span class="hljs-number">0</span>:<br>            f.write(<span class="hljs-string">&quot; &quot;</span>.join(command) + <span class="hljs-string">&quot;\n&quot;</span>)<br>            f.write(process.stdout)<br>            f.write(process.stderr)<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&quot;generate graph failed at v: <span class="hljs-subst">&#123;v&#125;</span>, e: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> graph_file<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_graph_to_csr</span>(<span class="hljs-params">graph_file: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">tuple</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]:<br>    prefix = graph_file.split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">1</span>]<br>    begin_file = <span class="hljs-string">f&quot;.<span class="hljs-subst">&#123;prefix&#125;</span>.begin.bin&quot;</span><br>    csr_file = <span class="hljs-string">f&quot;.<span class="hljs-subst">&#123;prefix&#125;</span>.csr.bin&quot;</span><br>    val_file = <span class="hljs-string">f&quot;.<span class="hljs-subst">&#123;prefix&#125;</span>.val.bin&quot;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(LOG_FILE, <span class="hljs-string">&quot;a&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(<span class="hljs-string">f&quot;@convert graph to csr\n&quot;</span>)<br>        command = [<br>            <span class="hljs-string">&quot;pwsh.exe&quot;</span>,<br>            <span class="hljs-string">&quot;-Command&quot;</span>,<br>            <span class="hljs-string">&quot;./tools/make_csr.exe&quot;</span>,<br>            graph_file,<br>            begin_file,<br>            csr_file,<br>            val_file,<br>        ]<br>        process = subprocess.run(command, stdout=subprocess.PIPE, text=<span class="hljs-literal">True</span>)<br>        f.write(process.stdout)<br>        <span class="hljs-keyword">if</span> process.returncode != <span class="hljs-number">0</span>:<br>            f.write(<span class="hljs-string">&quot; &quot;</span>.join(command) + <span class="hljs-string">&quot;\n&quot;</span>)<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&quot;convert graph to csr failed at <span class="hljs-subst">&#123;graph_file&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> (begin_file, csr_file, val_file)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_reachable_pairs</span>(<span class="hljs-params">begin_file: <span class="hljs-built_in">str</span>, csr_file: <span class="hljs-built_in">str</span>, val_file: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    prefix = csr_file.split(<span class="hljs-string">&quot;.&quot;</span>)[<span class="hljs-number">1</span>]<br>    reachable_file = <span class="hljs-string">f&quot;.<span class="hljs-subst">&#123;prefix&#125;</span>.reachable.txt&quot;</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(LOG_FILE, <span class="hljs-string">&quot;a&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(<span class="hljs-string">f&quot;@gen reachable pairs\n&quot;</span>)<br>        command = [<br>            <span class="hljs-string">&quot;pwsh.exe&quot;</span>,<br>            <span class="hljs-string">&quot;-Command&quot;</span>,<br>            <span class="hljs-string">&quot;./tools/make_reachable_src_dest.exe&quot;</span>,<br>            begin_file,<br>            csr_file,<br>            val_file,<br>        ]<br>        process = subprocess.run(<br>            command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class="hljs-literal">True</span><br>        )<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(reachable_file, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f2:<br>            f2.write(process.stdout)<br>        f.write(process.stderr)<br>        <span class="hljs-keyword">if</span> process.returncode != <span class="hljs-number">0</span>:<br>            f.write(<span class="hljs-string">&quot; &quot;</span>.join(command) + <span class="hljs-string">&quot;\n&quot;</span>)<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&quot;gen reachable pairs failed at <span class="hljs-subst">&#123;reachable_file&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> reachable_file<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_peek_with_threads</span>(<span class="hljs-params"></span><br><span class="hljs-params">    begin_file: <span class="hljs-built_in">str</span>, csr_file: <span class="hljs-built_in">str</span>, val_file: <span class="hljs-built_in">str</span>, reachable_file: <span class="hljs-built_in">str</span>, threads: <span class="hljs-built_in">int</span></span><br><span class="hljs-params"></span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(LOG_FILE, <span class="hljs-string">&quot;a&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(<span class="hljs-string">f&quot;@run peek with threads: <span class="hljs-subst">&#123;threads&#125;</span>\n&quot;</span>)<br>        command = [<br>            <span class="hljs-string">&quot;pwsh.exe&quot;</span>,<br>            <span class="hljs-string">&quot;-Command&quot;</span>,<br>            <span class="hljs-string">f&quot;./peek_adaptive_with_status_array_kbound_thread_<span class="hljs-subst">&#123;threads&#125;</span>.exe&quot;</span>,<br>            begin_file,<br>            csr_file,<br>            val_file,<br>            reachable_file,<br>        ]<br>        process = subprocess.run(<br>            command, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=<span class="hljs-literal">True</span><br>        )<br>        f.write(process.stdout)<br>        <span class="hljs-keyword">if</span> process.returncode != <span class="hljs-number">0</span>:<br>            f.write(<span class="hljs-string">&quot; &quot;</span>.join(command) + <span class="hljs-string">&quot;\n&quot;</span>)<br>            f.write(process.stderr)<br>            <span class="hljs-keyword">raise</span> Exception(<br>                <span class="hljs-string">f&quot;run peek failed at <span class="hljs-subst">&#123;reachable_file&#125;</span> with <span class="hljs-subst">&#123;threads&#125;</span> threads&quot;</span><br>            )<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(LOG_FILE, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(<span class="hljs-string">&quot;test start\n&quot;</span>)<br><br>    <span class="hljs-comment"># compile_make_csr()</span><br>    <span class="hljs-comment"># compile_make_reachable_src_dest()</span><br>    compile_util(MAKE_CSR_COMMAND, <span class="hljs-string">&quot;./tools&quot;</span>)<br>    compile_util(REACHABLE_COMMAND, <span class="hljs-string">&quot;./tools&quot;</span>)<br><br>    vertices_num = <span class="hljs-number">100</span><br>    <span class="hljs-keyword">while</span> vertices_num &lt;= MAX_VERTICES_NUM:<br>        max_edges_num = get_max_edges_num(vertices_num)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;vertices_num&#125;</span>, <span class="hljs-subst">&#123;max_edges_num&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">for</span> edges_num <span class="hljs-keyword">in</span> np.linspace(vertices_num * <span class="hljs-number">2</span>, max_edges_num - vertices_num, <span class="hljs-number">10</span>):<br>            edges_num = <span class="hljs-built_in">int</span>(edges_num)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\t<span class="hljs-subst">&#123;vertices_num&#125;</span>, <span class="hljs-subst">&#123;edges_num&#125;</span>&quot;</span>)<br>            graph_file = gen_vertex_edge_pair(vertices_num, edges_num)<br>            begin_file, csr_file, val_file = convert_graph_to_csr(graph_file)<br>            reachable_file = gen_reachable_pairs(begin_file, csr_file, val_file)<br>            run_peek_with_threads(begin_file, csr_file, val_file, reachable_file, <span class="hljs-number">1</span>)<br>            run_peek_with_threads(begin_file, csr_file, val_file, reachable_file, <span class="hljs-number">16</span>)<br><br>        vertices_num *= <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><!--https://lingkang.dev/2024/08/09/read-paper-peek/-->]]></content>
    
    
    <categories>
      
      <category>Paper Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>C Plus Plus</tag>
      
      <tag>Sparsity</tag>
      
      <tag>Pruning</tag>
      
      <tag>Graph</tag>
      
      <tag>KSP</tag>
      
      <tag>CSR</tag>
      
      <tag>Sparse Graph</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Paper Notes: Bitcask Key-Value Storage</title>
    <link href="/2024/03/26/read-paper-bitcask/"/>
    <url>/2024/03/26/read-paper-bitcask/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Paper-Notes-Bitcask-Key-Value-Storage"><a href="#Paper-Notes-Bitcask-Key-Value-Storage" class="headerlink" title="Paper Notes: Bitcask Key-Value Storage"></a>Paper Notes: Bitcask Key-Value Storage</h1><blockquote><p>J. Sheehy and D. Smith. Bitcask: A Log-Structured Hash Table for Fast Key&#x2F;Value Data. <em>Basho White Paper</em>, 2010. <a href="https://riak.com/assets/bitcask-intro.pdf">https://riak.com/assets/bitcask-intro.pdf</a></p></blockquote><p>A good storage engine should provide, as I quote from the paper:</p><blockquote><ul><li>low latency per item read or written</li><li>high throughput, especially when writing an incoming stream of random items</li><li>ability to handle datasets much larger than RAM without degradation</li><li>crash friendliness, both in terms of fast recovery and not losing data</li><li>ease of backup and restore</li><li>a relatively simple, understandable (and thus supportable) code structure and data format</li><li>predictable behavior under heavy access load or large volume</li></ul></blockquote><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://riak.com/assets/bitcask-intro.pdf">bitcask-intro.pdf</a></li><li><a href="https://hemantkgupta.medium.com/insights-from-paper-bitcask-a-log-structured-hash-table-for-fast-key-value-data-6fdddd9e6681">Insights from Paper â€” Bitcask : A Log-Structured Hash Table for Fast Key&#x2F;Value Data | by Hemant Gupta | Medium</a></li><li><a href="https://distributed-computing-musings.com/2023/01/paper-notes-bitcask-a-log-structured-hash-table-for-fast-key-value-data/">Paper Notes: Bitcask â€“ A Log-Structured Hash Table for Fast Key&#x2F;Value Data â€“ Distributed Computing Musings</a></li><li><a href="https://arpitbhayani.me/blogs/bitcask/#:~:text=The%20paper%20that%20introduced%20Bitcask,position%20of%20its%20log%20entry.">Understanding Bitcask - A Log-Structured fast KV store</a></li><li><a href="https://scholar.harvard.edu/files/stratos/files/keyvaluestorageengines.pdf">Key-Value Storage Engines</a></li><li><a href="http://www.xinzhuxiansheng.com/articleDetail/85">Bitcaskè®ºæ–‡ï¼ˆA Log-Structured Hash Table for Fast Key&#x2F;Value Dataï¼‰ _é˜¿æ´‹ blog</a></li><li><a href="https://highscalability.com/riaks-bitcask-a-log-structured-hash-table-for-fast-keyvalue/">Riakâ€™s Bitcask - A Log-Structured Hash Table for Fast Key&#x2F;ValueÂ Data - High Scalability -</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Paper Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Bitcask</tag>
      
      <tag>Key-Value Storage</tag>
      
      <tag>Database</tag>
      
      <tag>Storage Engine</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Implement RPC demo from scratch</title>
    <link href="/2024/01/08/rpc/"/>
    <url>/2024/01/08/rpc/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Implement-RPC-demo-from-scratch"><a href="#Implement-RPC-demo-from-scratch" class="headerlink" title="Implement RPC demo from scratch"></a>Implement RPC demo from scratch</h1><p>Remote Procedure Call (RPC) is a protocol that one program can call another programâ€™s service via network. It is a way to make distributed system easier to use.</p><p>The core idea of RPC is all about calling a function provided by a remote server. The client side calls a function, and the server side executes the function and returns the result to the client side.</p><pre><code class=" mermaid">sequenceDiagram    activate Client    loop        Client -&gt;&gt; Server: send request        deactivate Client        activate Server        Server -&gt;&gt; Client: send response        activate Client        deactivate Server    end    activate Client    deactivate Client</code></pre><p>The source code can be found on GitHub: <a href="https://github.com/LingkKang/rpc_demo">LingkKang&#x2F;rpc_demo</a>.</p><p>The documentation of client side is available at <a href="https://lingkang.dev/rpc_demo/client/index.html">lingkang.dev&#x2F;rpc_demo</a>.</p><h2 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h2><p>The design of RPC is simple. The client side calls a function, and the server side executes the function and returns the result to the client side.</p><p>In this small demo, I plan to set the task as calculating the hypotenuse of a right triangle. The client side sends the length of the two sides of the triangle, and the server side calculates the hypotenuse and returns the result to the client side. All of them are denoted as <a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format">float64</a>.</p><p>Next step is to design the interface of the RPC, i.e., the message used for communication between client and server. The design is simple and not considering scalability and security issue.</p><p>I did not use JSON or XML for the message format, as parsing them will require 3rd party libraries. Instead, I used raw binary format. The message format is as follows:</p><div style="margin: 0 auto; width: fit-content;"><table><thead><tr><th align="left">component</th><th align="center">size (bits)</th></tr></thead><tbody><tr><td align="left">message type</td><td align="center">2</td></tr><tr><td align="left">message length</td><td align="center">6</td></tr><tr><td align="left">message payload</td><td align="center">0 - 62 bytes</td></tr><tr><td align="left">message checksum</td><td align="center">8</td></tr></tbody></table></div><p>And there are 3 types of messages:</p><div style="margin: 0 auto; width: fit-content;"><table><thead><tr><th align="center">Bits</th><th align="center">Type</th></tr></thead><tbody><tr><td align="center"><code>0b00</code></td><td align="center">Error</td></tr><tr><td align="center"><code>0b01</code></td><td align="center">Request</td></tr><tr><td align="center"><code>0b10</code></td><td align="center">Response</td></tr><tr><td align="center"><code>0b11</code></td><td align="center"><em>Reserved</em></td></tr></tbody></table></div><p>See the documentation of <a href="https://lingkang.dev/rpc_demo/client/protocol/message/index.html"><code>client::protocol::message</code></a> for more details.</p><h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>There are lots of RPC frameworks available, but implementing it from scratch is a good way to understand how it works.</p><p>As described above, the code will be divided into two parts: client side and server side. Source code is available on GitHub: <a href="https://github.com/LingkKang/rpc_demo">LingkKang&#x2F;rpc_demo</a>.</p><h2 id="Remote-development"><a href="#Remote-development" class="headerlink" title="Remote development"></a>Remote development</h2><p>The server side in Go was developed on an Aliyun remote server, and the client side in Rust was developed on a local machine.</p><p>VS Code with remote development extension was really helpful for this. The latency is almost intangible, and the experience is almost the same as developing on a local machine.</p><p>If you see the commit history in graph, you will see that server and client were developed in parallel, but interactively.</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="https://www.hpcs.cs.tsukuba.ac.jp/~tatebe/lecture/h23/dsys/dsd-tutorial.html">Introduction to Distributed System Design - Google Code University - Google Code</a></li><li><a href="https://pkg.go.dev/net/rpc">rpc package - net&#x2F;rpc - Go Packages</a></li><li><a href="https://github.com/google/tarpc">google&#x2F;tarpc: An RPC framework for Rust with a focus on ease of use.</a></li><li><a href="https://grpc.io/">gRPC</a></li><li><a href="https://code.visualstudio.com/docs/remote/remote-overview">Visual Studio Code Remote Development</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack">Remote Development - Visual Studio Marketplace</a></li><li><a href="https://dl.acm.org/doi/10.1145/2080.357392">Implementing remote procedure calls | ACM Transactions on Computer Systems</a></li><li><a href="https://www.cs.ubc.ca/~bestchai/teaching/cs416_2021w2/lectures/lecture-jan18.pdf">Remote Procedure Calls (RPC) | 416 Distributed Systems</a></li><li><a href="http://nil.csail.mit.edu/6.5840/2023/notes/l-rpc.txt">RPC and Threads | 6.5840 Distributed Systems</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Operating System &amp; Architecture</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Go</tag>
      
      <tag>Distributed System</tag>
      
      <tag>RPC</tag>
      
      <tag>TCP</tag>
      
      <tag>Rust</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Post-Mortem Analysis for Multiprocessing Program in C</title>
    <link href="/2023/12/03/core-dump/"/>
    <url>/2023/12/03/core-dump/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Post-Mortem-Analysis-for-Multiprocessing-Program-in-C"><a href="#Post-Mortem-Analysis-for-Multiprocessing-Program-in-C" class="headerlink" title="Post-Mortem Analysis for Multiprocessing Program in C"></a>Post-Mortem Analysis for Multiprocessing Program in C</h1><p>When a program crashes, sometimes there would be a <em>core dumped</em> message.</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs txt">make: *** [Makefile:33: run] Segmentation fault (core dumped)<br></code></pre></td></tr></table></figure><p>This core dump file is extremely useful for post-mortem analysis.</p><h2 id="Enable-Core-Dump"><a href="#Enable-Core-Dump" class="headerlink" title="Enable Core Dump"></a>Enable Core Dump</h2><p>Here is how to enable core dump on <em>CentOS</em>.</p><h3 id="Set-ulimit"><a href="#Set-ulimit" class="headerlink" title="Set ulimit"></a>Set <code>ulimit</code></h3><p>If the value of <code>ulimit -c</code> is <code>0</code>, then core dump is disabled.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ulimit</span> -c unlimited<br></code></pre></td></tr></table></figure><p>This operation only affect current shell session, so better to add it to usersâ€™ <code>.bashrc</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;ulimit -c unlimited&#x27;</span> &gt;&gt; ~/.bashrc<br></code></pre></td></tr></table></figure><h3 id="Config-dumped-files-location"><a href="#Config-dumped-files-location" class="headerlink" title="Config dumped files location"></a>Config dumped files location</h3><p>On <em>CentOS</em>, the default core dump destination is defined in <code>/proc/sys/kernel/core_pattern</code>, which will require <code>sudo</code> permission to modify.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;dumps/core.%e.%t.%p&#x27;</span> | sudo <span class="hljs-built_in">tee</span> /proc/sys/kernel/core_pattern<br></code></pre></td></tr></table></figure><p>Here we set the dumped file located in <code>dumps</code> directory of current working directory, with filename as <code>core.%e.%t.%p</code>. The placeholdersâ€™ meaning:</p><ul><li><code>%e</code>: name of the executable</li><li><code>%t</code>: timestamp of dumping, in seconds since <a href="https://man.archlinux.org/man/time.7.en#The_Epoch">the UNIX Epoch</a></li><li><code>%p</code>: process ID of the task</li></ul><div class="note note-info">            <p>Inside a Docker container, the <code>/proc/sys/kernel/core_pattern</code> is <em>Read-Only</em>. This is because Docker on Windows uses WSL2 as backend. So simply change it in WSL2 would work. However, this might be flushed after reboot. </p>          </div><!-- To make it permanent, add the following line to `/etc/sysctl.conf`: --><!-- ``` bash --><!-- kernel.core_pattern = dumps/core.%e.%t.%p --><!-- ``` --><h2 id="Analyze-Core-Dump"><a href="#Analyze-Core-Dump" class="headerlink" title="Analyze Core Dump"></a>Analyze Core Dump</h2><p>Now that core dump is enabled, we can use <code>gdb</code> to analyze a crashed programâ€™s exiting state.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gdb &lt;executable&gt; &lt;core dump file&gt;<br></code></pre></td></tr></table></figure><p>Here are some useful commands:</p><ul><li><code>bt</code>: backtrace, show the stack trace</li><li><code>info locals</code>: show the local variables of current stack frame</li><li><code>frame &lt;frame id&gt;</code> or <code>f &lt;frame id&gt;</code>: switch to a specific stack frame which is shown in backtrace</li><li><code>list</code>: show the source code of current stack frame</li></ul><h3 id="POSIX-Threads"><a href="#POSIX-Threads" class="headerlink" title="POSIX Threads"></a>POSIX Threads</h3><ul><li><code>info threads</code>: show all threadsâ€™ information, current thread is marked with <code>*</code></li><li><code>thread &lt;thread id&gt;</code>: switch to a specific thread</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gdb">(gdb) info threads<br>  Id   Target Id         Frame<br>  4    Thread 0x7f9f675be700 (LWP 9983) pthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185  <br>* 3    Thread 0x7f9f685c0700 (LWP 9981) __lll_lock_wait () at ../nptl/sysdeps/unix/sysv/linux/x86_64/lowlevellock.S:135<br>  2    Thread 0x7f9f68dc4740 (LWP 9980) 0x00007f9f68998017 in pthread_join (threadid=140322627389184, thread_return=0x0) at pthread_join.c:90<br>  1    ...<br></code></pre></td></tr></table></figure><h4 id="Mutex"><a href="#Mutex" class="headerlink" title="Mutex"></a>Mutex</h4><p>If a thread is stuck at <code>__lll_lock_wait()</code> function, then it is waiting for a mutex.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gdb">(gdb) bt<br>#0  __lll_lock_wait () at ../nptl/sysdeps/unix/sysv/linux/x86_64/lowlevellock.S:135<br>#1 ...<br></code></pre></td></tr></table></figure><p>Use <code>p (pthread_mutex_t) &lt;mutex&gt;</code> to print a mutexâ€™s value.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gdb">(gdb) p (pthread_mutex_t) my_mutex<br>$0 = &#123;__data = &#123;__lock = 2, __count = 0, __owner = 9982, __nusers = 1, __kind = 0, __spins = 0, __elision = 0, __list = &#123;__prev = 0x0,<br>      __next = 0x0&#125;&#125;, __size = &quot;\002\000\000\000\000\000\000\000\376&amp;\000\000\001&quot;, &#x27;\000&#x27; &lt;repeats 26 times&gt;, __align = 2&#125;<br></code></pre></td></tr></table></figure><ul><li><code>__owner</code>: the ID of the thread who locks the mutex at the moment</li><li><code>__nusers</code>: the number of threads who are waiting for the mutex</li><li><code>__kind</code>: the type of the mutex, <code>0</code> stands for <code>PTHREAD_MUTEX_NORMAL</code></li></ul><h4 id="Condition-Variable"><a href="#Condition-Variable" class="headerlink" title="Condition Variable"></a>Condition Variable</h4><p>If a thread is stuck at <code>pthread_cond_wait()</code> function, then it is waiting for a condition variable.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gdb">(gdb) bt<br>#0  pthread_cond_wait@@GLIBC_2.3.2 () at ../nptl/sysdeps/unix/sysv/linux/x86_64/pthread_cond_wait.S:185<br>#1  ...<br></code></pre></td></tr></table></figure><p>Similarly, use <code>p (pthread_cond_t) &lt;cond&gt;</code> to print a condition variableâ€™s value.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gdb">(gdb) p (pthread_cond_t) my_cond1<br>$20 = &#123;__data = &#123;__lock = 0, __futex = 0, __total_seq = 0, __wakeup_seq = 0, __woken_seq = 0, __mutex = 0x0, __nwaiters = 0, <br>    __broadcast_seq = 0&#125;, __size = &#x27;\000&#x27; &lt;repeats 47 times&gt;, __align = 0&#125;<br>(gdb) p (pthread_cond_t) my_cond2<br>$21 = &#123;__data = &#123;__lock = 0, __futex = 1, __total_seq = 1, __wakeup_seq = 0, __woken_seq = 0, __mutex = 0x603160 &lt;my_mutex2&gt;, <br>    __nwaiters = 2, __broadcast_seq = 0&#125;,<br>  __size = &quot;\000\000\000\000\001\000\000\000\001&quot;, &#x27;\000&#x27; &lt;repeats 23 times&gt;, &quot;`1`\000\000\000\000\000\002\000\000\000\000\000\000&quot;,     <br>  __align = 4294967296&#125;<br></code></pre></td></tr></table></figure><h2 id="Analyze-Deadlocked-Program"><a href="#Analyze-Deadlocked-Program" class="headerlink" title="Analyze Deadlocked Program"></a>Analyze Deadlocked Program</h2><p>Even though this post is mainly about analyzing core dump, here is a short tip when a running program is deadlocked.</p><blockquote><p>Replace the <code>&lt;pid&gt;</code> with the process ID of the program, which can be found by <code>top</code> command.</p></blockquote><ol><li>Use <code>gdb --pid &lt;pid&gt;</code> to attach to the program and debug as usual.</li><li>Save the current state of the program as a core dump file.<ol><li>Use <code>gcore</code> or <code>gcore &lt;name&gt;</code> to save the core when inside <code>gdb</code>.</li><li>Use <code>gcore &lt;pid&gt;</code> or <code>gcore -o &lt;name&gt; &lt;pid&gt;</code> to dump the core when in shell.</li></ol></li></ol><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://wiki.archlinux.org/title/Core_dump">Core dump - ArchWiki</a></li><li><a href="https://www.educative.io/answers/what-is-a-core-dump">What is a core dump?</a></li><li><a href="https://cloud.redhat.com/blog/a-guide-to-core-dump-handling-in-openshift">A Guide toÂ Core Dump Handling in OpenShift</a></li><li><a href="https://man7.org/linux/man-pages/man5/core.5.html">core(5) - Linux manual page</a></li><li><a href="https://en.wikipedia.org/wiki/Core_dump">Core dump - Wikipedia</a></li><li><a href="https://man.archlinux.org/man/time.7.en#The_Epoch">time(7) â€” Arch manual pages</a></li><li><a href="https://pubs.opengroup.org/onlinepubs/7908799/xsh/pthread.h.html">&lt;pthread.h&gt;</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Programming Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C</tag>
      
      <tag>Docker</tag>
      
      <tag>CentOS</tag>
      
      <tag>Core Dump</tag>
      
      <tag>GDB</tag>
      
      <tag>Debug</tag>
      
      <tag>Deadlock</tag>
      
      <tag>Mutex</tag>
      
      <tag>Condition Variable</tag>
      
      <tag>Pthread</tag>
      
      <tag>POSIX</tag>
      
      <tag>WSL2</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OSC Lab Task 5 Reasoning</title>
    <link href="/2023/11/01/osc-lab-task5/"/>
    <url>/2023/11/01/osc-lab-task5/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="OSC-Lab-Task-5-Reasoning"><a href="#OSC-Lab-Task-5-Reasoning" class="headerlink" title="OSC Lab Task 5 Reasoning"></a>OSC Lab Task 5 Reasoning</h1><div class="note note-secondary">            <p>This post is my version of analysis of OSC lab task 5. The full task sheet can be found <u><a href="/files/osc-labs.pdf">here</a></u>. Check the <u><a href="#Appendix">appendix</a></u> for source code and output csv files.</p>          </div><h2 id="Task-5"><a href="#Task-5" class="headerlink" title="Task 5"></a>Task 5</h2><p>By running task 5 source code <code>task5.c</code> and visualization code <code>vis.py</code>, we can get visual result of process scheduling.</p><p>The following result is based on <code>1</code> second of experiment duration and <code>8</code> processes, output files are named as <code>&lt;pid&gt;.tmp.csv</code> call python script as <code>python vis.py &lt;min_pid&gt; &lt;max_pid&gt;</code> to get the visualization.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">define</span> NUMBER_OF_PROCESSES 8</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EXPERIMENT_DURATION 1</span><br></code></pre></td></tr></table></figure><p>Note that using <code>stdout</code> or <code>stdout</code> with redirection may harm the output format, so we write them to files respectively to keep consistency.</p><p><img src="/images/osc_lab_task5/1.png" alt="First view"></p><p>We can clearly see that even within one second, all of the processes are scheduled massively and rapidly, making the plotted dots look like lines.</p><p><img src="/images/osc_lab_task5/2.png" alt="Zoom in"></p><p>Zoom in the figure, we can find out that these lines are actually composed by dashed lines with various length. This verified that during the running time, processes are scheduled in a time-sharing manner.</p><p><img src="/images/osc_lab_task5/3.png" alt="Zoom in further"></p><p>However, things are not so simple as we thought. When we zoom in further, we can see that some dashes have overlaps on their running time, this is what we are expecting because only one process can run at one time. This is because there is more than one CPU core &#x2F; hardware threads. Actually, take a closer look at the following figure, we can see that at time <code>372079</code>, the running process was changed from pid <code>258</code> to pid <code>260</code>, while process <code>259</code> keeps running throughout the context switch.</p><p><img src="/images/osc_lab_task5/4.png" alt="Closer to see dots and overlaps"></p><p>For example, we can see that process <code>259</code> was scheduled since time <code>372036</code>, and ran until time <code>372097</code>, at least <code>61</code> microseconds in total.Then it was preempted by process <code>254</code> at time <code>372101</code>. A <code>4</code> microseconds of context switch cost is reasonable.</p><p><img src="/images/osc_lab_task5/5.png" alt="From time &lt;code&gt;372075&lt;/code&gt; to &lt;code&gt;372082&lt;/code&gt;"></p><p>Even though every microsecond there are multiple printed lines, as their printed time is same, they are plotted on the figure as a single dot. (A zip archive of <code>csv</code> used for this analysis, ranging from pid <code>251</code> to <code>260</code>, can be found at the <a href="#csv">appendix - CSV</a>.) We can simply say that microsecond is still not the best granularity to this experiment, or in other words, modern CPUs are too fast to be measured.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://wiki.linuxfoundation.org/realtime/documentation/technical_basics/sched_policy_prio/start">realtime:documentation:technical_basics:sched_policy_prio:start [Wiki]</a></li></ol><h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><h3 id="C"><a href="#C" class="headerlink" title="C"></a>C</h3><p>The following C program is used to generate the result of task 5.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">/*</span><br><span class="hljs-comment">Some simple results with explanation are at ./README.md</span><br><span class="hljs-comment">*/</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> NUMBER_OF_PROCESSES 8</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> MAX_EXPERIMENT_DURATION 1</span><br><br><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-literal">false</span>,<br>    <span class="hljs-literal">true</span><br>&#125; <span class="hljs-type">bool</span>;<br><br><span class="hljs-type">long</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDifferenceInMilliSeconds</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> timeval start, <span class="hljs-keyword">struct</span> timeval end)</span><br>&#123;<br>    <span class="hljs-type">int</span> seconds = end.tv_sec - start.tv_sec;<br>    <span class="hljs-type">int</span> useconds = end.tv_usec - start.tv_usec;<br>    <span class="hljs-type">int</span> mtime = (seconds * <span class="hljs-number">1000</span> + useconds / <span class="hljs-number">1000.0</span>);<br>    <span class="hljs-keyword">return</span> mtime;<br>&#125;<br><br><span class="hljs-type">long</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDifferenceInMicroSeconds</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> timeval start, <span class="hljs-keyword">struct</span> timeval end)</span><br>&#123;<br>    <span class="hljs-type">int</span> seconds = end.tv_sec - start.tv_sec;<br>    <span class="hljs-type">int</span> useconds = end.tv_usec - start.tv_usec;<br>    <span class="hljs-type">int</span> mtime = (seconds * <span class="hljs-number">1000000</span> + useconds);<br>    <span class="hljs-keyword">return</span> mtime;<br>&#125;<br><br><span class="hljs-type">bool</span> <span class="hljs-title function_">exceedDuration</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> timeval start, <span class="hljs-keyword">struct</span> timeval end)</span><br>&#123;<br>    <span class="hljs-keyword">if</span> (getDifferenceInMilliSeconds(start, end) &gt; MAX_EXPERIMENT_DURATION * <span class="hljs-number">1000</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-comment">// get the base time</span><br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeval</span> <span class="hljs-title">startTime</span>;</span><br>    gettimeofday(&amp;startTime, <span class="hljs-literal">NULL</span>);<br><br>    <span class="hljs-type">int</span> i;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">timeval</span> <span class="hljs-title">currentTime</span>;</span><br>    <span class="hljs-type">pid_t</span> pid;<br>    <span class="hljs-keyword">for</span> (; i &lt; NUMBER_OF_PROCESSES; i++)<br>    &#123;<br>        pid = fork();<br>        <span class="hljs-keyword">if</span> (pid &lt; <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;fork error\n&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pid == <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">    IO may be disturbed by context switching, especially with stdout redirecting.</span><br><span class="hljs-comment">    Save the output to their own output file respectively, named with their pids.</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-type">char</span> file_name[<span class="hljs-number">15</span>];<br>    <span class="hljs-built_in">sprintf</span>(file_name, <span class="hljs-string">&quot;%d.tmp.csv&quot;</span>, getpid());<br>    FILE *f_ptr = fopen(file_name, <span class="hljs-string">&quot;w&quot;</span>);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>    &#123;<br>        gettimeofday(&amp;currentTime, <span class="hljs-literal">NULL</span>);<br>        <span class="hljs-built_in">fprintf</span>(<br>            f_ptr, <span class="hljs-string">&quot;%ld, %d\n&quot;</span>,<br>            getDifferenceInMicroSeconds(startTime, currentTime),<br>            getpid());<br>        <span class="hljs-keyword">if</span> (exceedDuration(startTime, currentTime))<br>        &#123;<br>            fclose(f_ptr);<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// gcc task5.c -o a.out -Wall</span><br><span class="hljs-comment">// ./a.out</span><br></code></pre></td></tr></table></figure><h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>The following python script is used to visualize the result of task 5.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">Handle the visualization of the process scheduling in task 5</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">from</span> matplotlib <span class="hljs-keyword">import</span> pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    argc = <span class="hljs-built_in">len</span>(sys.argv)<br>    <span class="hljs-comment"># argv[1] == &lt;min_pid&gt;</span><br>    <span class="hljs-comment"># argv[2] == &lt;max_pid&gt;</span><br>    <span class="hljs-keyword">assert</span> argc == <span class="hljs-number">3</span>, <span class="hljs-string">&quot;Usage: python vis.py &lt;min_pid&gt; &lt;max_pid&gt;&quot;</span><br><br>    min_pid = <span class="hljs-built_in">int</span>(sys.argv[<span class="hljs-number">1</span>])<br>    max_pid = <span class="hljs-built_in">int</span>(sys.argv[<span class="hljs-number">2</span>])<br>    df = pd.DataFrame(columns=[<span class="hljs-string">&quot;time&quot;</span>, <span class="hljs-string">&quot;process&quot;</span>])<br><br>    <span class="hljs-keyword">for</span> pid <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(min_pid, max_pid + <span class="hljs-number">1</span>):<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-built_in">str</span>(pid) + <span class="hljs-string">&quot;.tmp.csv&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            csv = pd.read_csv(<br>                f,<br>                header=<span class="hljs-literal">None</span>,<br>                names=[<span class="hljs-string">&quot;time&quot;</span>, <span class="hljs-string">&quot;process&quot;</span>],<br>            )<br>            df = pd.concat([df, csv])<br><br>    plt.scatter(df[<span class="hljs-string">&quot;time&quot;</span>].values, df[<span class="hljs-string">&quot;process&quot;</span>].values, s=<span class="hljs-number">1</span>)<br>    plt.xlabel(<span class="hljs-string">&quot;time&quot;</span>)<br>    plt.ylabel(<span class="hljs-string">&quot;process id&quot;</span>)<br>    plt.ylim(min_pid - <span class="hljs-number">1</span>, max_pid + <span class="hljs-number">1</span>)<br>    plt.xlim(<span class="hljs-built_in">min</span>(df[<span class="hljs-string">&quot;time&quot;</span>].values), <span class="hljs-built_in">max</span>(df[<span class="hljs-string">&quot;time&quot;</span>].values))<br>    plt.show()<br>    exit(<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><h3 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h3><p><a href="../assets/pid.zip">CSV files used for analysis</a></p>]]></content>
    
    
    <categories>
      
      <category>Operating System &amp; Architecture</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>C</tag>
      
      <tag>Linux</tag>
      
      <tag>task scheduling</tag>
      
      <tag>Visualization</tag>
      
      <tag>Round Robin</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Install Lean 3 on Windows</title>
    <link href="/2023/10/05/lean-inst-win/"/>
    <url>/2023/10/05/lean-inst-win/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Install-Lean-3-on-Windows"><a href="#Install-Lean-3-on-Windows" class="headerlink" title="Install Lean 3 on Windows"></a>Install Lean 3 on Windows</h1><p>If you follow the <a href="https://leanprover-community.github.io/install/windows.html">official installation guide on Windows</a>, Lean 4 will be installed automatically. However, if you want to install Lean 3 on Windows, you can follow the steps below.</p><p>These should be the minimum steps and I will try to keep them as clear as possible.</p><h2 id="Prerequisites"><a href="#Prerequisites" class="headerlink" title="Prerequisites"></a>Prerequisites</h2><p>I assume you have <a href="https://code.visualstudio.com/">Visual Studio Code</a> installed. (And possibly a web browser ðŸ¤·)</p><h2 id="1-Download-the-latest-release"><a href="#1-Download-the-latest-release" class="headerlink" title="1. Download the latest release"></a>1. Download the latest release</h2><p>Head to the <a href="https://github.com/leanprover-community/lean">Lean 3 repository on GitHub</a>, find the latest release, and download the <code>lean-&lt;version&gt;-windows.zip</code> file.</p><p>At the moment, the latest release is <a href="https://github.com/leanprover-community/lean/releases/tag/v3.51.1">Release v3.51.1</a>, so I will download <code>lean-3.51.1-windows.zip</code>.</p><p>There may be a warning that says â€œThis file is not commonly downloaded and may be dangerousâ€, Iâ€™m not sure why, but just keep downloading it. It should be safe as long as you are downloading it from the official repository.</p><p><img src="/../images/lean/lean-warn.png" alt="Download Lean 3"></p><div class="note note-primary">            <p>Lean 3 is no longer officially maintained, the version we downloaded here is the community one.</p><p>If you want to get the last official version, which was released in 2019, you can download it from <a href="https://github.com/leanprover/lean3/releases/tag/v3.4.2"><u>Release v3.4.2 Â· leanprover&#x2F;lean3</u></a>, the rest of the steps should be the same.</p>          </div><h2 id="2-Unzip-the-file"><a href="#2-Unzip-the-file" class="headerlink" title="2. Unzip the file"></a>2. Unzip the file</h2><p>Unzip the downloaded file to a directory of your choice. There should be three folders: <code>bin</code>, <code>include</code>, and <code>lib</code> respectively.</p><p>I stored them on my D drive, and also renamed the folder to <code>lean</code>. So now I have <code>D:\lean\bin</code>, <code>D:\lean\include</code>, and <code>D:\lean\lib</code>.</p><p>Optionally, you can test the <code>lean.exe</code> in the <code>bin</code> folder by running <code>.\lean.exe --version</code> in a command prompt or PowerShell:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell"><span class="hljs-built_in">PS</span> D:\lean&gt; <span class="hljs-built_in">cd</span> bin<br><span class="hljs-built_in">PS</span> D:\lean\bin&gt; ./lean <span class="hljs-literal">--version</span><br>Lean (version <span class="hljs-number">3.51</span>.<span class="hljs-number">1</span>, commit cce7990ea86a, Release)<br></code></pre></td></tr></table></figure><h2 id="3-Add-the-path-to-the-environment-variables"><a href="#3-Add-the-path-to-the-environment-variables" class="headerlink" title="3. Add the path to the environment variables"></a>3. Add the path to the environment variables</h2><p>Add the path to the <code>bin</code> folder to the <code>PATH</code> environment variable.</p><ol><li>On the lower left <strong>Start</strong> menu or <strong>search bar</strong>, type <code>env</code> and select <strong>Edit the system environment variables</strong>.</li><li>On the pop-up window, click the bottom right button <strong>Environment Variablesâ€¦</strong>.</li><li>On the <strong>System variables</strong> section, scroll down and find the <code>path</code> variable and double click it.</li><li>On the pop-up window, click the <strong>New</strong> button. You will need to input the path to <code>lean</code>â€˜s <code>bin</code> folder (Better to copy and paste it from the file explorer). In my case, it is <code>D:\lean\bin</code>.</li><li>Click <strong>OK</strong> on all the pop-up windows to save the changes.</li></ol><p>This change may take a few minutes to take effect (and terminals will not recognize <code>lean</code> until you close and reopen them), or you can simply restart your computer to make sure it works.</p><h2 id="4-Test-the-installation-optional"><a href="#4-Test-the-installation-optional" class="headerlink" title="4. Test the installation (optional)"></a>4. Test the installation (optional)</h2><p>Open a new command prompt or PowerShell window, and run <code>lean --version</code> again:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell">PowerShell <span class="hljs-number">7.3</span>.<span class="hljs-number">7</span><br><span class="hljs-built_in">PS</span> C:\Users\Lingkang&gt; lean <span class="hljs-literal">--version</span><br>Lean (version <span class="hljs-number">3.51</span>.<span class="hljs-number">1</span>, commit cce7990ea86a, Release)<br><span class="hljs-built_in">PS</span> C:\Users\Lingkang&gt; lean <span class="hljs-literal">--help</span><br>Lean (version <span class="hljs-number">3.51</span>.<span class="hljs-number">1</span>, commit cce7990ea86a, Release)<br>Miscellaneous:<br>  <span class="hljs-literal">--help</span> <span class="hljs-literal">-h</span>          display this message<br>  <span class="hljs-literal">--version</span> <span class="hljs-literal">-v</span>       display version number<br>  <span class="hljs-literal">--githash</span>          display the git commit hash number used to build this binary<br>  <span class="hljs-literal">--run</span>              executes the <span class="hljs-string">&#x27;main&#x27;</span> definition<br>...<br></code></pre></td></tr></table></figure><h2 id="5-Install-the-Lean-extension-for-VS-Code"><a href="#5-Install-the-Lean-extension-for-VS-Code" class="headerlink" title="5. Install the Lean extension for VS Code"></a>5. Install the Lean extension for VS Code</h2><p>At this point, you can use Lean 3 from the command prompt or PowerShell. However, if you want to use Lean 3 in VS Code, you will need to install the Lean extension for VS Code.</p><p>Open VS Code, navigate to the <strong>Extensions</strong> tab, and search for <code>lean</code>. Most of the time, the first result should be what we want. Click the <strong>Install</strong> button to install it.</p><p><img src="/../images/lean/lean-ext.png" alt="Lean Extension"></p><p>The extension is supposed to find the installed Lean 3 automatically.</p><h2 id="6-Done"><a href="#6-Done" class="headerlink" title="6. Done!"></a>6. Done!</h2><p>Up to now, the vanilla Lean 3 installation is done.</p><p>Create a new file with extension <code>.lean</code>, and you should see the Lean logo on the bottom-right corner of the window. Click it to start the Lean server if needed.</p><p>Try some basic Lean code:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Lean">#eval 1 + 1<br></code></pre></td></tr></table></figure><p>or </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Lean">#print &quot;Hello world!&quot;<br></code></pre></td></tr></table></figure><p>The <code>Lean Infoview</code> window should pop up to provide plenty of information about the code, including the result.</p><p><img src="/../images/lean/lean-done.png" alt="Lean 3 in VS Code"></p><h2 id="7-Add-project-manager-and-package-manager"><a href="#7-Add-project-manager-and-package-manager" class="headerlink" title="7. Add project manager and package manager"></a>7. Add project manager and package manager</h2><p>However, if you want to use importation in Lean 3, for example <code>import tactic</code>, it is rather difficult to configure.</p><p>Lean 3 uses <code>leanproject</code> as the project manager and <code>leanpkg</code> as the package manager.</p><h3 id="7-1-Get-leanproject"><a href="#7-1-Get-leanproject" class="headerlink" title="7.1. Get leanproject"></a>7.1. Get <code>leanproject</code></h3><p>The <code>leanproject</code> is written in Python and can be installed using <code>pip</code>. </p><ol><li>Have Python 3 installed (Python 3.7 or later is recommended);</li><li>Have <code>pip</code> installed by running <code>python -m pip install --upgrade pip</code> in a command prompt or PowerShell (<code>python</code> or <code>python3</code> doesnâ€™t matter, as long as it is your desired version from the last step);</li><li>run <code>pip3 install mathlibtools</code> to install <code>leanproject</code>;</li></ol><p>It is quite weird that the <code>leanproject</code> has name <code>mathlibtools</code> on PyPI, but it is the correct one.</p><p>Check the installation by running <code>leanproject --version</code>:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell"><span class="hljs-built_in">PS</span> E:\Code\Lean&gt; leanproject <span class="hljs-literal">--version</span><br>leanproject, version <span class="hljs-number">1.3</span>.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><div class="note note-info">            <p>For your information, here is the (outdated) official Lean 3 <code>mathlib</code> installation guide: <a href="https://leanprover-community.github.io/lean3/install/windows.html#installing-mathlib-supporting-tools"><u>Installing mathlib supporting tools</u></a>.</p>          </div><h3 id="7-2-Create-a-new-Lean-3-project"><a href="#7-2-Create-a-new-Lean-3-project" class="headerlink" title="7.2. Create a new Lean 3 project"></a>7.2. Create a new Lean 3 project</h3><p>Features such as importation is only available in Lean 3 projects. To create a new Lean 3 project, run <code>leanproject new &lt;project-name&gt;</code> in a command prompt or PowerShell.</p><p>Now go to a desired directory to create a new Lean 3 project. I will use <code>E:\Code\Lean</code> as an example. If you cannot get results similar to the following, proceed to <a href="#7-3-Troubleshooting">7.3. Troubleshooting</a>.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell"><span class="hljs-built_in">PS</span> E:\Code\Lean&gt; leanproject new proj<br>&gt; <span class="hljs-built_in">cd</span> proj<br>&gt; git init <span class="hljs-literal">-q</span><br>&gt; git checkout <span class="hljs-literal">-b</span> lean<span class="hljs-literal">-3</span>.<span class="hljs-number">51.1</span><br>Switched to a new branch <span class="hljs-string">&#x27;lean-3.51.1&#x27;</span><br>configuring proj <span class="hljs-number">0.1</span><br>Adding mathlib<br>mathlib: cloning https://github.com/leanprover<span class="hljs-literal">-community</span>/mathlib to _target/deps/mathlib<br>&gt; git clone https://github.com/leanprover<span class="hljs-literal">-community</span>/mathlib _target/deps/mathlib<br>Cloning into <span class="hljs-string">&#x27;_target/deps/mathlib&#x27;</span>...<br>remote: Enumerating objects: <span class="hljs-number">397855</span>, done.<br>remote: Counting objects: <span class="hljs-number">100</span>% (<span class="hljs-number">1072</span>/<span class="hljs-number">1072</span>), done.<br>remote: Compressing objects: <span class="hljs-number">100</span>% (<span class="hljs-number">333</span>/<span class="hljs-number">333</span>), done.<br>remote: Total <span class="hljs-number">397855</span> (delta <span class="hljs-number">898</span>), reused <span class="hljs-number">818</span> (delta <span class="hljs-number">736</span>), pack<span class="hljs-literal">-reused</span> <span class="hljs-number">396783</span><br>Receiving objects: <span class="hljs-number">100</span>% (<span class="hljs-number">397855</span>/<span class="hljs-number">397855</span>), <span class="hljs-number">221.91</span> MiB | <span class="hljs-number">13.97</span> MiB/s, done.<br>Resolving deltas: <span class="hljs-number">100</span>% (<span class="hljs-number">319147</span>/<span class="hljs-number">319147</span>), done.<br>Updating files: <span class="hljs-number">100</span>% (<span class="hljs-number">3572</span>/<span class="hljs-number">3572</span>), done.<br>&gt; git checkout <span class="hljs-literal">--detach</span> <span class="hljs-number">4</span>e976107aa81b41822bd5bb2b15c90b1c8a2aa15    <span class="hljs-comment"># in directory _target/deps/mathlib</span><br>HEAD is now at <span class="hljs-number">4</span>e976107aa feat(measure_theory/order/upper_lower): Order<span class="hljs-literal">-connected</span> sets <span class="hljs-keyword">in</span> `â„â¿` are measurable (<span class="hljs-comment">#16976)</span><br>configuring proj <span class="hljs-number">0.1</span><br>mathlib: trying to update _target/deps/mathlib to revision <span class="hljs-number">4</span>e976107aa81b41822bd5bb2b15c90b1c8a2aa15<br>&gt; git checkout <span class="hljs-literal">--detach</span> <span class="hljs-number">4</span>e976107aa81b41822bd5bb2b15c90b1c8a2aa15    <span class="hljs-comment"># in directory _target/deps/mathlib</span><br>HEAD is now at <span class="hljs-number">4</span>e976107aa feat(measure_theory/order/upper_lower): Order<span class="hljs-literal">-connected</span> sets <span class="hljs-keyword">in</span> `â„â¿` are measurable (<span class="hljs-comment">#16976)</span><br>Looking <span class="hljs-keyword">for</span> mathlib oleans <span class="hljs-keyword">for</span> <span class="hljs-number">4</span>e976107aa<br>  locally...<br>  Found local mathlib oleans<br>Located matching cache<br>Applying cache<br>  files extracted: <span class="hljs-number">3220</span> [<span class="hljs-number">00</span>:<span class="hljs-number">08</span>, <span class="hljs-number">379.06</span>/<span class="hljs-type">s</span>]<br></code></pre></td></tr></table></figure><p>From this output, we can see a few things:</p><ol><li>Initialized a new Lean project with <code>git</code>;</li><li>Cloned the whole <code>mathlib</code> repository;</li><li>Added <code>mathlib</code> as a dependency;</li><li>Load specified version pre-compiled <code>mathlib</code> (<code>olean</code> files);</li></ol><p>If every thing looks fine, we can now open the project in VS Code and start enjoying full-powered Lean 3.</p><p><img src="/../images/lean/lean-done-full.png" alt="Importing &lt;code&gt;tactic&lt;/code&gt; in Lean 3"></p><h3 id="7-3-Troubleshooting"><a href="#7-3-Troubleshooting" class="headerlink" title="7.3. Troubleshooting"></a>7.3. Troubleshooting</h3><p>In most cases, things wonâ€™t go so smoothly. If you failed to get the above output, for example:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell"><span class="hljs-built_in">PS</span> E:\Code\Lean&gt; leanproject new proj<br>FileNotFoundError: [<span class="hljs-type">WinError</span> <span class="hljs-number">2</span>] The system cannot find the file specified<br></code></pre></td></tr></table></figure><p>Here we directly head to resolve the issue, some thoughts over it could be found at <a href="#8-Appendix">8. Appendix</a>.</p><p>In side the <code>leanproject</code>, <code>leanpkg</code> is actually called for help, so we first verify that <code>leanpkg</code> is installed correctly. Run <code>leanpkg --version</code>:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell">PowerShell <span class="hljs-number">7.3</span>.<span class="hljs-number">9</span><br><span class="hljs-built_in">PS</span> C:\Users\Lingkang&gt; leanpkg <span class="hljs-literal">--version</span><br>Lean package manager, version <span class="hljs-number">3.51</span>.<span class="hljs-number">1</span><br><br>Usage: leanpkg &lt;command&gt;<br><br>...<br></code></pre></td></tr></table></figure><p>This should be runnable no matter what version of Lean 3 you are using, e.g., <code>v3.4.2</code> or <code>v3.51.1</code>. If not, double check your footprint from <a href="#1-Download-the-latest-release">step 1</a> to <a href="#3-Add-the-path-to-the-environment-variables">step 3</a>.</p><p>Navigate to the <code>bin</code> folder of <code>lean</code> (here it is <code>D:\lean\bin</code>), create a new file named <code>leanpkg.c</code> with the following content:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-type">char</span> command[<span class="hljs-number">500</span>];<br>    <span class="hljs-built_in">strcpy</span>(command, <span class="hljs-string">&quot;leanpkg.bat&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">1</span>; i &lt; argc; i++)<br>    &#123;<br>        <span class="hljs-built_in">strcat</span>(command, <span class="hljs-string">&quot; &quot;</span>);<br>        <span class="hljs-built_in">strcat</span>(command, argv[i]);<br>    &#125;<br>    system(command);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Compile it with output <code>leanpkg.exe</code>:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell">gcc leanpkg.c <span class="hljs-literal">-o</span> leanpkg.exe<br></code></pre></td></tr></table></figure><p>Now retry <a href="#7-2-Create-a-new-Lean-3-project">7.2. Create a new Lean 3 project</a> and it should work.</p><p>Here, we are basically <em>cheating</em> the python interpreter, see below for more details.</p><h2 id="8-Appendix"><a href="#8-Appendix" class="headerlink" title="8. Appendix"></a>8. Appendix</h2><p>Here are short explanations and some thoughts over the installation process.</p><h3 id="8-1-Causes"><a href="#8-1-Causes" class="headerlink" title="8.1. Causes"></a>8.1. Causes</h3><p>If we run <code>leanproject</code> with debug flag, the error stack is quite horrifying:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs PowerShell"><span class="hljs-built_in">PS</span> E:\Code\Lean&gt; leanproject <span class="hljs-literal">--debug</span> new proj<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\runpy.py&quot;</span>, line <span class="hljs-number">196</span>, <span class="hljs-keyword">in</span> _run_module_as_main<br>    <span class="hljs-keyword">return</span> _run_code(code, main_globals, None,<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\runpy.py&quot;</span>, line <span class="hljs-number">86</span>, <span class="hljs-keyword">in</span> _run_code<br>    exec(code, run_globals)<br>  File <span class="hljs-string">&quot;D:\Python3.10\Scripts\leanproject.exe\__main__.py&quot;</span>, line <span class="hljs-number">7</span>, <span class="hljs-keyword">in</span> &lt;<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\site-packages\mathlibtools\leanproject.py&quot;</span>, li<br>    handle_exception(err, str(err))<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\site-packages\mathlibtools\leanproject.py&quot;</span>, li<br>    raise exc<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\site-packages\mathlibtools\leanproject.py&quot;</span>, li<br>    <span class="hljs-built_in">cli</span>() <span class="hljs-comment"># pylint: disable=no-value-for-parameter</span><br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\site-packages\click\core.py&quot;</span>, line <span class="hljs-number">716</span>, <span class="hljs-keyword">in</span> __c<br>    <span class="hljs-keyword">return</span> self.main(*args, **kwargs)<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\site-packages\click\core.py&quot;</span>, line <span class="hljs-number">696</span>, <span class="hljs-keyword">in</span> mai<br>    <span class="hljs-built_in">rv</span> = self.invoke(ctx)<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\site-packages\click\core.py&quot;</span>, line <span class="hljs-number">1060</span>, <span class="hljs-keyword">in</span> <span class="hljs-keyword">in</span><br>    <span class="hljs-keyword">return</span> _process_result(sub_ctx.command.invoke(sub_ctx))<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\site-packages\click\core.py&quot;</span>, line <span class="hljs-number">889</span>, <span class="hljs-keyword">in</span> inv<br>    <span class="hljs-keyword">return</span> ctx.invoke(self.callback, **ctx.params)<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\site-packages\click\core.py&quot;</span>, line <span class="hljs-number">534</span>, <span class="hljs-keyword">in</span> inv<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\site-packages\mathlibtools\lib.py&quot;</span>, line <span class="hljs-number">700</span>, <span class="hljs-keyword">in</span> new<br>    subprocess.run([<span class="hljs-string">&#x27;leanpkg&#x27;</span>, <span class="hljs-string">&#x27;new&#x27;</span>, <span class="hljs-type">str</span>(<span class="hljs-type">path</span>)], check=True)<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\subprocess.py&quot;</span>, line <span class="hljs-number">501</span>, <span class="hljs-keyword">in</span> run<br>    with Popen(*popenargs, **kwargs) as <span class="hljs-keyword">process</span>:<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\subprocess.py&quot;</span>, line <span class="hljs-number">966</span>, <span class="hljs-keyword">in</span> __init__<br>    self._execute_child(args, executable, preexec_fn, close_fds,<br>  File <span class="hljs-string">&quot;D:\Python3.10\lib\subprocess.py&quot;</span>, line <span class="hljs-number">1435</span>, <span class="hljs-keyword">in</span> _execute_child<br>    hp, ht, pid, tid = _winapi.CreateProcess(executable, args,<br>FileNotFoundError: [<span class="hljs-type">WinError</span> <span class="hljs-number">2</span>] The system cannot find the file specified<br></code></pre></td></tr></table></figure><p>We can see that the error is caused by <code>subprocess.run([&#39;leanpkg&#39;, &#39;new&#39;, str(path)], check=True)</code> in <code>mathlibtools/lib.py</code>, and almost everywhere calling <code>leanpkg</code> will cause the same error.</p><p>Source: <a href="https://github.com/leanprover-community/mathlib-tools/blob/master/mathlibtools/lib.py">mathlib-tools&#x2F;mathlibtools&#x2F;lib.py at master Â· leanprover-community&#x2F;mathlib-tools</a></p><p>To abstract away irrelevant details, we can simplify the code to: </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> subprocess<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">args: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-keyword">return</span> subprocess.run(<br>        args, stdout=subprocess.PIPE, check=<span class="hljs-literal">False</span><br>    ).stdout.decode()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-built_in">print</span>(run([<span class="hljs-string">&quot;leanpkg&quot;</span>, <span class="hljs-string">&quot;--version&quot;</span>]))<br>    <span class="hljs-comment"># print(run([&quot;leanpkg.bat&quot;, &quot;--version&quot;]))</span><br></code></pre></td></tr></table></figure><p>Running it will cause the same error that we got from <code>leanproject</code>:</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stata">Traceback (most recent call last):<br>  <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;E:\Code\Lean\test.py&quot;</span>, <span class="hljs-keyword">line</span> 13, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-keyword">print</span>(<span class="hljs-keyword">run</span>([<span class="hljs-string">&quot;leanpkg&quot;</span>, <span class="hljs-string">&quot;--version&quot;</span>]))<br>  <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;E:\Code\Lean\test.py&quot;</span>, <span class="hljs-keyword">line</span> 6, <span class="hljs-keyword">in</span> <span class="hljs-keyword">run</span><br>    <span class="hljs-keyword">return</span> subprocess.<span class="hljs-keyword">run</span>(<br>  <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;D:\Python3.10\lib\subprocess.py&quot;</span>, <span class="hljs-keyword">line</span> 501, <span class="hljs-keyword">in</span> <span class="hljs-keyword">run</span><br>    with Popen(*popenargs, **kwargs) <span class="hljs-keyword">as</span> process:<br>  <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;D:\Python3.10\lib\subprocess.py&quot;</span>, <span class="hljs-keyword">line</span> 966, <span class="hljs-keyword">in</span> __init__<br>    self._execute_child(<span class="hljs-keyword">args</span>, executable, preexec_fn, close_fds,<br>  <span class="hljs-keyword">File</span> <span class="hljs-string">&quot;D:\Python3.10\lib\subprocess.py&quot;</span>, <span class="hljs-keyword">line</span> 1435, <span class="hljs-keyword">in</span> _execute_child<br>    hp, ht, pid, tid = _winapi.CreateProcess(executable, <span class="hljs-keyword">args</span>,<br>FileNotFoundError: [WinError 2] The system cannot find the <span class="hljs-keyword">file</span> specified<br></code></pre></td></tr></table></figure><p>And if we change it from <code>leanpkg</code> to <code>leanpkg.bat</code>, the snippet will work:</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">Lean package manager, <span class="hljs-keyword">version</span> 3.51.1<br><br>Usage: leanpkg &lt;<span class="hljs-keyword">command</span>&gt;<br><br><span class="hljs-string">...</span><br></code></pre></td></tr></table></figure><p>This is what happened: under the <code>bin</code> folder of <code>lean</code>, we can see that there are two <code>leanpkg</code> files: <code>leanpkg</code> and <code>leanpkg.bat</code>. The first one is a shell script (not sure why put a shell script in a Windows release), and the second one is CMD batch script. When we run <code>leanpkg --version</code> on the command prompt or PowerShell, Windows is smart enough to run the batch script. This can be verified by running <code>Get-Command leanpkg</code> in PowerShell, and the output will specify which file is used for the command.</p><div style="margin: 0 auto; width: fit-content;"><table><thead><tr><th align="center">CommandType</th><th align="center">Name</th><th align="center">Version</th><th align="center">Source</th></tr></thead><tbody><tr><td align="center">Application</td><td align="center">leanpkg.bat</td><td align="center">0.0.0.0</td><td align="center">D:\lean\bin\leanpkg.bat</td></tr></tbody></table></div><div class="note note-info">            <p>Both <code>Get-Command leanpkg</code> and <code>Get-Command leanpkg.bat</code> will return the same result.</p>          </div><p>However, when we run it in Python, it will try to find an executable exactly named as <code>leanpkg</code>, and it will fail. It can only success to it when we specify the extension <code>leanpkg.bat</code>.</p><h3 id="8-2-Solutions"><a href="#8-2-Solutions" class="headerlink" title="8.2. Solutions"></a>8.2. Solutions</h3><p>So the solution is quite simple, we can either:</p><ol><li>Change the Python source code to use <code>leanpkg.bat</code> instead of <code>leanpkg</code>;</li><li>Make a kind of mapping or alias that maps <code>leanpkg</code> to <code>leanpkg.bat</code>;</li><li>Create a new executable named <code>leanpkg</code> that calls <code>leanpkg.bat</code> under the hood;</li></ol><p>The first solution is quite straightforward, but modifying the source code might cause unexpected issues, and there are many places to modify.</p><p>The second solution may work, but in real experiment, techniques such as symbolic link or hard link do not help.</p><p>The Third solution, as what we did in <a href="#7-3-Troubleshooting">7.3. Troubleshooting</a>, is to create a new executable named <code>leanpkg.exe</code> that passes everything to <code>leanpkg.bat</code>. A little bit tricky.</p><h3 id="8-3-Questions"><a href="#8-3-Questions" class="headerlink" title="8.3. Questions"></a>8.3. Questions</h3><p>Even though this is a feasible way, I still not sure why the procedure would go so painful.</p><p>The <code>leanproject</code> (or <code>mathlibtools</code>) was marked obsolete just on August this year, and its CI tested on all major platforms, including Windows, with different Python versions from 3.7 to 3.11. There is no reason that it would be broken so soon.</p><p>And also, the transition from Lean 3 to Lean 4 sucks. The official site becomes a mixture of them, and toolchainsâ€™ documentation nearly not exist.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://leanprover-community.github.io/install/windows.html">Installing Lean 4 on Windows</a></li><li><a href="https://leanprover-community.github.io/lean3/install/windows.html">Installing Lean 3 and mathlib on Windows</a></li><li><a href="https://github.com/leanprover-community/lean">leanprover-community&#x2F;lean: Lean Theorem Prover</a></li><li><a href="https://leanprover-community.github.io/">Lean community</a></li><li><a href="https://learn.microsoft.com/en-us/previous-versions/office/developer/sharepoint-2010/ee537574%28v=office.14%29#to-add-a-path-to-the-path-environment-variable">How to: Add Tool Locations to the PATH Environment Variable | Microsoft Learn</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=jroesch.lean">lean - Visual Studio Marketplace</a></li><li><a href="https://github.com/leanprover/vscode-lean">leanprover&#x2F;vscode-lean: Extension for VS Code that provides support for the older Lean 3 language. Succeeded by vscode-lean4 (â€˜lean4â€™ in the extensions menu) for the Lean 4 language.</a></li><li><a href="https://lean-lang.org/reference/using_lean.html#using-the-package-manager">1. Using Lean â€” The Lean Reference Manual 3.3.0 documentation</a></li><li><a href="https://leanprover-community.github.io/lean3/toolchain.html">The Lean tool chain</a></li><li><a href="https://leanprover-community.github.io/lean3/leanproject.html">Using leanproject</a></li><li><a href="https://pypi.org/project/mathlibtools/">mathlibtools Â· PyPI</a></li><li><a href="https://github.com/leanprover-community/mathlib-tools">leanprover-community&#x2F;mathlib-tools: Development tools for https://github.com/leanprover-community/mathlib</a></li><li><a href="https://github.com/leanprover-community/mathlib">leanprover-community&#x2F;mathlib: Lean 3â€™s obsolete mathematical components library: please use mathlib4</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>VS Code</tag>
      
      <tag>Lean</tag>
      
      <tag>Windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Paper Notes: OPU - FPGA-Based Overlay Processor for CNNs</title>
    <link href="/2023/08/07/read-paper-1-yu/"/>
    <url>/2023/08/07/read-paper-1-yu/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Paper-Notes-OPU-FPGA-Based-Overlay-Processor-for-CNNs"><a href="#Paper-Notes-OPU-FPGA-Based-Overlay-Processor-for-CNNs" class="headerlink" title="Paper Notes: OPU - FPGA-Based Overlay Processor for CNNs"></a>Paper Notes: OPU - FPGA-Based Overlay Processor for CNNs</h1><h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p><strong>OPU: An FPGA-Based Overlay Processor for Convolutional Neural Networks</strong></p><p><strong>Authors</strong>: <a href="https://scholar.google.com/citations?user=udxQYH0AAAAJ">Yunxuan Yu</a>, Chen Wu, Tiandong Zhao, Kun Wang, Lei He</p><p><strong>Published in</strong>: TVLSI 2020 Jan.</p><p><strong>DOI</strong>: <a href="https://doi.org/10.1109/TVLSI.2019.2939726">10.1109&#x2F;TVLSI.2019.2939726</a></p><p><strong>Keywords</strong>: CNN overlay processor, FPGA acceleration, hardware-software codesign</p><h2 id="Background-amp-Problems"><a href="#Background-amp-Problems" class="headerlink" title="Background &amp; Problems"></a>Background &amp; Problems</h2><p>FPGA acceleration for CNNs -&gt; automatic compilers for FPGA CNN accelerators</p><ul><li>Can not achieve the best performance</li><li>Impossible for edge computing</li></ul><h2 id="Key-Ideas"><a href="#Key-Ideas" class="headerlink" title="Key Ideas"></a>Key Ideas</h2><p>RTL-based hand-coded FPGA overlay domain-specific processor unit (OPU) with software-programmability and fast compilation time, targeting at general CNN accelerations.</p><p><img src="https://ieeexplore.ieee.org/mediastore_new/IEEE/content/media/92/8945454/8863128/he1-2939726-large.gif" alt="OPU work flow"></p><p>Features:</p><ul><li>User friendliness like CPU&#x2F;GPU</li><li>Domain-specific ISA with optimized granularity: flexibility, efficiency and lower complexity</li><li>FPGA-based high-performance microarchitecture: computation, data communication and reorganization</li><li>Compiler with comprehensive optimization</li></ul><h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><h3 id="ISA"><a href="#ISA" class="headerlink" title="ISA"></a>ISA</h3><p>Conditional instructions (C-type)</p><p>Unconditional instructions (U-type)</p><pre><code class=" mermaid">flowchart LR    A[&quot;1 C-type&quot;]    B[&quot;1 to n U-type&quot;]    PE[&quot;1 Processing Element (PE)&lt;br&gt;module&quot;]    subgraph IB [Instruction Block]        subgraph IU [Instruction Unit]            A            B        end        subgraph IU1 [many instruction units]            C[Instructions]        end    end    IB --- PE</code></pre><p>One <em>instruction block</em> is fetched together and distributed to one <em>processing element</em> module.</p><h4 id="C-type"><a href="#C-type" class="headerlink" title="C-type"></a>C-type</h4><p>Specify target operations and set operation trigger conditions</p><ul><li>Operation code (OP code): target operation</li><li>trigger condition: when operation is ready to execute</li></ul><p>6 types in total:</p><ul><li>Memory Read</li><li>Memory Write</li><li>Data Fetch</li><li>Compute</li><li>Post Process: combination of pooling, activation, data quantization, intermediate result addition and residual operations</li><li>Instruction Read</li></ul><p>Each one corresponds to a dedicated operation module in the PE.</p><h4 id="U-type"><a href="#U-type" class="headerlink" title="U-type"></a>U-type</h4><p>Deliver corresponding operation parameters for its paired C-type</p><h3 id="Microarchitecture"><a href="#Microarchitecture" class="headerlink" title="Microarchitecture"></a>Microarchitecture</h3><p><strong>Overlay</strong>: reconfigurable architectures implemented on top of FPGAs. They are regular designs described using structural HDL, but have reconfigurable capabilities. They may be considered as â€œsoftcore FPGA IPs (<a href="https://en.wikipedia.org/wiki/Semiconductor_intellectual_property_core">Semiconductor intellectual property core</a>)â€. </p><h3 id="Compiler"><a href="#Compiler" class="headerlink" title="Compiler"></a>Compiler</h3><p>Do the following on input CNN configuration:</p><ul><li>Operation fusion</li><li>Network slicing</li><li>Throughput optimization</li></ul><p>Divided into two major stages: Translation and Optimization.</p><p>Extract necessary information from model definition files and reorganize them into a unified <strong>intermediate representation</strong> (<strong>IR</strong>)</p><ol><li>perform <strong>operation fusion</strong> to combine closely related operations.</li><li>perform data quantization (generate dynamic fixed-point representations)</li><li>perform network slicing</li><li>perform optimization</li><li>rearrange processed weights</li></ol><h4 id="Translation-Operation-Fusion"><a href="#Translation-Operation-Fusion" class="headerlink" title="Translation: Operation Fusion"></a>Translation: Operation Fusion</h4><p>merge or concatenate related layer operations</p><ol><li>p-fusion: only contributes to off-chip memory access reduction</li><li>r-fusion: <ul><li>avoids communication latency</li><li>reduces the total number of operations and inference time</li></ul></li></ol><p>Major layers: Convolution and Fully Connected (FC) layers</p><p>Affiliated layers: Pooling, Padding, Activation, Residual and Output Concatenation layers</p><p>r-fusion-I: batch normalization elimination, avoiding separate computation of batch normalization</p><p>r-fusion-II: input sharing, identifying input sharing layers and reassembling them</p><h4 id="Data-Quantization"><a href="#Data-Quantization" class="headerlink" title="Data Quantization"></a>Data Quantization</h4><p>Use <strong>dynamic quantization scheme</strong> to get 8-bit fixed-point values.</p><h4 id="Intermediate-Representation"><a href="#Intermediate-Representation" class="headerlink" title="Intermediate Representation"></a>Intermediate Representation</h4><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><p><strong>MAC</strong>: multiply and accumulate <a href="https://en.wikipedia.org/wiki/Multiply%E2%80%93accumulate_operation">Multiplyâ€“accumulate operation - Wikipedia</a></p><h2 id="Limitation"><a href="#Limitation" class="headerlink" title="Limitation"></a>Limitation</h2><hr><blockquote><p>Y. Yu, C. Wu, T. Zhao, K. Wang and L. He, â€œOPU: An FPGA-Based Overlay Processor for Convolutional Neural Networks,â€ in IEEE Transactions on Very Large Scale Integration (VLSI) Systems, vol. 28, no. 1, pp. 35-47, Jan. 2020, doi: 10.1109&#x2F;TVLSI.2019.2939726.</p></blockquote><div class="note note-warning">            <p>Unfinished</p>          </div><!--https://lingkkang.github.io/2023/08/06/read-paper-1-yu/-->]]></content>
    
    
    <categories>
      
      <category>Paper Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OPU</tag>
      
      <tag>OpenOPU</tag>
      
      <tag>FPGA</tag>
      
      <tag>CNN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Migrate GitLab from CentOS to Ubuntu on ECS</title>
    <link href="/2023/07/31/migrate-gitlab/"/>
    <url>/2023/07/31/migrate-gitlab/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Migrate-GitLab-from-CentOS-to-Ubuntu-on-ECS"><a href="#Migrate-GitLab-from-CentOS-to-Ubuntu-on-ECS" class="headerlink" title="Migrate GitLab from CentOS to Ubuntu on ECS"></a>Migrate GitLab from CentOS to Ubuntu on ECS</h1><p>In this post, we will migrate <a href="https://about.gitlab.com/">GitLab</a> from  <a href="https://wiki.centos.org/Manuals/ReleaseNotes/CentOS7.2009">CentOS <code>7.9</code></a> to <a href="https://wiki.ubuntu.com/FocalFossa/ReleaseNotes">Ubuntu <code>20.04</code> LTS</a> on Alibaba Cloud ECS (Elastic Compute Service), as <a href="https://www.centos.org/centos-linux-eol/">CentOS is EOL</a> and Ubuntu is more popular.</p><h2 id="Check-GitLab-Version"><a href="#Check-GitLab-Version" class="headerlink" title="Check GitLab Version"></a>Check GitLab Version</h2><p>As restore GitLab backup requires the same version of GitLab, we need to check current GitLab version. </p><p class="note note-info">You can only restore a backup to <strong>exactly the same version and type (CE/EE)</strong> of GitLab on which it was created (for example CE 15.1.4).</p><p>See <a href="https://docs.gitlab.com/ee/administration/backup_restore/restore_gitlab.html">Restore GitLab | GitLab</a>.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Console"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cat</span> /opt/gitlab/embedded/service/gitlab-rails/VERSION</span><br>15.9.0-ee<br></code></pre></td></tr></table></figure><p>Here we have <a href="https://about.gitlab.com/releases/2023/02/22/gitlab-15-9-released/">GitLab 15.9</a> Enterprise Edition installed, and on new server we will also install this version.</p><h2 id="Backup-GitLab"><a href="#Backup-GitLab" class="headerlink" title="Backup GitLab"></a>Backup GitLab</h2><p>By default, our GitLab Backup package is located at <code>/var/opt/gitlab/backups/</code>, this could be checked by <code>cat /etc/gitlab/gitlab.rb | grep backup</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">gitlab-rake gitlab:backup:create<br></code></pre></td></tr></table></figure><p>This command will automatically pack up all non-sensitive GitLab data, including repositories, database, configuration, etc. The backup package will be located at the directory mentioned before, with name such as <code>1690438526_2023_07_27_15.9.0-ee_gitlab_backup.tar</code>.</p><p>The file name contains the <a href="https://en.wikipedia.org/wiki/Unix_time">UNIX timestamp</a> and GitLab version.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Console"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">date</span> -d @1690438526</span><br>Thu Jul 27 14:15:26 CST 2023<br></code></pre></td></tr></table></figure><p>Additionally, we also need to pack up some sensitive data, <code>gitlab.rb</code> and <code>gitlab-secrets.json</code>, which are all located at <code>/etc/gitlab/</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo tar cvf gitlab-secrets.tar /etc/gitlab/gitlab.rb /etc/gitlab/gitlab-secrets.json<br></code></pre></td></tr></table></figure><p>This will create a tar file <code>gitlab-secrets.tar</code> in current directory.</p><p>Now we have all data needed to restore GitLab on new server. Here we only have one cloud server, so we simply download the backup packages via FTP to our local machine. It can also be transferred to new server via <code>scp</code>, secure copy.</p><h2 id="Install-GitLab-on-Ubuntu"><a href="#Install-GitLab-on-Ubuntu" class="headerlink" title="Install GitLab on Ubuntu"></a>Install GitLab on Ubuntu</h2><p>Simply follow the GitLab official installation guide on Ubuntu, but only first few steps. See <a href="https://about.gitlab.com/install/#ubuntu">Download and install GitLab | GitLab</a>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Bash">sudo apt update<br>sudo apt install -y curl openssh-server ca-certificates tzdata perl<br>sudo apt install -y postfix<br>curl https://packages.gitlab.com/install/repositories/gitlab/gitlab-ee/script.deb.sh | sudo bash<br>sudo EXTERNAL_URL=<span class="hljs-string">&quot;121.XXX.XXX.XXX&quot;</span> apt install gitlab-ee=15.9.0-ee.0<br></code></pre></td></tr></table></figure><p>Note that we specify the GitLab version to install, the version is just the same as the <a href="https://hub.docker.com/r/gitlab/gitlab-ee/tags">GitLab Docker image tag</a>, which is <a href="https://hub.docker.com/layers/gitlab/gitlab-ee/15.9.0-ee.0/images/sha256-267c6feedcdbd3c7c03e5bde335bc5033d53de8d6287553fac5b73ae2eb5db4c?context=explore">15.9.0-ee.0</a> here.</p><p>The <code>EXTERNAL_URL</code> is the public IP address or domain name of the server, which is used to access GitLab.</p><p>Also, remember to select <code>Internet Site</code> for postfix configuration, with value same as <code>EXTERNAL_URL</code> as the system mail name.</p><p>And now when we access to <code>EXTERNAL_URL</code>, we will see the GitLab login page.</p><h2 id="Restore-GitLab"><a href="#Restore-GitLab" class="headerlink" title="Restore GitLab"></a>Restore GitLab</h2><h3 id="Stop-GitLab-Service"><a href="#Stop-GitLab-Service" class="headerlink" title="Stop GitLab Service"></a>Stop GitLab Service</h3><p>Stop services that will read &#x2F; write to database, such as <code>sidekiq</code> and <code>puma</code>, and we can check its status by <code>gitlab-ctl status</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">gitlab-ctl stop sidekiq<br>gitlab-ctl stop puma<br>gitlab-ctl status<br></code></pre></td></tr></table></figure><p>New version of GitLab migrates from <code>unicorn</code> to <code>puma</code>, so there is no need to stop <code>unicorn</code> service any more.</p><h3 id="Place-Backup-Files"><a href="#Place-Backup-Files" class="headerlink" title="Place Backup Files"></a>Place Backup Files</h3><p>We need to upload our backup packages to new server, and organize them correctly.</p><p>Here we also use FTP to upload files from our local machine.</p><p>The <code>[TIMESTAMP]_gitlab_backup.tar</code> should be placed at <code>/var/opt/gitlab/backups/</code> as before, and <code>gitlab.rb</code> and <code>gitlab-secrets.json</code> extracted from <code>gitlab-secrets.tar</code> should be placed at <code>/etc/gitlab/</code>, replacing the original files.</p><h3 id="Restore-the-Backup"><a href="#Restore-the-Backup" class="headerlink" title="Restore the Backup"></a>Restore the Backup</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Bash"><span class="hljs-built_in">cd</span> /var/opt/gitlab/backups/<br>gitlab-rake gitlab:backup:restore BACKUP=1690438526_2023_07_27_15.9.0-ee<br></code></pre></td></tr></table></figure><p>The <code>BACKUP</code> parameter is the file name of backup package, without <code>_gitlab_backup.tar</code> suffix.</p><h3 id="Restart-GitLab-Service"><a href="#Restart-GitLab-Service" class="headerlink" title="Restart GitLab Service"></a>Restart GitLab Service</h3><p>Restart the services we stopped before and check their status.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Bash">gitlab-ctl start<br>gitlab-ctl status<br>gitlab-rake gitlab:check SANITIZE=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>Now all services should be running, and we can access to GitLab just as before, with all user data and repositories are restored.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://docs.gitlab.com/ee/administration/backup_restore/">Back up and restore GitLab | GitLab</a></li><li><a href="https://about.gitlab.com/install/">Download and install GitLab | GitLab</a></li><li><a href="https://forum.gitlab.com/t/installing-older-versions-of-gitlab-on-ununtu/29507">Installing Older Versions of Gitlab on Ununtu - How to Use GitLab - GitLab Forum</a></li><li><a href="https://help.aliyun.com/document_detail/52857.html">éƒ¨ç½²å’Œä½¿ç”¨GitLab</a></li><li><a href="https://developer.aliyun.com/article/346715">Gitlabå¤‡ä»½å’Œæ¢å¤æ“ä½œè®°å½•-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº</a></li><li><a href="https://www.alibabacloud.com/product/ecs">Elastic Compute Service (ECS): Elastic &amp; Secure Cloud Servers - Alibaba Cloud</a></li><li><a href="https://www.aliyun.com/product/ecs">äº‘æœåŠ¡å™¨ECS_äº‘ä¸»æœº_æœåŠ¡å™¨æ‰˜ç®¡_å¼¹æ€§è®¡ç®—-é˜¿é‡Œäº‘</a></li><li><a href="https://wiki.centos.org/About/Product">About&#x2F;Product - CentOS Wiki</a></li><li><a href="https://about.gitlab.com/blog/2020/07/08/migrating-to-puma-on-gitlab/">How we migrated application servers from Unicorn to Puma | GitLab</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Server</tag>
      
      <tag>Cloud</tag>
      
      <tag>ECS</tag>
      
      <tag>CentOS</tag>
      
      <tag>GitLab</tag>
      
      <tag>Ubuntu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Paper Notes: CPU/GPU Task Scheduling with SVM</title>
    <link href="/2023/07/28/read-paper-0-wen/"/>
    <url>/2023/07/28/read-paper-0-wen/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Paper-Notes-CPU-x2F-GPU-Task-Scheduling-with-SVM"><a href="#Paper-Notes-CPU-x2F-GPU-Task-Scheduling-with-SVM" class="headerlink" title="Paper Notes: CPU&#x2F;GPU Task Scheduling with SVM"></a>Paper Notes: CPU&#x2F;GPU Task Scheduling with SVM</h1><h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p><strong>Smart Multi-Task Scheduling for OpenCL Programs on CPU&#x2F;GPU Heterogeneous Platforms</strong></p><p><strong>Authors</strong>: <a href="https://scholar.google.com/citations?user=8CHUcJEAAAAJ">Yuan Wen</a>, Zheng Wang, Michael F.P. Oâ€™Boyle</p><p><strong>Published in</strong>: HiPC 2014 Dec.</p><p><strong>DOI</strong>: <a href="https://doi.org/10.1109/HiPC.2014.7116910">10.1109&#x2F;HiPC.2014.7116910</a></p><p><strong>Keywords</strong>: GPU, OpenCL, task scheduling, machine learning</p><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><h3 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h3><p>To find the best map from OpenCL application to hardware resource, CPU or GPU. </p><p>The requirements are:</p><ul><li>Enlarge the system throughput (STP)</li><li>Reduce the average normalized turn-around time (ANTT)</li></ul><p><strong>STP</strong>: the number of tasks completed per unit time.</p><p><strong>ANTT</strong>: the average time between the submission of a task and the completion of it.</p><h3 id="Alternative"><a href="#Alternative" class="headerlink" title="Alternative"></a>Alternative</h3><p>Other scheduling policies:</p><ul><li>All on CPU</li><li>All on GPU</li><li>First come first serve (FCFS): baseline</li><li>Input size guided: GPU gets the task with larger input size</li><li>Work item guided: GPU gets the task with larger number of work items</li></ul><h2 id="Key-Idea"><a href="#Key-Idea" class="headerlink" title="Key Idea"></a>Key Idea</h2><p>Predict the <strong>speedup</strong> of a task. Speedup is defined as the ratio of the execution time of a task on CPU to that on GPU.</p><p>Organize all OpenCL tasks into a queue based on <strong>predicted speedup</strong> and <strong>runtime data transfer size</strong>. High speedup side tasks are scheduled to GPU, while low speedup side tasks are scheduled to CPU.</p><p>When CPU or GPU is idle, pop the task from the queueâ€™s two side accordingly, until the end of the queue.</p><h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>The predictor takes in:</p><ol><li>Static code features</li><li>Runtime features</li></ol><p>Output a speedup category of the task. Tow categories are used: high speedup side and low speedup side.</p><p>Use <strong>Support Vector Machines</strong> classifier and train &#x2F; evaluate with <strong>leave-one-out cross-validation</strong>.</p><p><img src="https://ieeexplore.ieee.org/mediastore_new/IEEE/content/media/7113430/7116705/7116910/7116910-table-1-source-large.gif" alt="Used features"></p><p><img src="https://ieeexplore.ieee.org/mediastore_new/IEEE/content/media/7113430/7116705/7116910/7116910-fig-6-source-large.gif" alt="Importance of the features"></p><blockquote><p>The larger the square is, the more important the feature is.</p></blockquote><h2 id="Experiment"><a href="#Experiment" class="headerlink" title="Experiment"></a>Experiment</h2><p>The experiment took place on real machine.</p><p>35 OpenCL benchmarks are used.</p><h2 id="Limitation"><a href="#Limitation" class="headerlink" title="Limitation"></a>Limitation</h2><ol><li>To compare with the <em>best STP</em> queue (comes from exhaustive searching), there is still 50% gap. As speedup is only one proxy of execution time. (Impossible to find the best ANTT queue)</li><li>prediction accuracy is not high enough. On STP, SVM model is 87% accurate, decision tree model is 72%.</li><li>coarse-grained classification. Only two categories are used. Enlarge the number of categories may improve the performance but not always.</li></ol><hr><blockquote><p>Y. Wen, Z. Wang and M. F.P. Oâ€™Boyle, â€œSmart Multi-Task Scheduling for OpenCL Programs on CPU&#x2F;GPU Heterogeneous Platforms,â€ 2014 21st International Conference on High Performance Computing (HiPC), Goa, India, 2014, pp. 1-10, doi: 10.1109&#x2F;HiPC.2014.7116910.</p></blockquote><!--https://lingkkang.github.io/2023/07/27/read-paper-0-wen/-->]]></content>
    
    
    <categories>
      
      <category>Paper Notes</category>
      
    </categories>
    
    
    <tags>
      
      <tag>task scheduling</tag>
      
      <tag>GPU</tag>
      
      <tag>OpenCL</tag>
      
      <tag>machine learning</tag>
      
      <tag>SVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Performance Issue of Memory Alignment</title>
    <link href="/2023/07/27/align-test/"/>
    <url>/2023/07/27/align-test/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Performance-Issue-of-Memory-Alignment"><a href="#Performance-Issue-of-Memory-Alignment" class="headerlink" title="Performance Issue of Memory Alignment"></a>Performance Issue of Memory Alignment</h1><p>We have already discussed <a href="https://lingkkang.github.io/2023/03/12/align/">some tricks for aligning numbers</a>. In this post, we will explore the difference in code performance between aligned and unaligned memory access, especially when accessing and assigning to the members of <code>struct</code> (and possibly <code>class</code>). A piece of ready-to-go C++ code is provided in the <a href="#appendix">appendix</a>.</p><h2 id="Design"><a href="#Design" class="headerlink" title="Design"></a>Design</h2><p>We plan to use <code>struct</code> to demonstrate the performance difference. Basically, it would contain three members: <code>char</code>, <code>int</code> and <code>double</code>. We will try to align them in different ways and see the performance difference.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Struct1</span><br>&#123;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">char</span> my_char = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> my_int = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">double</span> my_double = <span class="hljs-number">0.0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>The size of each type is as follows, but the size of <code>Struct1</code>, which is presumably the sum of the size of its members, is not guaranteed.</p><div style="margin: 0 auto; width: fit-content;"><table><thead><tr><th align="center">Data Type</th><th align="center">Size in Bytes</th></tr></thead><tbody><tr><td align="center"><code>char</code></td><td align="center">1</td></tr><tr><td align="center"><code>int</code></td><td align="center">4</td></tr><tr><td align="center"><code>double</code></td><td align="center">8</td></tr><tr><td align="center"><code>Struct1</code></td><td align="center">16</td></tr></tbody></table></div><p>If we run with the code <code>sizeof(Struct1)</code>, the result might actually be 16, because the compiler does some padding to make the size of <code>Struct1</code> a multiple of 4, trying to make it not too inefficient. And we wonâ€™t touch this part for simplicityâ€™s sake.</p><p>By <a href="https://en.wikipedia.org/wiki/Permutation">permutation without repetition</a>, we have 6 ways to align the members of our <code>struct</code>, namely <code>Struct1</code> to <code>Struct6</code> (see the <a href="#test.hh">appendix <code>test.hh</code></a>).</p><h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>The idea is simple: </p><ol><li>Initialize an object;</li><li>Assign values to its members;</li><li>Loop for many many times;</li><li>Record the total time consumed of one type.</li><li>Compare the time across different types.</li></ol><p>So the basic code looks like this:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">define</span> ITER 10000000</span><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// get start time</span><br>    <span class="hljs-keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();<br><br>    <span class="hljs-comment">// start looping</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; ITER; ++i) &#123;<br>        Struct1 data;<br>        data.c = <span class="hljs-string">&#x27;A&#x27;</span>;<br>        data.i = <span class="hljs-number">42</span>;<br>        data.d = <span class="hljs-number">3.14</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// get finish time</span><br>    <span class="hljs-keyword">auto</span> end = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();<br>    <span class="hljs-comment">// calculate time duration in microseconds</span><br>    <span class="hljs-keyword">auto</span> duration = <br>        std::chrono::<span class="hljs-built_in">duration_cast</span>&lt;std::chrono::microseconds&gt;(end - start)<br>            .<span class="hljs-built_in">count</span>();<br><br>    std::cout <br>        &lt;&lt; <span class="hljs-string">&quot;Access time of Struct1 with proper alignment: &quot;</span> <br>        &lt;&lt; duration &lt;&lt; <span class="hljs-string">&quot; microseconds&quot;</span> &lt;&lt; std::endl;<br>&#125;<br></code></pre></td></tr></table></figure><p>Just replace <code>Struct1</code> with <code>Struct2</code> â€¦ <code>Struct6</code> and we can get the time consumed by each type.</p><p>But some changes are needed to make the code more readable and convenient to collect data.</p><ol><li>Implemented a <code>template</code> with generic type to avoid code duplication.</li><li>Used a vector <code>time</code> to store the time consumed by each type.</li><li>For each value of <code>iter</code>, we run the test for 5 times, or, 5 <code>epoch</code>s.</li><li>Used two arrays <code>min_arr</code> and <code>max_arr</code> to keep track of which type contributes to the max and min consumed time. </li><li>Save the result as a csv file for further analysis.</li><li>Prompt out current iteration and epoch so that we can know the progress.</li></ol><p>For example, say after one <code>epoch</code>, when we get the <code>time</code> vector with values <code>294146, 276858, 265321, 267835, 278274, 282499</code>, we can know that <code>Struct3</code> is the fastest and <code>Struct1</code> is the slowest. Then we can increment <code>min_arr[2]</code> and <code>max_arr[0]</code> (indies start at 0) by <code>1</code>, this is done by the <code>count()</code> function.</p><p>Note also that the order in which the members are accessed counts. For example, if we access <code>char</code> first, then <code>int</code>, then <code>double</code>, this is different from accessing <code>double</code> first, then <code>int</code>, then <code>char</code>. This will also affect the performance. Here, we simply access them in the reverse order of their declaration.</p><p>Implementation details can be found in the <a href="#test.cpp">appendix <code>test.cpp</code></a>.</p><h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>We calculated <code>iter</code> from 100000000 to 100001000 with step 10, and <code>epoch</code> from 1 to 5. This means that we have a total of 500 rows of data. So the result is quite accurate and convincing from statistical perspective.</p><p>The final <code>min_arr</code> and <code>max_arr</code> are as follows:</p><div style="margin: 0 auto; width: fit-content;"><table><thead><tr><th align="center"></th><th align="center"><code>Struct1</code></th><th align="center"><code>Struct2</code></th><th align="center"><code>Struct3</code></th><th align="center"><code>Struct4</code></th><th align="center"><code>Struct5</code></th><th align="center"><code>Struct6</code></th></tr></thead><tbody><tr><td align="center">MAX Count</td><td align="center"><strong>288</strong></td><td align="center">209</td><td align="center">2</td><td align="center">4</td><td align="center">0</td><td align="center">2</td></tr><tr><td align="center">MIN Count</td><td align="center">0</td><td align="center">0</td><td align="center">50</td><td align="center">67</td><td align="center"><strong>331</strong></td><td align="center">57</td></tr></tbody></table></div><p>We can see that in general <code>Struct5</code> is the fastest and <code>Struct1</code> is the slowest.</p><p><img src="/images/one_time/align-test.png" alt="Visualization"></p><p>And they are quite dominant over other types.</p><p>The full results can be found <a href="/assets/align-test.csv">here</a>.</p><h2 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h2><p>This result is quite self-explanatory. If we check the size of these <code>struct</code>s, they are not all 16 bytes.</p><div style="margin: 0 auto; width: fit-content;"><table><thead><tr><th align="center">Data Type</th><th align="center">Size in Bytes</th></tr></thead><tbody><tr><td align="center"><code>Struct1</code></td><td align="center">16</td></tr><tr><td align="center"><code>Struct2</code></td><td align="center"><strong>24</strong></td></tr><tr><td align="center"><code>Struct3</code></td><td align="center">16</td></tr><tr><td align="center"><code>Struct4</code></td><td align="center"><strong>24</strong></td></tr><tr><td align="center"><code>Struct5</code></td><td align="center">16</td></tr><tr><td align="center"><code>Struct6</code></td><td align="center">16</td></tr></tbody></table></div><p>We can see that <code>Struct2</code> and <code>Struct4</code> are 24 bytes, which is not a multiple of 8. The compilers do padding and alignment based on 8 bytes for each structure member. GCC&#x2F;g++ also has an <a href="https://gcc.gnu.org/onlinedocs/gcc-13.1.0/gcc/Common-Type-Attributes.html#index-aligned-type-attribute">alignment attribute</a> that can be used to control the alignment of structure members. For example, we can use <code>__attribute__((aligned(8)))</code> to ensure that the structure is aligned to 8 bytes when using GCC&#x2F;g++.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://lemire.me/blog/2012/05/31/data-alignment-for-speed-myth-or-reality/">Data alignment for speed: myth or reality? â€“ Daniel Lemireâ€™s blog</a></li><li><a href="https://fylux.github.io/2017/07/11/Memory_Alignment/">Memory Alignment and Performance Â· Fylux</a></li><li><a href="https://developer.ibm.com/articles/pa-dalign/">Data alignment: Straighten up and fly right - IBM Developer</a></li><li><a href="https://stackoverflow.com/questions/1898153/how-to-determine-if-memory-is-aligned">c - How to determine if memory is aligned? - Stack Overflow</a></li><li><a href="https://gcc.gnu.org/onlinedocs/gcc-13.1.0/gcc/Attribute-Syntax.html">Attribute Syntax (Using the GNU Compiler Collection (GCC))</a></li><li><a href="https://gcc.gnu.org/onlinedocs/gcc-13.1.0/gcc/Common-Type-Attributes.html">Common Type Attributes (Using the GNU Compiler Collection (GCC))</a></li></ul><h2 id="Appendix"><a href="#Appendix" class="headerlink" title="Appendix"></a>Appendix</h2><h3 id="Environment-and-Compilation"><a href="#Environment-and-Compilation" class="headerlink" title="Environment and Compilation"></a>Environment and Compilation</h3><ul><li>Compiler: MinGW32 GCC 9.2.0</li><li>OS: Windows 10</li><li>Arch: X86_64</li></ul><p>Build with command <code>g++ -O0 test.cpp -o test</code>.</p><h3 id="test-hh"><a href="#test-hh" class="headerlink" title="test.hh"></a><code>test.hh</code></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> __TEST_HH__</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> __TEST_HH__</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ITER_MAX 100001000</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> ITER_MIN 100000000</span><br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Struct1</span><br>&#123;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">char</span> my_char = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> my_int = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">double</span> my_double = <span class="hljs-number">0.0</span>;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">assign</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        my_char = <span class="hljs-string">&#x27;a&#x27;</span>;<br>        my_int = <span class="hljs-number">42</span>;<br>        my_double = <span class="hljs-number">3.14</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Struct2</span><br>&#123;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">char</span> my_char = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">double</span> my_double = <span class="hljs-number">0.0</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> my_int = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">assign</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        my_char = <span class="hljs-string">&#x27;a&#x27;</span>;<br>        my_double = <span class="hljs-number">3.14</span>;<br>        my_int = <span class="hljs-number">42</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Struct3</span><br>&#123;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> my_int = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">char</span> my_char = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">double</span> my_double = <span class="hljs-number">0.0</span>;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">assign</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        my_int = <span class="hljs-number">42</span>;<br>        my_char = <span class="hljs-string">&#x27;a&#x27;</span>;<br>        my_double = <span class="hljs-number">3.14</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Struct4</span><br>&#123;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> my_int = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">double</span> my_double = <span class="hljs-number">0.0</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">char</span> my_char = <span class="hljs-string">&#x27;\0&#x27;</span>;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">assign</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        my_int = <span class="hljs-number">42</span>;<br>        my_double = <span class="hljs-number">3.14</span>;<br>        my_char = <span class="hljs-string">&#x27;a&#x27;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Struct5</span><br>&#123;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">double</span> my_double = <span class="hljs-number">0.0</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">char</span> my_char = <span class="hljs-string">&#x27;\0&#x27;</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> my_int = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">assign</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        my_double = <span class="hljs-number">3.14</span>;<br>        my_char = <span class="hljs-string">&#x27;a&#x27;</span>;<br>        my_int = <span class="hljs-number">42</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Struct6</span><br>&#123;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">double</span> my_double = <span class="hljs-number">0.0</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> my_int = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">volatile</span> <span class="hljs-type">char</span> my_char = <span class="hljs-string">&#x27;\0&#x27;</span>;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">assign</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        my_double = <span class="hljs-number">3.14</span>;<br>        my_int = <span class="hljs-number">42</span>;<br>        my_char = <span class="hljs-string">&#x27;a&#x27;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span> <span class="hljs-comment">// __TEST_HH__</span></span><br></code></pre></td></tr></table></figure><h3 id="test-cpp"><a href="#test-cpp" class="headerlink" title="test.cpp"></a><code>test.cpp</code></h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs C++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;test.hh&quot;</span></span><br><br><span class="hljs-type">int</span> min_arr[<span class="hljs-number">6</span>];<br><span class="hljs-type">int</span> max_arr[<span class="hljs-number">6</span>];<br><br><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> StructType&gt;<br><span class="hljs-function"><span class="hljs-type">long</span> <span class="hljs-type">long</span> <span class="hljs-title">runTest</span><span class="hljs-params">(<span class="hljs-type">long</span> <span class="hljs-type">long</span> iter)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-type">long</span> i = <span class="hljs-number">0</span>; i &lt; iter; i++)<br>    &#123;<br>        <span class="hljs-comment">// init object and do value assignment `iter` times</span><br>        StructType data;<br>        data.<span class="hljs-built_in">assign</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">auto</span> finish = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();<br>    <span class="hljs-keyword">auto</span> duration = <br>        std::chrono::<span class="hljs-built_in">duration_cast</span>&lt;std::chrono::microseconds&gt;(finish - start)<br>            .<span class="hljs-built_in">count</span>();<br><br>    <span class="hljs-keyword">return</span> duration;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">print_min_max</span><span class="hljs-params">()</span></span>&#123;<br>    <br>    std::cout &lt;&lt; <span class="hljs-string">&quot;MAX [&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++)<br>        std::cout &lt;&lt; max_arr[i] &lt;&lt; <span class="hljs-string">&quot;, &quot;</span>;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;]&quot;</span> &lt;&lt; std::endl;<br><br>    std::cout &lt;&lt; <span class="hljs-string">&quot;MIN [&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">6</span>; i++)<br>        std::cout &lt;&lt; min_arr[i] &lt;&lt; <span class="hljs-string">&quot;, &quot;</span>;<br>    std::cout &lt;&lt; <span class="hljs-string">&quot;]&quot;</span> &lt;&lt; std::endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">count</span><span class="hljs-params">(std::vector&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt; &amp;time_vec)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// keep track of the max and min</span><br>    <span class="hljs-keyword">auto</span> max = std::<span class="hljs-built_in">max_element</span>(time_vec.<span class="hljs-built_in">begin</span>(), time_vec.<span class="hljs-built_in">end</span>()) - time_vec.<span class="hljs-built_in">begin</span>();<br>    max_arr[max] += <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">auto</span> min = std::<span class="hljs-built_in">min_element</span>(time_vec.<span class="hljs-built_in">begin</span>(), time_vec.<span class="hljs-built_in">end</span>()) - time_vec.<span class="hljs-built_in">begin</span>();<br>    min_arr[min] += <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    std::vector&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>&gt; time;<br><br>    <span class="hljs-comment">// write timing result to csv file</span><br>    std::ofstream output_file;<br>    output_file.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;output.csv&quot;</span>);<br>    output_file <span class="hljs-comment">// print csv headers</span><br>        &lt;&lt; <span class="hljs-string">&quot;iteration,epoch,&quot;</span> &lt;&lt; <span class="hljs-string">&quot;struct1,&quot;</span> &lt;&lt; <span class="hljs-string">&quot;struct2,&quot;</span><br>        &lt;&lt; <span class="hljs-string">&quot;struct3,&quot;</span> &lt;&lt; <span class="hljs-string">&quot;struct4,&quot;</span> &lt;&lt; <span class="hljs-string">&quot;struct5,&quot;</span><br>        &lt;&lt; <span class="hljs-string">&quot;struct6,&quot;</span> &lt;&lt; std::endl;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">long</span> <span class="hljs-type">long</span> iter = ITER_MIN; iter &lt;= ITER_MAX; iter += <span class="hljs-number">10</span>)<br>    &#123;<br>        std::cout &lt;&lt; <span class="hljs-string">&quot;Iteration time: &quot;</span> &lt;&lt; iter &lt;&lt; std::endl;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> epoch = <span class="hljs-number">1</span>; epoch &lt; <span class="hljs-number">6</span>; epoch++)<br>        &#123;<br>            std::cout &lt;&lt; <span class="hljs-string">&quot;Epoch: &quot;</span> &lt;&lt; epoch &lt;&lt; std::endl;<br>            time.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">runTest</span>&lt;Struct1&gt;(iter));<br>            time.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">runTest</span>&lt;Struct2&gt;(iter));<br>            time.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">runTest</span>&lt;Struct3&gt;(iter));<br>            time.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">runTest</span>&lt;Struct4&gt;(iter));<br>            time.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">runTest</span>&lt;Struct5&gt;(iter));<br>            time.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">runTest</span>&lt;Struct6&gt;(iter));<br>            output_file &lt;&lt; iter &lt;&lt; <span class="hljs-string">&quot;,&quot;</span> &lt;&lt; epoch &lt;&lt; <span class="hljs-string">&quot;,&quot;</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> index = <span class="hljs-number">0</span>; index &lt; time.<span class="hljs-built_in">size</span>(); index++)<br>                output_file &lt;&lt; time[index] &lt;&lt; <span class="hljs-string">&quot;,&quot;</span>;<br>            output_file &lt;&lt; std::endl;<br>            <span class="hljs-built_in">count</span>(time);<br>            time.<span class="hljs-built_in">clear</span>();<br>        &#125;<br>        <span class="hljs-built_in">print_min_max</span>();<br>    &#125;<br><br>    <span class="hljs-built_in">print_min_max</span>();<br>    output_file.<span class="hljs-built_in">close</span>();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="plot-py"><a href="#plot-py" class="headerlink" title="plot.py"></a><code>plot.py</code></h3><p>Also include a Python script to plot the result, as a backup.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br>x = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]<br>y_max = [-<span class="hljs-number">288</span>, -<span class="hljs-number">209</span>, -<span class="hljs-number">2</span>, -<span class="hljs-number">4</span>, <span class="hljs-number">0</span>, -<span class="hljs-number">2</span>] <span class="hljs-comment"># slowest</span><br>y_min = [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">50</span>, <span class="hljs-number">67</span>, <span class="hljs-number">331</span>, <span class="hljs-number">57</span>]     <span class="hljs-comment"># fastest</span><br><br>fig, ax = plt.subplots(facecolor=<span class="hljs-string">&quot;#eaeaf2&quot;</span>,)<br><br>fig.set_figheight(<span class="hljs-number">6</span>)<br>fig.set_figwidth(<span class="hljs-number">6</span>)<br><br>ax.set_xlabel(<span class="hljs-string">&quot;Structs&quot;</span>)<br>ax.set_ylabel(<span class="hljs-string">&quot;Times of Max/Min&quot;</span>)<br>ax.set_title(<span class="hljs-string">&quot;Max/Min Counts over Experiment&quot;</span>, fontsize=<span class="hljs-number">18</span>, pad=<span class="hljs-number">15</span>)<br><br>bar_max = ax.bar(x, y_max, <span class="hljs-number">0.35</span>, label=<span class="hljs-string">&quot;slowest&quot;</span>, color=<span class="hljs-string">&quot;#97d6fc&quot;</span>) <span class="hljs-comment"># green</span><br>bar_min = ax.bar(x, y_min, <span class="hljs-number">0.35</span>, label=<span class="hljs-string">&quot;fastest&quot;</span>, color=<span class="hljs-string">&quot;#ff8282&quot;</span>) <span class="hljs-comment"># red</span><br>ax.axhline(<span class="hljs-number">0</span>, color=<span class="hljs-string">&quot;black&quot;</span>, linewidth=<span class="hljs-number">0.5</span>)<br>ax.legend()<br><br><span class="hljs-comment"># add value labels above each bar</span><br><span class="hljs-keyword">for</span> bar <span class="hljs-keyword">in</span> bar_min:<br>    height = bar.get_height()<br>    ax.text(<br>        bar.get_x() + bar.get_width() / <span class="hljs-number">2.0</span>,<br>        height,<br>        <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;<span class="hljs-built_in">int</span>(height)&#125;</span>&quot;</span>,<br>        ha=<span class="hljs-string">&quot;center&quot;</span>,<br>        va=<span class="hljs-string">&quot;bottom&quot;</span>,<br>        fontsize=<span class="hljs-number">9</span>,<br>    )<br><br><span class="hljs-comment"># add value labels below each bar</span><br><span class="hljs-keyword">for</span> bar <span class="hljs-keyword">in</span> bar_max:<br>    height = bar.get_height()<br>    ax.text(<br>        bar.get_x() + bar.get_width() / <span class="hljs-number">2.0</span>,<br>        height-<span class="hljs-number">25</span>,<br>        <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;-<span class="hljs-built_in">int</span>(height)&#125;</span>&quot;</span>,<br>        ha=<span class="hljs-string">&quot;center&quot;</span>,<br>        va=<span class="hljs-string">&quot;bottom&quot;</span>,<br>        fontsize=<span class="hljs-number">9</span>,<br>    )<br><br>plt.xticks(rotation=<span class="hljs-number">45</span>)<br>plt.tight_layout()<br>plt.subplots_adjust(wspace=<span class="hljs-number">0</span>, top=<span class="hljs-number">0.85</span>, bottom=<span class="hljs-number">0.12</span>, left=<span class="hljs-number">0.18</span>, right=<span class="hljs-number">0.95</span>)<br><span class="hljs-comment"># plt.show()</span><br>plt.savefig(<span class="hljs-string">&quot;align-test.png&quot;</span>, facecolor=<span class="hljs-string">&quot;#eee&quot;</span>, dpi=<span class="hljs-number">500</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Programming Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C</tag>
      
      <tag>C Plus Plus</tag>
      
      <tag>Optimization</tag>
      
      <tag>Memory</tag>
      
      <tag>Alignment</tag>
      
      <tag>Padding</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Access MySQL Localhost on Windows Host from WSL2</title>
    <link href="/2023/07/07/wsl2mysql/"/>
    <url>/2023/07/07/wsl2mysql/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Access-MySQL-Localhost-on-Windows-Host-from-WSL2"><a href="#Access-MySQL-Localhost-on-Windows-Host-from-WSL2" class="headerlink" title="Access MySQL Localhost on Windows Host from WSL2"></a>Access MySQL Localhost on Windows Host from WSL2</h1><p>Itâ€™s common to have a MySQL server running on localhost for development. But when using WSL2, itâ€™s not that easy to access the localhost on Windows host. This post will show how to do it.</p><h2 id="Check-Private-Network"><a href="#Check-Private-Network" class="headerlink" title="Check Private Network"></a>Check Private Network</h2><p>Run command <code>ip route</code> on WSL2 to get the IP address of the private network.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">$ </span><span class="language-bash">ip route</span><br>default via 172.23.144.1 dev eth0<br>172.23.144.0/20 dev eth0 proto kernel scope link src 172.23.151.37 <br></code></pre></td></tr></table></figure><p>The first line represents the default route, the IP address <code>172.23.144.1</code> is the gateway or next-hop IP address. Actually, this is also the IP address of the host machine, where our MySQL server is running.</p><p>The second line represents a specific route for the network <code>172.23.144.0/20</code>, which is a <a href="https://lingkkang.github.io/2023/05/15/subnet/">subnet</a> for WSL2. The source <code>src 172.23.151.37</code> is the IP address that will be used when sending traffic to the network, i.e., the IP address of WSL2.</p><p>Run following command can also validate the IP address of the host machine.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">echo</span> $(hostname).<span class="hljs-built_in">local</span><br>ping -c 2 $(hostname).<span class="hljs-built_in">local</span><br></code></pre></td></tr></table></figure><p>Actually, the WSL2 and the Windows host machine are all on a shared Hyper-V switch, which is a virtual network switch.</p><p>However, the IP address of the host machine is <strong>not static</strong>, it will change after rebooting. So itâ€™s not a good idea to have the IP address hard-coded in the configuration.</p><p>And the solution is to use the hostname of the host machine, which is also the name of the host machine. The hostname can be found by running <code>hostname</code> on Windows PowerShell, or <code>echo $(hostname)</code> on WSL2. The <code>.local</code> suffix is also needed. See the python script for <a href="#test-connection">connection testing</a>.</p><p>It is also noteworthy that the private network IPv4 addresses all begin with <code>172</code>. This would be helpful when we configure MySQL user.</p><h2 id="Create-MySQL-User"><a href="#Create-MySQL-User" class="headerlink" title="Create MySQL User"></a>Create MySQL User</h2><p>Since all users on MySQL server are on <code>localhost</code> by default, it is required to create a new user for WSL2. </p><p>Note that both user name <code>user</code> and host name <code>host</code> need to match to log in, otherwise, it will be denied. For example, if we try to log in as root in Python from WSL2, it will raise an an <code>mysql.connector.errors.ProgrammingError</code>, with an error message that <code>1045 (28000): Access denied for user &#39;root&#39;@&#39;172.23.151.37&#39;</code>.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">SELECT user, host FROM mysql.user;</span><br>+------------------+-----------+<br>| user             | host      |<br>+------------------+-----------+<br>| mysql.infoschema | localhost |<br>| mysql.session    | localhost |<br>| mysql.sys        | localhost |<br>| root             | localhost |<br>+------------------+-----------+<br>4 rows in set (0.01 sec)<br></code></pre></td></tr></table></figure><p>Log in MySQL Command Line Client with root privilege, and create a user for WSL2, say, <code>wsl2</code>.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;wsl2&#x27;</span>@<span class="hljs-string">&#x27;172.%&#x27;</span>;<br></code></pre></td></tr></table></figure><p>or, if password is needed,</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;wsl2&#x27;</span>@<span class="hljs-string">&#x27;172.%&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;password&#x27;</span>;<br></code></pre></td></tr></table></figure><p>Here <code>%</code> percentage sign is a wildcard which means any IP address that begins with <code>172</code>.</p><p>We could see at this stage the user <code>wsl2</code> has no privilege.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs console"><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">SELECT user, host, select_priv, create_priv, insert_priv FROM mysql.user WHERE user=<span class="hljs-string">&#x27;wsl2&#x27;</span>;</span><br>+------+-------+-------------+-------------+-------------+<br>| user | host  | select_priv | create_priv | insert_priv |<br>+------+-------+-------------+-------------+-------------+<br>| wsl2 | 172.% | N           | N           | N           |<br>+------+-------+-------------+-------------+-------------+<br>1 row in set (0.01 sec)<br></code></pre></td></tr></table></figure><h2 id="Grant-Privilege"><a href="#Grant-Privilege" class="headerlink" title="Grant Privilege"></a>Grant Privilege</h2><p>Grant privilege to the user <code>wsl2</code> as per requirement.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;wsl2&#x27;</span>@<span class="hljs-string">&#x27;172.%&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;wsl2&#x27;</span>@<span class="hljs-string">&#x27;172.%&#x27;</span>;<br><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">&#x27;wsl2&#x27;</span>@<span class="hljs-string">&#x27;172.%&#x27;</span>;<br>FLUSH PRIVILEGES;<br></code></pre></td></tr></table></figure><p>Rerun the query, we could see the user <code>wsl2</code> has the privilege now.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>, host, select_priv, create_priv, insert_priv <span class="hljs-keyword">FROM</span> mysql.user <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">&#x27;wsl2&#x27;</span>;<br></code></pre></td></tr></table></figure><h2 id="Test-Connection"><a href="#Test-Connection" class="headerlink" title="Test Connection"></a>Test Connection</h2><p>Here is a simple python script. Run it on WSL2 to test the connection.</p><p>Remember to replace the <code>user</code>, <code>password</code> and <code>host</code> with your own. The <code>host</code> should be exactly the same as what <code>echo $(hostname).local</code> returns on WSL2.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-comment">#!/usr/bin/python3</span><br><br><span class="hljs-keyword">from</span> mysql <span class="hljs-keyword">import</span> connector<br><br>connection = connector.connect(<br>    user=<span class="hljs-string">&quot;wsl2&quot;</span>,<br>    password=<span class="hljs-string">&quot;password&quot;</span>,<br>    host=<span class="hljs-string">&quot;DESKTOP-4T7NV3Q.local&quot;</span><br>)<br><br>cursor = connection.cursor()<br>cursor.execute(<span class="hljs-string">&quot;SHOW DATABASES;&quot;</span>)<br><br><span class="hljs-keyword">for</span> db <span class="hljs-keyword">in</span> cursor.fetchall():<br>    <span class="hljs-built_in">print</span>(db[<span class="hljs-number">0</span>])<br><br>cursor.close()<br>connection.close()<br></code></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://man7.org/linux/man-pages/man8/ip.8.html">ip(8) - Linux manual page</a></li><li><a href="https://learn.microsoft.com/en-us/windows/wsl/networking">Accessing network applications with WSL | Microsoft Learn</a></li><li><a href="https://unix.stackexchange.com/questions/715507/connect-to-host-machine-from-wsl2">networking - Connect to host machine from WSL2 - Unix &amp; Linux Stack Exchange</a></li><li><a href="https://dev.mysql.com/doc/refman/8.0/en/user-names.html">MySQL :: MySQL 8.0 Reference Manual :: 6.2.1 Account User Names and Passwords</a></li><li><a href="https://dev.mysql.com/doc/refman/8.0/en/grant-tables.html">MySQL :: MySQL 8.0 Reference Manual :: 6.2.3 Grant Tables</a></li><li><a href="https://dev.mysql.com/doc/refman/8.0/en/create-user.html">MySQL :: MySQL 8.0 Reference Manual :: 13.7.1.3 CREATE USER Statement</a></li><li><a href="https://stackoverflow.com/questions/50177216/how-to-grant-all-privileges-to-root-user-in-mysql-8-0">How to grant all privileges to root user in MySQL 8.0 - Stack Overflow</a></li><li><a href="https://askubuntu.com/questions/1322175/not-allowed-to-create-user-with-grant">mysql - Not Allowed to Create User with GRANT - Ask Ubuntu</a></li><li><a href="https://docs.digitalocean.com/products/databases/mysql/how-to/modify-user-privileges/">How to Modify User Privileges in MySQL Databases :: DigitalOcean Documentation</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>SQL</tag>
      
      <tag>WSL2</tag>
      
      <tag>Windows</tag>
      
      <tag>Hyper-V</tag>
      
      <tag>IP</tag>
      
      <tag>Routing</tag>
      
      <tag>IPv4</tag>
      
      <tag>MySQL</tag>
      
      <tag>CRUD</tag>
      
      <tag>Privileged Access Management</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Share Files Between Host and Linux Virtual Machine over Hyper-V</title>
    <link href="/2023/06/16/share-file-host-and-vm-hyper-v/"/>
    <url>/2023/06/16/share-file-host-and-vm-hyper-v/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Share-Files-Between-Host-and-Linux-Virtual-Machine-over-Hyper-V"><a href="#Share-Files-Between-Host-and-Linux-Virtual-Machine-over-Hyper-V" class="headerlink" title="Share Files Between Host and Linux Virtual Machine over Hyper-V"></a>Share Files Between Host and Linux Virtual Machine over Hyper-V</h1><p>Generally speaking, just follow this post and things will be all set.</p><p><a href="https://linuxhint.com/shared_folders_hypver-v_ubuntu_guest/">Shared Folders over Hyper-V Ubuntu Guest</a></p><p>Also, <a href="https://learn.microsoft.com/en-us/answers/questions/707320/attach-usb-device-to-hyper-v-guest-machine">attach a USB drive to the VM</a> is a feasible way, but on Windows 10, it is not support to make a removable device <em>offline</em>, so it is not applicable for SD &#x2F; TF card. Unreasonableâ€¦</p><h2 id="Some-Notices"><a href="#Some-Notices" class="headerlink" title="Some Notices"></a>Some Notices</h2><h3 id="1"><a href="#1" class="headerlink" title="1."></a>1.</h3><p>On <em>Advanced sharing settings</em> on host Windows machine, make sure all entries under <em>All Networks</em> item are selected as <strong>turned on</strong>. Otherwise, there might be a permission deny on mounting.</p><h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><p>For accessing host directory as root user, no <code>-o</code> flag needed when running <code>mount.cifs</code> command. Also, password for host root can be put as pressing <code>Enter</code>.</p><h3 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h3><p>Read and write to the shared directory will need <em>root permission</em> at this case.</p><h3 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h3><p>Simply running <code>umount</code> (unmount) the directory like unmount other device can disable the sharing.</p><h2 id="Next-Time"><a href="#Next-Time" class="headerlink" title="Next Time"></a>Next Time</h2><p>Every time start the linux vm, simply run <code>mount.cifs</code> again can enable the directory sharing.</p><p>Or it can be automated by a bash script as follow:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/bash</span><br><br>MOUNTED=$(<span class="hljs-built_in">df</span> -h /path/to/vm/shared/dir/ | grep dev)<br><br><span class="hljs-keyword">if</span> ! [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$MOUNTED</span>&quot;</span> ] ; <span class="hljs-keyword">then</span><br>    sudo mount.cifs //WIN-DESKTOP/shared_folder_name /path/to/vm/shared/dir/<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><p>If the CIFS is not mounted, the path is mounted from device tree <code>/dev</code> by default. But after mounting, it will be changed to the host shared folder name, this can be verified by <code>df -h</code>.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://linuxhint.com/shared_folders_hypver-v_ubuntu_guest/">Shared Folders over Hyper-V Ubuntu Guest</a></li><li><a href="https://www.isumsoft.com/it/share-files-folders-or-drives-between-host-and-hyper-v-virtual-machine/">Share Files, Folders or Drives Between Host and Hyper-V Virtual Machine</a></li><li><a href="https://cifs.com/">All About CIFS</a></li><li><a href="https://learn.microsoft.com/en-us/answers/questions/707320/attach-usb-device-to-hyper-v-guest-machine">Attach USB device to Hyper-V guest machine - Microsoft Q&amp;A</a></li><li><a href="https://www.maths.cam.ac.uk/computing/linux/unixinfo/perms">File Permissions and Sharing Files | Computing</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Hyper-V</tag>
      
      <tag>virtual machine</tag>
      
      <tag>mount</tag>
      
      <tag>CIFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Partition and Mount TF Card on Linux</title>
    <link href="/2023/06/13/access-tf/"/>
    <url>/2023/06/13/access-tf/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Partition-and-Mount-TF-Card-on-Linux"><a href="#Partition-and-Mount-TF-Card-on-Linux" class="headerlink" title="Partition and Mount TF Card on Linux"></a>Partition and Mount TF Card on Linux</h1><p>Simply plugging in a TF Card to the board may not work even with built-in drivers.</p><p>This blog takes an 16 GB micro SD card and a single board computer (SBC) Huashan-pi CV1812H as an example of how to do partitioning and mounting to let our Linux system recognize the card.</p><h2 id="Basic-Commands"><a href="#Basic-Commands" class="headerlink" title="Basic Commands"></a>Basic Commands</h2><h3 id="df"><a href="#df" class="headerlink" title="df"></a><code>df</code></h3><p>Running the bash command <code>df -h</code> allows you to see all mounted disk devices.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs console">Filesystem                Size      Used Available Use% Mounted on<br>/dev/root                13.6M     13.6M         0 100% /<br>devtmpfs                 33.3M         0     33.3M   0% /dev<br>tmpfs                    33.3M         0     33.3M   0% /dev/shm<br>tmpfs                     2.9G     80.0K      2.7G   0% /tmp<br>tmpfs                    33.3M     12.0K     33.3M   0% /run<br>tmpfs                    33.3M     12.0K     33.3M   0% /run<br>tmpfs                     2.9G     80.0K      2.7G   0% /tmp<br>tmpfs                    33.3M         0     33.3M   0% /var/empty<br>/dev/mmcblk0p6            5.5M      5.5M         0 100% /mnt/cfg<br>/dev/mmcblk0p7            2.9G     80.0K      2.7G   0% /mnt/data<br>/dev/mmcblk0p7            2.9G     80.0K      2.7G   0% /tmp<br></code></pre></td></tr></table></figure><p>It is clear that our 16 GB micro SD card is not listed.</p><h3 id="fdisk"><a href="#fdisk" class="headerlink" title="fdisk"></a><code>fdisk</code></h3><p>Running teh command <code>fdisk -l</code> shows all of hardware disk drives:</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs console">Disk /dev/mmcblk0: 7456 MB, 7818182656 bytes, 15269888 sectors<br>238592 cylinders, 4 heads, 16 sectors/track<br>Units: sectors of 1 * 512 = 512 bytes<br><br>Disk /dev/mmcblk0 doesn&#x27;t contain a valid partition table<br>Disk /dev/mmcblk0p1: 8 MB, 8388608 bytes, 16384 sectors<br>256 cylinders, 4 heads, 16 sectors/track<br>Units: sectors of 1 * 512 = 512 bytes<br><br>Disk /dev/mmcblk0p1 doesn&#x27;t contain a valid partition table<br>Disk /dev/mmcblk1: 15 GB, 15931539456 bytes, 31116288 sectors<br>1936 cylinders, 255 heads, 63 sectors/track<br>Units: sectors of 1 * 512 = 512 bytes<br><br>Device       Boot StartCHS    EndCHS        StartLBA     EndLBA    Sectors  Size Id Type<br>/dev/mmcblk1p1    0,130,3     1023,254,63       8192   31116287   31108096 14.8G  c Win95 FAT32 (LBA)<br></code></pre></td></tr></table></figure><p><em>Line 11</em> is exactly what we are looking for. This 15 GB is the size of our TF card. There is always <a href="https://www.integralmemory.com/faq1/why-does-my-usb-drive-show-less-capacity-than-stated-on-my-pc-or-mac/">a discrepancy between the labeled size and the actual available size on OS</a>, which can be quite annoying.</p><p>Our card is located at the path <code>/dev/mmcblk1</code></p><h2 id="Partitioning"><a href="#Partitioning" class="headerlink" title="Partitioning"></a>Partitioning</h2><p>The next step is going to partition the disk. This can be done by using the <code>fdisk</code> command. For more details, you can refer to <code>man fdisk</code> or <code>tldr fdisk</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">fdisk /dev/mmcblk1<br></code></pre></td></tr></table></figure><p>This command will allow us to perform the partitioning.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs console">The number of cylinders for this disk is set to 1936.<br>There is nothing wrong with that, but this is larger than 1024,<br>and could in certain setups cause problems with:<br>1) software that runs at boot time (e.g., old versions of LILO)<br>2) booting and partitioning software from other OSs<br>   (e.g., DOS FDISK, OS/2 FDISK)<br><br>Command (m for help): p<br>Disk /dev/mmcblk1: 15 GB, 15931539456 bytes, 31116288 sectors<br>1936 cylinders, 255 heads, 63 sectors/track<br>Units: sectors of 1 * 512 = 512 bytes<br><br>Device       Boot StartCHS    EndCHS        StartLBA     EndLBA    Sectors  Size Id Type<br>/dev/mmcblk1p1    0,130,3     1023,254,63       8192   31116287   31108096 14.8G  c Win95 FAT32 (LBA)<br><br>Command (m for help): n<br>Partition type<br>   p   primary partition (1-4)<br>   e   extended<br>e<br>Partition number (1-4): 4<br>First sector (63-31116287, default 63):<br>Using default value 63<br>Last sector or +size&#123;,K,M,G,T&#125; (63-8191, default 8191):<br>Using default value 8191<br><br>Command (m for help): w<br>The partition table has been altered.<br>Calling ioctl() to re-read partition table<br></code></pre></td></tr></table></figure><p>press <code>Enter</code> to use default values for the first and last sector.</p><p>These values represent disk location references that map to specific locations on the disk. </p><h2 id="Mounting"><a href="#Mounting" class="headerlink" title="Mounting"></a>Mounting</h2><p>The last step is to mount the drive to a directory path. If the path <code>/mnt/sd</code> does not exist, create it using the <code>mkdir</code> command.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mount /dev/mmcblk1p1 /mnt/sd<br></code></pre></td></tr></table></figure><h2 id="Done"><a href="#Done" class="headerlink" title="Done"></a>Done</h2><p>We are all set now. Running the command <code>df -Th</code> will verify that our TF card is mounted with <code>vfat</code> type, which corresponds to the <code>FAT32</code> file system.</p><figure class="highlight console"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs console">Filesystem           Type            Size      Used Available Use% Mounted on<br>/dev/mmcblk1p1       vfat           14.8G    672.0K     14.8G   0% /mnt/sd<br></code></pre></td></tr></table></figure><h2 id="On-Removal"><a href="#On-Removal" class="headerlink" title="On Removal"></a>On Removal</h2><p>Simply unmount the device so that the card can be removed safely.</p><ol><li>Do not use the resource inside the mounted device, e.g., reading from or writing to it, and remember navigate outside the directory <code>/mnt/sd</code>.</li><li>Run command <code>umount /mnt/sd</code> (unmount by mounted directory path) or <code>umount /dev/mmcblk1p1</code> (unmount by device name), they are equivalent.</li></ol><h2 id="Next-Time"><a href="#Next-Time" class="headerlink" title="Next Time"></a>Next Time</h2><p>Next time when you restart the board or plugged in the micro SD card again, running command <code>mount /dev/mmcblk1p1 /mnt/sd</code> is needed, otherwise the system still do not have a path to access the file in the card.</p><p>Alternatively, you can put the following lines into shell script to automate the procedure.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/bin/sh</span><br><br><span class="hljs-comment"># Check if the TF card device exists</span><br><span class="hljs-keyword">if</span> [ -e <span class="hljs-string">&quot;/dev/mmcblk1&quot;</span> ]; <span class="hljs-keyword">then</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;TF card is detected. Mounting...&quot;</span><br>    mount /dev/mmcblk1p1 /mnt/sd   <span class="hljs-comment"># Replace /mnt/sd with your desired mount point</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;TF card mounted successfully.&quot;</span><br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;TF card is not detected.&quot;</span><br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://doc-en.rvspace.org/VisionFive2/Quick_Start_Guide/VisionFive2_QSG/extend_partition.html">Extend Partition on SD Card or eMMC</a></li><li><a href="http://blog.itpub.net/20674423/viewspace-722812">Linuxä¸‹åˆ†åŒºè¯¦è§£ä¹‹â€“Fdisk_ITPUBåšå®¢</a></li><li><a href="https://github.com/sophgo/sophpi-huashan/wiki/4.%E5%BC%80%E5%8F%91%E6%9D%BF%E7%A1%AC%E4%BB%B6%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97#1%E5%8D%8E%E5%B1%B1%E6%B4%BE-cv181%E7%B3%BB%E5%88%97%E5%BC%80%E5%8F%91%E6%9D%BF%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D">4.1. åŽå±±æ´¾-CV181ç³»åˆ—å¼€å‘æ¿åŸºæœ¬ä»‹ç» Â· sophgo&#x2F;sophpi-huashan Wiki</a></li><li><a href="https://tldp.org/HOWTO/Partition/requirements.html">4. Partitioning requirements</a></li><li><a href="https://tldp.org/HOWTO/Partition/fdisk_partitioning.html#mixed">5. Partitioning with fdisk - 5.3. Mixed primary and logical partitions</a></li><li><a href="https://www.integralmemory.com/faq1/why-does-my-usb-drive-show-less-capacity-than-stated-on-my-pc-or-mac/">Why does my USB drive show less capacity than stated on my PC or MAC | Integral Memory</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>TF Card</tag>
      
      <tag>Linux</tag>
      
      <tag>Mount</tag>
      
      <tag>Partition</tag>
      
      <tag>SBC</tag>
      
      <tag>Huashan-pi</tag>
      
      <tag>Disk</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åœ¨äº‘æœåŠ¡å™¨éƒ¨ç½² VS Code Server</title>
    <link href="/2023/06/01/code-server-cn/"/>
    <url>/2023/06/01/code-server-cn/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="åœ¨äº‘æœåŠ¡å™¨éƒ¨ç½²-VS-Code"><a href="#åœ¨äº‘æœåŠ¡å™¨éƒ¨ç½²-VS-Code" class="headerlink" title="åœ¨äº‘æœåŠ¡å™¨éƒ¨ç½² VS Code"></a>åœ¨äº‘æœåŠ¡å™¨éƒ¨ç½² VS Code</h1><h2 id="çŽ¯å¢ƒ"><a href="#çŽ¯å¢ƒ" class="headerlink" title="çŽ¯å¢ƒ"></a>çŽ¯å¢ƒ</h2><table><thead><tr><th>çŽ¯å¢ƒ</th><th>ç‰ˆæœ¬</th></tr></thead><tbody><tr><td>Debian GNU&#x2F;Linux</td><td>11 (bullseye)</td></tr><tr><td>systemd (systemctl)</td><td>247 (247.3-7+deb11u3)</td></tr><tr><td>nginx</td><td>1.18.0</td></tr><tr><td>code-server</td><td>4.13.0</td></tr></tbody></table><p>å…¶ä¸­ <code>code-server</code> ä¼šåœ¨åŽé¢ç”¨å®‰è£…è„šæœ¬å®‰è£…ã€‚</p><h2 id="å…·ä½“æ­¥éª¤"><a href="#å…·ä½“æ­¥éª¤" class="headerlink" title="å…·ä½“æ­¥éª¤"></a>å…·ä½“æ­¥éª¤</h2><h3 id="1-å‡çº§"><a href="#1-å‡çº§" class="headerlink" title="1. å‡çº§"></a>1. å‡çº§</h3><p>åœ¨ root æƒé™ä¸‹æ›´æ–°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">apt update<br>apt upgrade<br></code></pre></td></tr></table></figure><h3 id="2-å®‰è£…-VS-Code-Server"><a href="#2-å®‰è£…-VS-Code-Server" class="headerlink" title="2. å®‰è£… VS Code Server"></a>2. å®‰è£… VS Code Server</h3><p>ä½¿ç”¨ Code æä¾›çš„å®‰è£…è„šæœ¬å®‰è£… Code Serverã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -SL https://code-server.dev/install.sh | sh<br></code></pre></td></tr></table></figure><h3 id="3-å¯åŠ¨-Code-æœåŠ¡"><a href="#3-å¯åŠ¨-Code-æœåŠ¡" class="headerlink" title="3. å¯åŠ¨ Code æœåŠ¡"></a>3. å¯åŠ¨ Code æœåŠ¡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl <span class="hljs-built_in">enable</span> --now code-server@<span class="hljs-variable">$USER</span><br>systemctl start code-server@<span class="hljs-variable">$USER</span><br>systemctl status code-server@<span class="hljs-variable">$USER</span><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° Code Server æ­£åœ¨ç›‘å¬ <code>localhost:8080</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">~<span class="hljs-comment"># curl localhost:8080</span><br>Found. Redirecting to ./login<br>~<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h3 id="4-åœ¨æœåŠ¡å™¨æŽ§åˆ¶å°å¼€æ”¾ç«¯å£"><a href="#4-åœ¨æœåŠ¡å™¨æŽ§åˆ¶å°å¼€æ”¾ç«¯å£" class="headerlink" title="4. åœ¨æœåŠ¡å™¨æŽ§åˆ¶å°å¼€æ”¾ç«¯å£"></a>4. åœ¨æœåŠ¡å™¨æŽ§åˆ¶å°å¼€æ”¾ç«¯å£</h3><p>åœ¨æœåŠ¡å™¨çš„æŽ§åˆ¶å°ä¸­å¼€æ”¾éœ€è¦ç•™ç»™ Code Server ä½¿ç”¨çš„ç«¯å£ã€‚</p><p>Nginx é»˜è®¤ç›‘å¬ <code>80</code> ç«¯å£ï¼Œå¯åœ¨ä¸‹ä¸€æ­¥å®¢åˆ¶åŒ–ï¼ˆä¾‹å¦‚æ­¤å¤„æ”¹ä¸º <code>8443</code>ï¼‰ã€‚</p><h3 id="5-é€šè¿‡-Nginx-å°†-Code-Server-å…¬å¼€"><a href="#5-é€šè¿‡-Nginx-å°†-Code-Server-å…¬å¼€" class="headerlink" title="5. é€šè¿‡ Nginx å°† Code Server å…¬å¼€"></a>5. é€šè¿‡ Nginx å°† Code Server å…¬å¼€</h3><p>åœ¨ <code>/etc/nginx/sites-available/code-server</code> ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼ˆå¦‚æ–‡ä»¶ç›®å½•ä¸‹æ²¡æœ‰ <code>code-server</code> é…ç½®æ–‡ä»¶ï¼Œæ–°å»ºä¸€ä¸ªå³å¯ï¼‰ï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs Nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">8443</span>;<br>    <span class="hljs-attribute">listen</span> [::]:<span class="hljs-number">8443</span>;<br><br>    <span class="hljs-section">server_name</span> &#123;YOUR_DOMAIN_NAME&#125;;<br><br>    <span class="hljs-section">location</span> / &#123;<br>        <span class="hljs-attribute">proxy_pass</span> http://localhost:8080/;<br>        <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$host</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> Upgrade <span class="hljs-variable">$http_upgrade</span>;<br>        <span class="hljs-attribute">proxy_set_header</span> Connection upgrade;<br>        <span class="hljs-attribute">proxy_set_header</span> Accept-Encoding gzip;<br>        <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Host <span class="hljs-variable">$http_host</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„å°† <code>&#123;YOUR_DOMAIN_NAME&#125;</code> æ›¿æ¢ä¸ºå½“å‰åŸŸåæˆ–è€…æœåŠ¡å™¨ IP åœ°å€ã€‚</p><p>å¹¶ä¸”é€šè¿‡è½¯é“¾æŽ¥å°†å†…å®¹åŒæ­¥åˆ° <code>/etc/nginx/sites-enabled</code> ç›®å½•ä¸­ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">ln</span> -s /etc/nginx/sites-available/code-server /etc/nginx/sites-enabled/code-server<br></code></pre></td></tr></table></figure><p>æˆ–è€…å¤åˆ¶æ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cp</span> /etc/nginx/sites-available code-server /etc/nginx/sites-enabled/code-server<br></code></pre></td></tr></table></figure><p>ç„¶åŽå¯èƒ½éœ€è¦é‡æ–°åŠ è½½æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl daemon-reload<br></code></pre></td></tr></table></figure><h3 id="6-ä¿®æ”¹è®¿é—®å¯†ç "><a href="#6-ä¿®æ”¹è®¿é—®å¯†ç " class="headerlink" title="6. ä¿®æ”¹è®¿é—®å¯†ç "></a>6. ä¿®æ”¹è®¿é—®å¯†ç </h3><p>åœ¨è¿™æ—¶ Code Server å·²ç»å¯ä»¥é€šè¿‡è®¾ç½®çš„ç«¯å£ï¼ˆæ­¤å¤„ä¸º <code>8443</code>ï¼‰å…¬å¼€è®¿é—®äº†ï¼Œéœ€è¦å¯†ç ã€‚</p><p>é»˜è®¤å¯†ç åœ¨ <code>~/.config/code-server/config.yaml</code> ä¸­ï¼Œå¯ä»¥ç›´æŽ¥ä¿®æ”¹ã€‚</p><p>ä¿®æ”¹åŽé‡å¯ code-server æœåŠ¡ç”Ÿæ•ˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">systemctl start code-server@<span class="hljs-variable">$USER</span><br></code></pre></td></tr></table></figure><p><img src="/images/code/code-server.png" alt="VS Code on web browser"></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol><li><a href="https://github.com/coder/code-server">coder&#x2F;code-server: VS Code in the browser</a></li><li><a href="https://linux.how2shout.com/install-code-server-for-vs-code-on-ubuntu-22-04-or-20-04-lts/">Install Code-Server for VS code on Ubuntu 22.04 or 20.04 LTS</a></li><li><a href="https://code.visualstudio.com/docs/remote/vscode-server">Visual Studio Code Server</a></li><li><a href="https://chanwkim01.medium.com/how-to-set-up-code-server-daemon-on-ubuntu-root-access-docker-systemd-nginx-reverse-proxy-and-a72fa80e02e9">How to Set Up code-server daemon on Ubuntu for Deep Learning: Root Access, Docker, systemd, NGINX Reverse-Proxy, and More | by Chan Woo Kim | Medium</a></li><li><a href="https://community.home-assistant.io/t/studio-code-server-not-loading/545264">Studio Code Server not loading - Third party integrations - Home Assistant Community</a></li><li><a href="https://cloud.google.com/code/docs/vscode/deploy-service">Deploy a service in Cloud Code for VS Code Â |Â  Google Cloud</a></li><li><a href="https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html">Systemd å…¥é—¨æ•™ç¨‹ï¼šå‘½ä»¤ç¯‡ - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>VS Code</tag>
      
      <tag>Server</tag>
      
      <tag>Proxy</tag>
      
      <tag>Cloud</tag>
      
      <tag>Nginx</tag>
      
      <tag>ECS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>A Haskell Practice with Answer</title>
    <link href="/2023/05/25/hs-practice/"/>
    <url>/2023/05/25/hs-practice/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="A-Haskell-Practice-with-Answer"><a href="#A-Haskell-Practice-with-Answer" class="headerlink" title="A Haskell Practice with Answer"></a>A Haskell Practice with Answer</h1><p>The problem sheet can be found <a href="/files/21-22-6-7.pdf">here</a>.</p><h2 id="a"><a href="#a" class="headerlink" title="(a)"></a>(a)</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Haskell"><span class="hljs-title">m2</span> :: <span class="hljs-type">Matrix</span><br><span class="hljs-title">m2</span> = <span class="hljs-type">Row</span> [<span class="hljs-number">1.2</span>, -<span class="hljs-number">1.0</span>] (<span class="hljs-type">Row</span> [<span class="hljs-number">4.5</span>, -<span class="hljs-number">0.9</span>] (<span class="hljs-type">Row</span> [<span class="hljs-number">2.3</span>, <span class="hljs-number">1.8</span>] <span class="hljs-type">Null</span>))<br></code></pre></td></tr></table></figure><h2 id="b"><a href="#b" class="headerlink" title="(b)"></a>(b)</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Haskell"><span class="hljs-title">legitMatrix</span> :: <span class="hljs-type">Matrix</span> -&gt; <span class="hljs-type">Bool</span><br><span class="hljs-title">legitMatrix</span> <span class="hljs-type">Null</span> = <span class="hljs-type">True</span><br><span class="hljs-title">legitMatrix</span> (<span class="hljs-type">Row</span> row rest) = sameLength (length row) rest<br>Â  Â  <span class="hljs-keyword">where</span><br>Â  Â  Â  Â  isEnd <span class="hljs-type">Null</span> = <span class="hljs-type">True</span><br>Â  Â  Â  Â  isEnd _ = <span class="hljs-type">False</span><br>Â  Â  Â  Â  sameLength len <span class="hljs-type">Null</span> = <span class="hljs-type">True</span><br>Â  Â  Â  Â  sameLength len (<span class="hljs-type">Row</span> row rest) = length row == len &amp;&amp; sameLength len rest<br></code></pre></td></tr></table></figure><h2 id="c"><a href="#c" class="headerlink" title="(c)"></a>(c)</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Haskell"><span class="hljs-title">sizeMatrix</span> :: <span class="hljs-type">Matrix</span> -&gt; (<span class="hljs-type">Int</span>, <span class="hljs-type">Int</span>)<br><span class="hljs-title">sizeMatrix</span> <span class="hljs-type">Null</span> = (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br><span class="hljs-title">sizeMatrix</span> (<span class="hljs-type">Row</span> row rest) = (x, y)<br><span class="hljs-keyword">where</span> <br>y = length row<br>x = <span class="hljs-number">1</span> + columnSize rest<br>columnSize <span class="hljs-type">Null</span> = <span class="hljs-number">0</span><br>columnSize (<span class="hljs-type">Row</span> row rest) = <span class="hljs-number">1</span> + columnSize rest<br></code></pre></td></tr></table></figure><h2 id="d"><a href="#d" class="headerlink" title="(d)"></a>(d)</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Haskell"><span class="hljs-title">insertColumn</span> :: <span class="hljs-type">Matrix</span> -&gt; [<span class="hljs-type">Float</span>] -&gt; <span class="hljs-type">Matrix</span><br><span class="hljs-title">insertColumn</span> <span class="hljs-type">Null</span> [] = <span class="hljs-type">Null</span><br><span class="hljs-title">insertColumn</span> (<span class="hljs-type">Row</span> row rest) (x:xs) = <span class="hljs-type">Row</span> ([x] ++ row) (insertColumn rest xs)<br></code></pre></td></tr></table></figure><h2 id="e"><a href="#e" class="headerlink" title="(e)"></a>(e)</h2><p>An empty matrix which have 3 empty row, each row is a empty list.</p><h2 id="f"><a href="#f" class="headerlink" title="(f)"></a>(f)</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs Haskell"><span class="hljs-title">insertColumnRight</span> :: <span class="hljs-type">Matrix</span> -&gt; [<span class="hljs-type">Float</span>] -&gt; <span class="hljs-type">Matrix</span><br><span class="hljs-title">insertColumnRight</span> <span class="hljs-type">Null</span> [] = <span class="hljs-type">Null</span><br><span class="hljs-title">insertColumnRight</span> (<span class="hljs-type">Row</span> row rest) (x:xs) = <span class="hljs-type">Row</span> (row ++ [x]) (insertColumnRight rest xs)<br><br><span class="hljs-title">transposeMatrix</span> :: <span class="hljs-type">Matrix</span> -&gt; <span class="hljs-type">Matrix</span><br><span class="hljs-title">transposeMatrix</span> m = helper m e<br>Â  Â  <span class="hljs-keyword">where</span><br>Â  Â  Â  Â  (_, y) = sizeMatrix m<br>Â  Â  Â  Â  e = emptyMatrix y<br>Â  Â  Â  Â  helper <span class="hljs-type">Null</span> new = new<br>Â  Â  Â  Â  helper (<span class="hljs-type">Row</span> row rest) new = helper rest (insertColumnRight new row)<br></code></pre></td></tr></table></figure><p>Better one:</p><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs Haskell"><span class="hljs-title">transposeMatrix</span> :: <span class="hljs-type">Matrix</span> -&gt; <span class="hljs-type">Matrix</span><br><span class="hljs-title">transposeMatrix</span> (<span class="hljs-type">Row</span> a <span class="hljs-type">Null</span>) = insertColumn (emptyMatrix (length a)) a<br><span class="hljs-title">transposeMatrix</span> (<span class="hljs-type">Row</span> a b) = insertColumn (transposeMatrix b) a<br></code></pre></td></tr></table></figure><h2 id="g"><a href="#g" class="headerlink" title="(g)"></a>(g)</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs Haskell"><span class="hljs-title">addRows</span> :: [<span class="hljs-type">Float</span>] -&gt; [<span class="hljs-type">Float</span>] -&gt; [<span class="hljs-type">Float</span>]<br><span class="hljs-title">addRows</span> xs ys = [fst item + snd item | item &lt;- zip xs ys]<br><br><span class="hljs-comment">--    addRows xs ys = [xs !! i + ys !! i | i &lt;- index]</span><br><span class="hljs-comment">--    where</span><br><span class="hljs-comment">--        len = length xs</span><br><span class="hljs-comment">--        index = take len [0..]</span><br></code></pre></td></tr></table></figure><h2 id="h"><a href="#h" class="headerlink" title="(h)"></a>(h)</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs Haskell">(+#+) :: <span class="hljs-type">Matrix</span> -&gt; <span class="hljs-type">Matrix</span> -&gt; <span class="hljs-type">Matrix</span><br>(+#+) x <span class="hljs-type">Null</span> = x<br>(+#+) <span class="hljs-type">Null</span> x = x<br>(+#+) (<span class="hljs-type">Row</span> row1 rest1) (<span class="hljs-type">Row</span> row2 rest2) = <span class="hljs-type">Row</span> (addRows row1 row2) ((+#+) rest1 rest2)<br></code></pre></td></tr></table></figure><h2 id="i"><a href="#i" class="headerlink" title="(i)"></a>(i)</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Haskell">(+##+) :: <span class="hljs-type">Matrix</span> -&gt; <span class="hljs-type">Matrix</span> -&gt; <span class="hljs-type">Maybe</span> <span class="hljs-type">Matrix</span><br>(+##+) x y<br>Â  Â  | not (legitMatrix x) || not (legitMatrix y) = <span class="hljs-type">Nothing</span><br>Â  Â  | sizeMatrix x /= sizeMatrix y = <span class="hljs-type">Nothing</span><br>Â  Â  | otherwise = <span class="hljs-type">Just</span> ((+#+) x y)<br></code></pre></td></tr></table></figure><h2 id="j"><a href="#j" class="headerlink" title="(j)"></a>(j)</h2><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs Haskell"><span class="hljs-title">showMatrix</span> :: <span class="hljs-type">Matrix</span> -&gt; <span class="hljs-type">IO</span>()<br><span class="hljs-title">showMatrix</span> <span class="hljs-type">Null</span> = putStr <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-title">showMatrix</span> (<span class="hljs-type">Row</span> row rest) = <br>    <span class="hljs-keyword">do</span><br>        putStr <span class="hljs-string">&quot;[&quot;</span><br>        putStr (display row)<br>        putStrLn <span class="hljs-string">&quot;]&quot;</span><br>        showMatrix rest<br>    <span class="hljs-keyword">where</span><br>        display row <br>            | length row == <span class="hljs-number">1</span> = show (head row)<br>            | otherwise = show (head row) ++ <span class="hljs-string">&quot;\t&quot;</span> ++ display (tail row)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Programming Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Matrix</tag>
      
      <tag>Polymorphism</tag>
      
      <tag>Haskell</tag>
      
      <tag>Functional Programming</tag>
      
      <tag>Currying</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hide Superclass Static Methods in Java</title>
    <link href="/2023/05/23/hide-static-java/"/>
    <url>/2023/05/23/hide-static-java/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Hide-Superclass-Static-Methods-in-Java"><a href="#Hide-Superclass-Static-Methods-in-Java" class="headerlink" title="Hide Superclass Static Methods in Java"></a>Hide Superclass Static Methods in Java</h1><p>A <code>static</code> method <em><strong>cannot</strong></em> be overridden in Java. </p><p>This is because the concept of method <strong>overriding</strong> is based on dynamic or late binding, which means the actual method to be executed is determined at runtime based on the type of the object. And a static method cannot show runtime polymorphism.</p><p>However, Java does accept a static method existing in subclass with same declaration signature to its superclass. It does not override the static method in the superclass. Instead, it hides the superclass method, meaning the subclass has its own separate static method with the same name. </p><h2 id="Hiding"><a href="#Hiding" class="headerlink" title="Hiding"></a>Hiding</h2><p>This could be seen with the following example:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">myMethod</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        <span class="hljs-keyword">return</span> x + <span class="hljs-number">2</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">myMethod</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Simply calling static method is easy to understand: </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs Java">A.myMethod(<span class="hljs-number">5</span>); <span class="hljs-comment">// 5 + 2 = 7</span><br>B.myMethod(<span class="hljs-number">5</span>); <span class="hljs-comment">// 5 * 2 = 10</span><br></code></pre></td></tr></table></figure><p>The two methods exist peacefully. Inside the class <code>B</code>, the <code>myMethod</code> of class <code>A</code> is only <em>hidden</em> from the scope.</p><h2 id="Another-Perspective"><a href="#Another-Perspective" class="headerlink" title="Another Perspective"></a>Another Perspective</h2><p>Another way to check it out is like this:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">A</span> <span class="hljs-variable">myInstance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>myInstance.myMethod(<span class="hljs-number">5</span>); <span class="hljs-comment">// 5 + 2 = 7</span><br><br>myInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>myInstance.myMethod(<span class="hljs-number">5</span>); <span class="hljs-comment">// 5 + 2 = 7</span><br><br><span class="hljs-type">B</span> <span class="hljs-variable">anotherInstance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>anotherInstance.myMethod(<span class="hljs-number">5</span>); <span class="hljs-comment">// 5 * 2 = 10</span><br></code></pre></td></tr></table></figure><p>But note that access <code>static</code> method by instance is not a good practice. This is only for demonstration. Typically, it will cause a warning that <em>The static method <code>myMethod(int)</code> from the type <code>A</code> should be accessed in a static way</em>.</p><h2 id="Overriding"><a href="#Overriding" class="headerlink" title="Overriding"></a>Overriding</h2><p>Note how is this different from <strong>overriding</strong>.</p><p>For example, if both comment out the keyword <code>static</code> in class <code>A</code> and <code>B</code>,</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-comment">/* static */</span> <span class="hljs-type">int</span> <span class="hljs-title function_">myMethod</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        <span class="hljs-keyword">return</span> x + <span class="hljs-number">2</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-comment">/* static */</span> <span class="hljs-type">int</span> <span class="hljs-title function_">myMethod</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>In class <code>B</code>, overriding occurs, and the result of running <code>myMethod</code> would be different:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-type">A</span> <span class="hljs-variable">myInstance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">A</span>();<br>myInstance.myMethod(<span class="hljs-number">5</span>); <span class="hljs-comment">// 5 + 2 = 7</span><br><br>myInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>myInstance.myMethod(<span class="hljs-number">5</span>); <span class="hljs-comment">// 5 * 2 = 10</span><br><br><span class="hljs-type">B</span> <span class="hljs-variable">anotherInstance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>anotherInstance.myMethod(<span class="hljs-number">5</span>); <span class="hljs-comment">// 5 * 2 = 10</span><br></code></pre></td></tr></table></figure><p>There is also no warning anymore.</p><h2 id="Remark"><a href="#Remark" class="headerlink" title="Remark"></a>Remark</h2><p>Same as preventing from overriding, add keyword <code>final</code> can also prevent a <code>static</code> method from hiding.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://docs.oracle.com/javase/tutorial/java/IandI/override.html">Overriding and Hiding Methods (The Javaâ„¢ Tutorials &gt; Learning the Java Language &gt; Interfaces and Inheritance)</a></li><li><a href="https://stackoverflow.com/questions/2475259/can-i-override-and-overload-static-methods-in-java">Can I override and overload static methods in Java? - Stack Overflow</a></li><li><a href="https://www.javatpoint.com/can-we-override-static-method-in-java">Can We Override Static Method in Java - Javatpoint</a></li><li><a href="https://docs.oracle.com/javase/specs/jls/se20/html/jls-8.html#jls-8.4.3.3">ChapterÂ 8.Â Classes - 8.4.3.3. <code>final</code> Methods</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Programming Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Inheritance</tag>
      
      <tag>Static</tag>
      
      <tag>Polymorphism</tag>
      
      <tag>Overriding</tag>
      
      <tag>Hiding</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Subnet and IPv4 Classes</title>
    <link href="/2023/05/16/subnet/"/>
    <url>/2023/05/16/subnet/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Subnet-amp-IPv4-Classes"><a href="#Subnet-amp-IPv4-Classes" class="headerlink" title="Subnet &amp; IPv4 Classes"></a>Subnet &amp; IPv4 Classes</h1><h2 id="Subnet-amp-Subnet-Mask"><a href="#Subnet-amp-Subnet-Mask" class="headerlink" title="Subnet &amp; Subnet Mask"></a>Subnet &amp; Subnet Mask</h2><p>For a random IP address <code>a.b.c.d/x</code>, <code>x</code> denotes the number of <code>1</code>s in the <strong>subnet mask</strong>, starting from the most significant bits.</p><p>Divided by the <strong>subnet mask</strong>, the whole IP address can be seen as two parts: the <strong>network prefix</strong> and the <strong>host identifier</strong>.</p><p>For example, <code>192.168.19.123/20</code> is:</p><table><thead><tr><th>Address Type</th><th>Decimal</th><th>Binary</th></tr></thead><tbody><tr><td>IP Address</td><td><code>192.168.19.123</code></td><td><code>11000000.10101000.00010011.01111011</code></td></tr><tr><td>Subnet Mask</td><td><code>255.255.240.0</code></td><td><code>11111111.11111111.11110000.00000000</code></td></tr><tr><td>Host Identifier</td><td><code>0.0.3.123</code></td><td><code>00000000.00000000.00000011.01111011</code></td></tr><tr><td>Network Prefix</td><td><code>192.168.16.0</code></td><td><code>11000000.10101000.00010000.00000000</code></td></tr><tr><td>First Available Address</td><td><code>192.168.16.1</code></td><td><code>11000000.10101000.00010000.00000001</code></td></tr><tr><td>Last Available Address</td><td><code>192.168.31.254</code></td><td><code>11000000.10101000.00011111.11111110</code></td></tr><tr><td>Broadcast Address</td><td><code>192.168.31.255</code></td><td><code>11000000.10101000.00011111.11111111</code></td></tr></tbody></table><p>The subnet is always referred as its <strong>network prefix</strong>. It is used for routing outside the subnet.</p><p>Inside the subnet, connection and communication only care about the <strong>host identifier</strong>.</p><p>This two-layer separation makes routing more efficient and convenient.</p><h2 id="IPv4-Classes"><a href="#IPv4-Classes" class="headerlink" title="IPv4 Classes"></a>IPv4 Classes</h2><p>Itâ€™s wroth to note that IPv4 classes are already deprecated.</p><table><thead><tr><th>Class</th><th>Decimal</th><th>Binary</th></tr></thead><tbody><tr><td>A Start</td><td><code>1.0.0.0</code></td><td><code>00000001.00000000.00000000.00000000</code></td></tr><tr><td>A Private Start</td><td><code>10.0.0.0</code></td><td><code>00001010.00000000.00000000.00000000</code></td></tr><tr><td>A Private End</td><td><code>10.255.255.255</code></td><td><code>00001010.11111111.11111111.11111111</code></td></tr><tr><td>A End</td><td><code>127.0.0.0</code></td><td><code>01111111.00000000.00000000.00000000</code></td></tr><tr><td>A Mask</td><td><code>255.0.0.0</code></td><td><code>11111111.00000000.00000000.00000000</code></td></tr><tr><td>B Start</td><td><code>128.0.0.0</code></td><td><code>10000000.00000000.00000000.00000000</code></td></tr><tr><td>B Private Start</td><td><code>172.16.0.0</code></td><td><code>10101100.00010000.00000000.00000000</code></td></tr><tr><td>B Private End</td><td><code>172.31.255.255</code></td><td><code>10101100.00011111.11111111.11111111</code></td></tr><tr><td>B End</td><td><code>191.255.0.0</code></td><td><code>10111111.11111111.00000000.00000000</code></td></tr><tr><td>B Mask</td><td><code>255.255.0.0</code></td><td><code>11111111.11111111.00000000.00000000</code></td></tr><tr><td>C Start</td><td><code>192.0.0.0</code></td><td><code>11000000.00000000.00000000.00000000</code></td></tr><tr><td>C Private Start</td><td><code>192.168.0.0</code></td><td><code>11000000.10101000.00000000.00000000</code></td></tr><tr><td>C Private End</td><td><code>192.168.255.255</code></td><td><code>11000000.10101000.11111111.11111111</code></td></tr><tr><td>C End</td><td><code>223.255.255.0</code></td><td><code>11011111.11111111.11111111.00000000</code></td></tr><tr><td>C Mask</td><td><code>255.255.255.0</code></td><td><code>11111111.11111111.11111111.00000000</code></td></tr><tr><td>D Start</td><td><code>224.0.0.0</code></td><td><code>11100000.00000000.00000000.00000000</code></td></tr><tr><td>D End</td><td><code>239.255.255.255</code></td><td><code>11101111.11111111.11111111.11111111</code></td></tr><tr><td>E Start</td><td><code>240.0.0.0</code></td><td><code>11110000.00000000.00000000.00000000</code></td></tr><tr><td>E End</td><td><code>255.255.255.255</code></td><td><code>11111111.11111111.11111111.11111111</code></td></tr></tbody></table><h2 id="Quote"><a href="#Quote" class="headerlink" title="Quote"></a>Quote</h2><blockquote><p>æ‹¥å¡žå¦‚æžœä¸åŠ æŽ§åˆ¶çš„è¯ï¼Œå®ƒåçš„ç¨‹åº¦ä¼šéžå¸¸åï¼Œå°±æ˜¯è¿™ä¸ªæ¦‚å¿µã€‚ä½ ä¸åœ¨é€‚åˆçš„èŠ‚ç‚¹ï¼Œå’Œä¼ æŸ“ç—…ä¸€æ ·åˆ‡å…¥ä¸€ä¸‹ï¼Œå®ƒä¼ æŸ“çš„é€Ÿåº¦ä¼šéžå¸¸å¿«ï¼Œæ‰©å¼ çš„é€Ÿåº¦ä¼šéžå¸¸å¿«ã€‚è¿™æ˜¯ä¸€ä¸ªéžçº¿æ€§çš„æ€ç»´ã€‚é‚£ä¹ˆäººå•Šï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯çº¿æ€§çš„æ€ç»´ã€‚æœ‰äº›äº‹æƒ…æ˜¯éžçº¿æ€§çš„ã€‚æ‰€ä»¥è¯´äººå•Šï¼Œä¸ç®¡æ˜¯äººæœ¬èº«ï¼Œè¿˜æ˜¯æœºå™¨æœ¬èº«ï¼Œåœ¨å¤„ç†è¿™äº›éžçº¿æ€§çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šé€ æˆä¸€äº›è¯¯åˆ¤ã€‚</p></blockquote><div style='text-align: right'><p>Source: <a href="https://www.bilibili.com/video/BV1JV411t7ow/?p=28&t=755">ä¸­ç§‘å¤§éƒ‘çƒ‡ã€æ¨åšå…¨å¥—ã€Šè®¡ç®—æœºç½‘ç»œï¼ˆè‡ªé¡¶å‘ä¸‹æ–¹æ³• ç¬¬7ç‰ˆï¼ŒJames F.Kuroseï¼ŒKeith W.Rossï¼‰ã€‹è¯¾ç¨‹_3.6 æ‹¥å¡žæŽ§åˆ¶åŽŸç†_å“”å“©å“”å“©_bilibili</a></p></div><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul><li><a href="https://lexssama.github.io/2020/05/18/Chapter4-The-Network-Layer/">Chapter4-The-Network-Layer ~ Lexssamaâ€™s Blogs</a></li><li><a href="https://kiprey.github.io/2021/05/cnatda-2/">è®¡ç®—æœºç½‘ç»œç¬”è®°-2 | Kipreyâ€™s Blog</a></li><li><a href="https://avinetworks.com/glossary/subnet-mask/">What is Subnet Mask? Definition &amp; FAQs | Avi Networks</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages">HTTP Messages - HTTP | MDN</a></li><li><a href="https://www.zhihu.com/question/56895036/answer/155071962">å¦‚ä½•ç†è§£å­ç½‘æŽ©ç ï¼Ÿ - æˆ‘ä¸æ˜¯æ®µå­æ‰‹çš„å›žç­” - çŸ¥ä¹Ž</a></li><li><a href="https://en.wikipedia.org/wiki/Subnetwork">Subnetwork - Wikipedia</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Computer Network</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IP</tag>
      
      <tag>Routing</tag>
      
      <tag>Subnet</tag>
      
      <tag>Subnet Mask</tag>
      
      <tag>IPv4</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Update Weights in Linear Perceptron</title>
    <link href="/2023/05/12/perceptron/"/>
    <url>/2023/05/12/perceptron/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Update-Weights-in-Linear-Perceptron"><a href="#Update-Weights-in-Linear-Perceptron" class="headerlink" title="Update Weights in Linear Perceptron"></a>Update Weights in Linear Perceptron</h1><p>Sometimes you just find that preparing the data and visualizing it takes more time than building an AI model. </p><h2 id="Linear-Perceptron"><a href="#Linear-Perceptron" class="headerlink" title="Linear Perceptron"></a>Linear Perceptron</h2><p>It took me quite a long time to figure out how the weights are updated in a simple perceptron model. Basically it follows the gradient descent procedure, but things in linear algebra format confused me for a while and I donâ€™t know why so few people write it down explicitly. </p><p>It goes like this:</p><p><code>w_new</code> &#x3D; <code>w_old</code> + <code>learning_rate</code> * (<code>y_true</code> - <code>y_predicted</code>) * <code>x</code></p><p>where</p><ul><li>all of the parameters are <strong>vectors</strong>, except the learning rate.</li><li><code>x</code> is the input vector</li><li><code>y_true</code> is the true label of the input (either 1 or -1 for a binary classification problem)</li><li><code>y_predicted</code> is the predicted label of the input (either 1 or -1 for a binary classification problem)</li></ul><p>If it predicts a positive value as negative, <code>w</code> should be set higher and vice versa.</p><h2 id="Some-Quotes"><a href="#Some-Quotes" class="headerlink" title="Some Quotes"></a>Some Quotes</h2><p>Here are some intriguing quotes from Prof. Hung-yi Lee (æŽå®æ¯…)â€™s lecture. What a charismatic man.</p><blockquote><p>å¥½ï¼Œé‚£åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®²äº†å¾ˆå¤šå„å¼å„æ ·çš„æ¨¡åž‹ï¼Œé‚£æˆ‘ä»¬çŽ°åœ¨è¿˜ç¼ºäº†ä¸€ä¸ªä¸œè¥¿ï¼Œä½ çŸ¥é“ç¼ºä»€ä¹ˆä¸œè¥¿å—ï¼Ÿç¼ºä¸€ä¸ªå¥½åå­—ã€‚ä½ çŸ¥é“è¿™ä¸ªå¤–è¡¨å•Šæ˜¯å¾ˆé‡è¦çš„ï¼Œä¸€ä¸ªæ­»è‡­é…¸å®…ç©¿ä¸Šè¥¿è£…ä»¥åŽå°±æ½®äº†èµ·æ¥ï¼›æˆ–è€…æ˜¯ç»‡å¸­è´©å±¥çš„ï¼Œè¯´ä»–æ˜¯æ±‰å·¦å°†å†›å®œåŸŽäº­ä¾¯ä¸­å±±é–çŽ‹ä¹‹åŽï¼Œä¹Ÿå°±æ½®äº†èµ·æ¥ï¼Œå¯¹ä¸å¯¹ï¼Ÿæ‰€ä»¥æˆ‘ä»¬çš„æ¨¡åž‹ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªå¥½åå­—ã€‚</p></blockquote><div style='text-align: right'><p>Source: <a href="https://youtu.be/bHcJCp2Fyxs?t=2955">ã€æ©Ÿå™¨å­¸ç¿’2021ã€‘é æ¸¬æœ¬é »é“è§€çœ‹äººæ•¸ (ä¸‹) - æ·±åº¦å­¸ç¿’åŸºæœ¬æ¦‚å¿µç°¡ä»‹ - YouTube</a></p></div><blockquote><p>Neuron æ˜¯ä»€ä¹ˆï¼ŸNeuron å°±æ˜¯ç¥žç»å…ƒã€‚äººè„‘ä¸­å°±æ˜¯æœ‰å¾ˆå¤šç¥žç»å…ƒï¼Œå¾ˆå¤šç¥žç»å…ƒä¸²èµ·æ¥å°±æ˜¯ä¸€ä¸ªç¥žç»ç½‘è·¯ï¼Œè·Ÿä½ çš„è„‘æ˜¯ä¸€æ ·çš„ã€‚æŽ¥ä¸‹æ¥ä½ å°±å¯ä»¥åˆ°å¤„éª—éº»ç“œè¯´ï¼Œâ€œçœ‹åˆ°æ²¡æœ‰ï¼Œè¿™ä¸ªæ¨¡åž‹å°±æ˜¯åœ¨æ¨¡æ‹Ÿäººä»¬è„‘ï¼ŒçŸ¥é“å—ï¼Ÿè¿™å°±æ˜¯åœ¨æ¨¡æ‹Ÿäººè„‘ï¼Œè¿™ä¸ªå°±æ˜¯äººå·¥æ™ºæ…§â€ï¼Œç„¶åŽéº»ç“œå°±ä¼šå“å¾—æŠŠé’±æŽå‡ºæ¥ã€‚</p><p>ä½†æ˜¯å•Šï¼Œè¿™ä¸ªæŠŠæˆåœ¨ 80ï¼Œ90 å¹´ä»£çš„æ—¶å€™å·²ç»çŽ©è¿‡äº†ã€‚Neural Network ä¸æ˜¯ä»€ä¹ˆæ–°çš„æŠ€æœ¯ï¼Œ80ï¼Œ90 å¹´ä»£å°±å·²ç»ç”¨è¿‡äº†ï¼Œå½“æ—¶å·²ç»æŠŠè¿™ä¸ªæŠ€æœ¯çš„åå­—æžåˆ°è‡­æŽ‰äº†ã€‚Neural Network å› ä¸ºä¹‹å‰è¢«å¹æ§å¾—å¤ªè¿‡æµ®å¤¸ï¼Œæ‰€ä»¥åŽæ¥å¤§å®¶å¯¹ Neural Network è¿™ä¸ªåå­—éƒ½éžå¸¸åœ°æ„Ÿå†’ã€‚å®ƒå°±åƒæ˜¯ä¸ªè„è¯ä¸€æ ·ï¼Œå†™åœ¨ paper ä¸Šé¢éƒ½æ³¨å®šå®³ä½ çš„ paper è¢«æ‹’ç»ã€‚æ‰€ä»¥åŽæ¥ä¸ºäº†è¦é‡æŒ¯ Neural Network çš„é›„é£Žï¼Œæ‰€ä»¥æ€Žä¹ˆåŠžå‘¢ï¼Ÿéœ€è¦æ–°çš„åå­—ã€‚æ€Žä¹ˆæ ·æ–°çš„åå­—å‘¢ï¼Ÿè¿™è¾¹æœ‰å¾ˆå¤šçš„ Neuronï¼Œæ¯ä¸€æŽ’ Neuron æˆ‘ä»¬å°±å«å®ƒä¸€ä¸ª Layerï¼Œå®ƒä»¬å« Hidden Layerã€‚æœ‰å¾ˆå¤šçš„ Hidden Layer å°±å«åš Deepï¼Œè¿™æ•´å¥—æŠ€æœ¯å°±å«åš Deep Learningã€‚</p></blockquote><div style='text-align: right'><p>Source: <a href="https://youtu.be/bHcJCp2Fyxs?t=2989">ã€æ©Ÿå™¨å­¸ç¿’2021ã€‘é æ¸¬æœ¬é »é“è§€çœ‹äººæ•¸ (ä¸‹) - æ·±åº¦å­¸ç¿’åŸºæœ¬æ¦‚å¿µç°¡ä»‹ - YouTube</a></p></div><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://www.youtube.com/watch?v=Ye018rCVvOo">ã€æ©Ÿå™¨å­¸ç¿’2021ã€‘é æ¸¬æœ¬é »é“è§€çœ‹äººæ•¸ (ä¸Š) - æ©Ÿå™¨å­¸ç¿’åŸºæœ¬æ¦‚å¿µç°¡ä»‹ - YouTube</a></li><li><a href="https://www.youtube.com/watch?v=bHcJCp2Fyxs">ã€æ©Ÿå™¨å­¸ç¿’2021ã€‘é æ¸¬æœ¬é »é“è§€çœ‹äººæ•¸ (ä¸‹) - æ·±åº¦å­¸ç¿’åŸºæœ¬æ¦‚å¿µç°¡ä»‹ - YouTube</a></li><li><a href="https://speech.ee.ntu.edu.tw/~hylee/index.php">Hung-yi Lee (æŽå®æ¯…)</a></li><li><a href="https://inst.eecs.berkeley.edu/~cs188/fa22/assets/notes/cs188-fa22-note20.pdf">cs188-fa22-note20.pdf</a></li><li><a href="https://inst.eecs.berkeley.edu/~cs188/fa22/">CS 188 Fall 2022 | Introduction to Artificial Intelligence at UC Berkeley</a></li><li><a href="https://www.youtube.com/watch?v=iZTeva0WSTQ&list=PLoROMvodv4rMiGQp3WXShtMGgzqpfVfbU&index=5">Lecture 4 - Perceptron &amp; Generalized Linear Model | Stanford CS229: Machine Learning (Autumn 2018) - YouTube</a></li><li><a href="https://cs229.stanford.edu/syllabus-spring2021.html">CS229: Machine Learning</a></li><li><a href="https://wty-yy.space/posts/62139/">Perceptron Learning Algorithm æ„ŸçŸ¥å™¨ç®—æ³• - ç¥žç»ç½‘ç»œåŸºç¡€ - wtyâ€™s blog</a></li><li><a href="https://www.cnblogs.com/pinard/p/6042320.html">æ„ŸçŸ¥æœºåŽŸç†å°ç»“ - åˆ˜å»ºå¹³Pinard - åšå®¢å›­</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Algorithms &amp; Data Structures</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Optimization</tag>
      
      <tag>Machine Learning</tag>
      
      <tag>Artificial Intelligence</tag>
      
      <tag>Linear Perceptron</tag>
      
      <tag>Neural Network</tag>
      
      <tag>Deep Learning</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>A MDP Take-away</title>
    <link href="/2023/05/07/mdp/"/>
    <url>/2023/05/07/mdp/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="A-MDP-Take-away"><a href="#A-MDP-Take-away" class="headerlink" title="A MDP Take-away"></a>A MDP Take-away</h1><p>A <strong>Markov decision process</strong> take-away.</p><h2 id="Problem-Formulation"><a href="#Problem-Formulation" class="headerlink" title="Problem Formulation"></a>Problem Formulation</h2><ul><li><code>states</code>: a set of all possible states</li><li><code>start_state</code>: starting state</li><li><code>actions(state)</code>: with given state, return a list of all valid action</li><li><code>T(state, action, new_state)</code>: return probability of <code>s&#39;</code> if taking action <code>a</code> at state <code>s</code></li><li><code>reward(state, action, new_state)</code>: return reward for the given transition</li><li><code>is_end(state)</code>: check whether at terminal state</li><li><code>gamma</code> &#x2F; <code>discount</code>: discount factor for future (not bigger than 1 and not less than 0)</li></ul><h2 id="Value-Iteration"><a href="#Value-Iteration" class="headerlink" title="Value Iteration"></a>Value Iteration</h2><p><strong>Value iteration</strong> converges quite fast.</p><ul><li>initialize <code>v</code> of all states <code>s</code> to 0</li><li>for iteration <code>t</code> in <code>1..</code> (until convergence or max iteration depth)<ul><li>for each state <code>s</code><ul><li>for <code>a</code> in <code>actions(s)</code><ul><li>get <code>q</code> value <code>Q(s, a)</code></li></ul></li><li>take maximum of all <code>q</code> values <code>max_q</code></li><li>update <code>v</code> of <code>s</code> with <code>max_q</code></li></ul></li></ul></li><li>return all <code>v</code></li></ul><h3 id="Q-Value"><a href="#Q-Value" class="headerlink" title="Q Value"></a>Q Value</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs Python">Q(s: state, a: action) -&gt; <span class="hljs-built_in">float</span><br></code></pre></td></tr></table></figure><p>with given state <code>s</code> and action <code>a</code>:</p><ul><li>for all possible new state <code>new_state</code><ul><li>take possibility <code>T(state, action, new_state)</code> as <code>p</code></li><li>take rewards as <code>r</code></li><li><code>item</code> &#x3D; <code>p * (r + discount * v)</code>, where <code>v</code> is value of <code>new_state</code></li><li>return the sum of all <code>item</code></li></ul></li></ul><h2 id="Policy-Evaluation"><a href="#Policy-Evaluation" class="headerlink" title="Policy Evaluation"></a>Policy Evaluation</h2><p><strong>Policy</strong> is a function which maps from a state to an action, specifying with given state, what action should be applied.</p><p>Use <strong>policy evaluation</strong> to determine whether a policy <code>pi</code> is good enough or outperforming other policies.</p><ul><li>initialize <code>v</code> of all states <code>s</code> to 0</li><li>for iteration <code>t</code> in <code>1..</code> (until convergence or max iteration depth)<ul><li>for each state <code>s</code><ul><li>action <code>a</code> comes form evaluated policy <code>pi</code></li><li>update <code>v</code> of <code>s</code> with <code>Q(s, a)</code></li></ul></li></ul></li></ul><p>This is done by cutting down all possible actions in <em>value iteration</em> to one action generated by evaluated policy <code>pi</code>.</p><h2 id="Policy-Iteration"><a href="#Policy-Iteration" class="headerlink" title="Policy Iteration"></a>Policy Iteration</h2><p>By evaluating and updating policy to find the best policy, i.e., all of the actions given by the policy is optimal and have the highest <code>v</code> value. So does the policy.</p><ul><li>randomly initialize policy <code>pi</code></li><li>for iteration <code>t</code> in <code>1..</code>, until convergence (<code>pi</code> not change) or max iteration depth<ul><li>get <code>v</code> of states by <em>policy evaluation</em></li><li>improve policy<ul><li>for <code>s</code> in all states<ul><li>for <code>a</code> in all valid actions<ul><li><code>q</code> &#x3D; <code>Q(s, a)</code></li></ul></li><li>get maximum <code>q</code> as <code>max_q</code></li><li>update policy of <code>s</code> to <code>a</code> with <code>max_q</code></li></ul></li></ul></li></ul></li></ul><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://www.youtube.com/watch?v=9g32v7bK3Co">Markov Decision Processes 1 - Value Iteration | Stanford CS221: AI (Autumn 2019) - YouTube</a></li><li><a href="https://www.youtube.com/watch?v=d5gaWTo6kDM">Lecture 17 - MDPs &amp; Value&#x2F;Policy Iteration | Stanford CS229: Machine Learning Andrew Ng (Autumn2018) - YouTube</a></li><li><a href="https://www.youtube.com/watch?v=06VGcri5240&list=PLp8QV47qJEg7a44Z3_q0apWF8s9a5soOI&index=9">[CS188 FA22] Lecture 7 - MDPs I - YouTube</a></li><li><a href="https://inst.eecs.berkeley.edu/~cs188/fa22/assets/notes/cs188-fa22-note07.pdf">cs188-fa22-note07.pdf</a></li><li><a href="https://www.baeldung.com/cs/ml-value-iteration-vs-policy-iteration">Value Iteration vs. Policy Iteration in Reinforcement Learning | Baeldung on Computer Science</a></li><li><a href="http://incompleteideas.net/book/ebook/node43.html">4.3 Policy Iteration</a></li><li><a href="https://cs50.harvard.edu/ai/2020/weeks/4/">Week 4 Learning - CS50â€™s Introduction to Artificial Intelligence with Python</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Algorithms &amp; Data Structures</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Optimization</tag>
      
      <tag>MDP</tag>
      
      <tag>Machine Learning</tag>
      
      <tag>Artificial Intelligence</tag>
      
      <tag>Bellman Equation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Manipulate 64-bit value with 32-bit registers</title>
    <link href="/2023/04/16/64bit-val-in-32/"/>
    <url>/2023/04/16/64bit-val-in-32/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Manipulate-64-bit-value-with-32-bit-registers"><a href="#Manipulate-64-bit-value-with-32-bit-registers" class="headerlink" title="Manipulate 64-bit value with 32-bit registers"></a>Manipulate 64-bit value with 32-bit registers</h1><p>Say, a 64-bit unsigned integer is stored at two 32-bit registers, <code>s0</code> (lower bits) and <code>s1</code> (higher bits) respectively.</p><h2 id="Addition"><a href="#Addition" class="headerlink" title="Addition"></a>Addition</h2><p>And now, we need to add a 32-bit unsigned integer stored at register <code>t0</code> to it, how could we do.</p><p>Recall the feature of twoâ€™s complement in binary, integer overflow is same as left a carry forgotten.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ASM">mv          t1, s0      # save a copy of lower bits<br>add         s0, s0, t0  # add to lower bits<br>sltu        t2, s0, t1  # check for carry<br>addi        s1, s1, t2  # add carry<br></code></pre></td></tr></table></figure><p>Here <code>sltu</code> stands for <em>set less than unsigned</em>, meaning that if <code>s0</code> is less than <code>t1</code>, <code>t2</code> will be set to <code>1</code>, otherwise, <code>t2</code> will be <code>0</code>. This is just what we need.</p><p>If the new lower 32 bits is smaller than the original one (at <code>t1</code>), meaning there is an overflow, so we should increase the higher 32 bits <code>s1</code> by 1.</p><h2 id="Subtraction"><a href="#Subtraction" class="headerlink" title="Subtraction"></a>Subtraction</h2><p>This can also apply to subtraction.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs asm">mv          t1, s0<br>sub         s0, s0, t1<br>sltu        t2, s0, t1<br>addi        t2, t2, 1<br>add         s1, s1, t2<br></code></pre></td></tr></table></figure><h2 id="More-Details"><a href="#More-Details" class="headerlink" title="More Details"></a>More Details</h2><p>Take 4 bits and 8 bits as an example.</p><table><thead><tr><th>Meaning</th><th align="right">binary</th><th>decimal</th></tr></thead><tbody><tr><td><em>1.</em> 8 bits unsigned integer</td><td align="right"><code>0x0001_0101</code></td><td>21</td></tr><tr><td><em>2.</em> 4 bits unsigned integer <code>t0</code></td><td align="right"><code>0x0111</code></td><td>7</td></tr><tr><td><em>3.</em> difference in 8 bits</td><td align="right"><code>0x0000_1110</code></td><td>14</td></tr><tr><td><em>4.</em> opposite number of <code>t0</code></td><td align="right"><code>0x1001</code></td><td>-</td></tr><tr><td><em>5.</em> add <em>4</em> to lower bits</td><td align="right"><code>0x1110</code></td><td>-</td></tr></tbody></table><p>If borrow occurred, value in <em>5</em> will greater than the lower bits of the original number.</p><p>In other words, if new lower bits is less than the original one, <code>t2</code> will be set to <code>1</code> and then <code>0</code>, there is no borrow. Otherwise, <code>t2</code> will be set to <code>0</code> and then <code>-1</code>, take away one from higher bits.</p>]]></content>
    
    
    <categories>
      
      <category>Algorithms &amp; Data Structures</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RISC-V</tag>
      
      <tag>Register</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Peripheral Interrupt Procedure in RISC-V</title>
    <link href="/2023/04/02/peripheral-interrupt/"/>
    <url>/2023/04/02/peripheral-interrupt/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Peripheral-Interrupt-Procedure-in-RISC-V"><a href="#Peripheral-Interrupt-Procedure-in-RISC-V" class="headerlink" title="Peripheral Interrupt Procedure in RISC-V"></a>Peripheral Interrupt Procedure in RISC-V</h1><p>The procedure of peripheral interrupt in RISC-V is quite complicated and multi-layered.</p><p>Basically, all peripheral interrupts are reported to <strong>platform-level interrupt controller</strong> or <strong>PLIC</strong>, which is similar to PIC (programmable interrupt controller) in x86 architecture.</p><p>The memory mapped from PLIC varied by platforms. Chapter 3 of official <a href="https://github.com/riscv/riscv-plic-spec">PLIC Specification</a> gives a sample. In QEMU, it could be found under <a href="https://github.com/qemu/qemu/tree/master/include/hw/riscv"><code>qemu/include/hw/riscv</code></a> folder.</p><h2 id="Registers"><a href="#Registers" class="headerlink" title="Registers"></a>Registers</h2><p>There are (five types of) registers for PLIC:</p><ul><li><code>priority</code></li><li><code>pending</code></li><li><code>enable</code></li><li><code>threshold</code></li><li><code>claim</code>&#x2F;<code>complete</code></li></ul><h3 id="Priorities"><a href="#Priorities" class="headerlink" title="Priorities"></a>Priorities</h3><p>The priorities of external interrupts are defined in <code>priority</code> registers, whose ranges from <code>1</code> to <code>1023</code> (1023 sources in total, also known as <em>interrupt identifiers</em>, ID). Note that <code>0</code> is reserved for no interrupt occurring.</p><p>1 interrupt source maps to 1 register. For example, </p><table><thead><tr><th>Address</th><th>Mapping</th></tr></thead><tbody><tr><td><code>base</code> + <code>0x0000</code></td><td><strong>Reserved</strong></td></tr><tr><td><code>base</code> + <code>0x0004</code></td><td>priority value of Interrupt source 1</td></tr><tr><td><code>base</code> + <code>0x0008</code></td><td>priority value of Interrupt source 2</td></tr><tr><td>â€¦</td><td>â€¦</td></tr><tr><td><code>base</code> + <code>0x0FFC</code></td><td>priority value of Interrupt source 1023</td></tr></tbody></table><p>The value in the <code>priority</code> is the priority level of mapped resource. <code>0</code> is representing <em>never interrupt</em>, and the larger the higher priority.</p><p>If two interrupt resources have the same priority level, PLIC will get the smallest ID first and give the interrupt to Hart to handle.</p><h4 id="QEMU-Specific"><a href="#QEMU-Specific" class="headerlink" title="QEMU Specific"></a>QEMU Specific</h4><p>QEMUâ€™s RISC-V virtual machine <a href="https://github.com/qemu/qemu/blob/master/hw/riscv/virt.c"><code>virt</code></a> supports 7 levels of priority.</p><p>In its <code>create_pcie_irq_map</code> function, it set that</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C">qemu_fdt_setprop_cells(fdt, nodename, <span class="hljs-string">&quot;interrupt-map-mask&quot;</span>,<br>                           <span class="hljs-number">0x1800</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x7</span>);<br></code></pre></td></tr></table></figure><p><code>qemu_fdt_setprop_cells</code> is a function-like macro defined in <code>qemu/include/sysemu/device_tree.h</code>, helping set up. <code>fdt</code> stands for <em>flattened device tree</em> and represents the device tree blob pointer. And <code>prop</code> means properties. It treats <code>interrupt-map-mask</code> as a property whit smallest value <code>0</code> and biggest value <code>7</code>.</p><h3 id="Pending"><a href="#Pending" class="headerlink" title="Pending"></a>Pending</h3><p>Each bit of <code>pending</code> corresponds to one interrupt source, <code>1</code> for interrupt happening.  </p><h2 id="Interrupt-Flow"><a href="#Interrupt-Flow" class="headerlink" title="Interrupt Flow"></a>Interrupt Flow</h2><p>When external interrupts come in:</p><ol><li><strong>PLIC</strong> checks their <code>priority</code><ul><li>if same, get the one with the smallest interrupt source ID</li></ul></li><li><strong>PLIC</strong> checks <code>enable</code></li><li><strong>PLIC</strong> checks is the <code>priority</code> bigger than <code>threshold</code></li><li><strong>PLIC</strong> sets corresponding <code>pending</code><ul><li>HARTâ€™s running is interrupted and starts to handle the interrupt</li></ul></li><li><strong>HART</strong> reads value from <code>claim</code> to know interrupt source ID</li><li><strong>HART</strong> calls corresponding functions</li><li><strong>HART</strong> writes back to <code>complete</code></li><li><strong>HART</strong> returns to normal running</li><li><strong>PLIC</strong> cleans the <code>pending</code></li></ol><h2 id="Initialization"><a href="#Initialization" class="headerlink" title="Initialization"></a>Initialization</h2><ol><li>Define interrupt source ID</li><li>Set <code>priority</code></li><li>Set <code>enable</code></li><li>Set <code>threshold</code></li><li>Set <code>MIE</code> bit in <code>mstatus</code>, M-mode global interrupt-enable bit (for M-mode)</li><li>Set <code>MEIE</code> bit in <code>mie</code>, machine-level external interrupts enable bit in machine interrupt enable register.</li></ol><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://github.com/riscv/riscv-plic-spec">riscv&#x2F;riscv-plic-spec: PLIC Specification</a></li><li><a href="https://www.bilibili.com/video/BV1Q5411w7z5/?p=21">[å®Œç»“] å¾ªåºæ¸è¿›ï¼Œå­¦ä¹ å¼€å‘ä¸€ä¸ªRISC-Vä¸Šçš„æ“ä½œç³»ç»Ÿ - æ±ªè¾° - 2021æ˜¥ï¼šç¬¬11ç« -å¤–éƒ¨è®¾å¤‡ä¸­æ–­_å“”å“©å“”å“©_bilibili</a></li><li><a href="https://picguides.com/beginner/interrupts.php">Interrupts - Beginnerâ€™s Guide to PIC Programming - picguides.com</a></li><li><a href="https://github.com/cccriscv/mini-riscv-os/blob/master/doc/tw/07-ExterInterrupt.md">mini-riscv-os&#x2F;07-ExterInterrupt.md at master Â· cccriscv&#x2F;mini-riscv-os</a></li><li><a href="https://wiki.osdev.org/PLIC">PLIC - OSDev Wiki</a></li><li><a href="https://wiki.osdev.org/PIC">8259 PIC - OSDev Wiki</a></li><li><a href="https://github.com/ianchen0119/AwesomeCS/wiki/2-4-RISC-V::%E4%B8%AD%E6%96%B7%E8%88%87%E7%95%B0%E5%B8%B8%E8%99%95%E7%90%86----%E4%B8%AD%E6%96%B7%E7%AF%87">2 4 RISC V::ä¸­æ–·èˆ‡ç•°å¸¸è™•ç† ä¸­æ–·ç¯‡ Â· ianchen0119&#x2F;AwesomeCS Wiki</a></li><li><a href="https://github.com/ianchen0119/AwesomeCS/wiki/2-5-RISC-V::%E4%B8%AD%E6%96%B7%E8%88%87%E7%95%B0%E5%B8%B8%E8%99%95%E7%90%86----PLIC-%E4%BB%8B%E7%B4%B9">2 5 RISC V::ä¸­æ–·èˆ‡ç•°å¸¸è™•ç† PLIC ä»‹ç´¹ Â· ianchen0119&#x2F;AwesomeCS Wiki</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Operating System &amp; Architecture</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RISC-V</tag>
      
      <tag>QEMU</tag>
      
      <tag>Emulation</tag>
      
      <tag>Interrupt</tag>
      
      <tag>Peripheral</tag>
      
      <tag>PLIC</tag>
      
      <tag>FDT</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Align Number to Multiple</title>
    <link href="/2023/03/12/align/"/>
    <url>/2023/03/12/align/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Align-Number-to-Multiple"><a href="#Align-Number-to-Multiple" class="headerlink" title="Align Number to Multiple"></a>Align Number to Multiple</h1><p>Aligning an integer, say <code>n</code>, to its closest muplitple of <code>m</code> is easy by using <code>round(n / m) * m</code> (arithmetic division) or <code>(n + m - 1) / m * m</code> (<em>Euclidean division</em>).</p><p>However, if <code>m</code> is a power of 2, i.e., <code>m</code> &#x3D; 2<sup>k</sup>, using bitwise operations can help a lot.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C">aligned_n = (n + (m - <span class="hljs-number">1</span>)) &amp; ~(m - <span class="hljs-number">1</span>);<br></code></pre></td></tr></table></figure><h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>This should be viewed from a binary perspective.</p><p>For example, say <code>m = 8</code> and demonstrate it in 8-bit binary.</p><table><thead><tr><th>variable</th><th align="center">number</th><th align="center">binary</th></tr></thead><tbody><tr><td><code>m</code></td><td align="center">8</td><td align="center">0000 1000</td></tr><tr><td><code>m - 1</code></td><td align="center">7</td><td align="center">0000 0111</td></tr><tr><td><code>~(m - 1)</code></td><td align="center">&#x2F;</td><td align="center">1111 1000</td></tr></tbody></table><p>By applying <em>bitwise AND</em> <code>&amp;</code>, the lower bits of the number are cleaned to <code>0</code>, leaving the result becoming the multiple of <code>m</code>.</p><p>If not adding <code>m - 1</code>, the result will be the closest multiple smaller than <code>n</code>, and adding it makes sure the result is bigger than the original number <code>n</code>.</p><h2 id="Remark"><a href="#Remark" class="headerlink" title="Remark"></a>Remark</h2><p><code>(n + m/2) &amp; ~(m-1)</code> is an alternative, and adding a number ranging from <code>m/2</code> to <code>m - 1</code> is technically all fine.</p><p>This method could be helpful in memory page alignment, where standard library is not available and we can sacrifice a little bit of readability of the code. For example, <code>PGROUNDUP</code> and <code>PGROUNDDOWN</code> in <a href="https://github.com/mit-pdos/xv6-riscv/blob/riscv/kernel/riscv.h#L338-L339">xv6</a>, which stand for <em>page round up</em> and <em>page round down</em>, are implemented in this way.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://stackoverflow.com/questions/10493411/what-is-bit-masking">c - What is bit masking? - Stack Overflow</a></li><li><a href="https://graphics.stanford.edu/~seander/bithacks.html#RoundUpPowerOf2">Bit Twiddling Hacks - Round up to the next highest power of 2</a></li><li><a href="https://stackoverflow.com/questions/43289022/what-do-pgroundup-and-pgrounddown-in-xv6-mean">c - What do PGROUNDUP and PGROUNDDOWN in xv6 mean? - Stack Overflow</a></li><li><a href="https://github.com/mit-pdos/xv6-riscv">mit-pdos&#x2F;xv6-riscv: Xv6 for RISC-V</a></li><li><a href="https://en.wikipedia.org/wiki/Bitwise_operation">Bitwise operation - Wikipedia</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Algorithms &amp; Data Structures</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Optimization</tag>
      
      <tag>Memory</tag>
      
      <tag>Alignment</tag>
      
      <tag>Bitwise Operation</tag>
      
      <tag>xv6</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Read and Write by Polling with UART</title>
    <link href="/2023/02/28/polling-read-write/"/>
    <url>/2023/02/28/polling-read-write/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Read-and-Write-by-Polling-with-UART"><a href="#Read-and-Write-by-Polling-with-UART" class="headerlink" title="Read and Write by Polling with UART"></a>Read and Write by Polling with UART</h1><p>In the early stages of development, the first â€˜hello worldâ€™ is implemented via UART serial port since handling the screen is a more complicated task.</p><p>Developing on QEMU is just like developing on a physical machine. The kernel runs in the QEMU virtual machine, which is connected to the host machine by UART, specifically the <a href="http://byterunner.com/16550.html">16550 UART</a>.</p><p>UART, or universal asynchronous receiver&#x2F;transmitter, is a serial-port communicator embedded on board. It needs some settings and initialization for data tranmission, and these tasks are done in the file <code>uart.c</code>.</p><p>Basically, everything inside 16550 UART is mapped to the memory location <code>UART0</code>. One register may have one or more functionalities, and is always distinguished by the <strong>read mode</strong> and <strong>write mode</strong>.</p><h2 id="Initialize-UART"><a href="#Initialize-UART" class="headerlink" title="Initialize UART"></a>Initialize UART</h2><p>This is done in 3 steps:</p><ol><li>Disable interrupts (which will be discussed in the future).</li><li>Set the baud rate.</li><li>Set the data communication format.</li></ol><p>More information can be found in the source code.</p><p>UART initialization should only be done once after booting.</p><h2 id="Setting-the-Baud-Rate"><a href="#Setting-the-Baud-Rate" class="headerlink" title="Setting the Baud Rate"></a>Setting the Baud Rate</h2><p>The baud rate is the frequency of data transmission and should be set to the same value for both the transmitter and receiver.</p><p>But note that the divisor latch is seprated into 2 parts, <code>DLL</code> and <code>DLM</code>, which stand for the least and most significant bits of the divisor latch, respectively. </p><h2 id="Polling-and-UART-I-x2F-O"><a href="#Polling-and-UART-I-x2F-O" class="headerlink" title="Polling and UART I&#x2F;O"></a>Polling and UART I&#x2F;O</h2><p>To write things through UART, we just need to put the data into <code>THR</code> (the <em>transmit holding register</em> in write mode). However, as data transmission takes time, we need to check whether the data in <code>THR</code> was sent before new data was put into it.</p><p>The <em>line status register</em>â€˜s bit 5 (6<sup>th</sup> bit) is designed for this purpose. This bit will be set to 0 to indicate that transmission is complete.</p><p>Therefore, when we want to write through UART, we keep checking this bit. When we get a zero, we know that we can put our data. This procedure of continuously asking a register is also known as <strong>polling</strong>. </p><p>Printing a string could be seen as printing chars iteratively. </p><p>Reading data from console is technically the same thing, except that we check and read data from different registers.</p><h2 id="Other-Notes"><a href="#Other-Notes" class="headerlink" title="Other Notes"></a>Other Notes</h2><p>Remember to add <code>--nographic</code> flag when running QEMU. This flag means to disable the QEMU graphic monitor and use UART as the I&#x2F;O device, so all output and input will be displayed on the current terminal.</p><p>To quit QEMU emulator, just press <code>Ctrl + A</code> then press <code>X</code>. Or press <code>Ctrl + A</code> followed by <code>C</code>, and then type <code>quit</code>.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://byterunner.com/16550.html">ByteRunner.com | TECHNICAL DATA ON 16550</a></li><li><a href="https://www.bilibili.com/video/BV1Q5411w7z5/?p=17">[å®Œç»“] å¾ªåºæ¸è¿›ï¼Œå­¦ä¹ å¼€å‘ä¸€ä¸ªRISC-Vä¸Šçš„æ“ä½œç³»ç»Ÿ - æ±ªè¾° - ç¬¬7ç« ï¼ˆä¸‹ï¼‰-Hello RVOS_å“”å“©å“”å“©_bilibili</a></li><li><a href="https://github.com/plctlab/riscv-operating-system-mooc/blob/main/code/os/01-helloRVOS/uart.c">riscv-operating-system-mooc&#x2F;uart.c at main Â· plctlab&#x2F;riscv-operating-system-mooc</a></li><li><a href="https://pdos.csail.mit.edu/6.828/2022/xv6/book-riscv-rev3.pdf">xv6: a simple, Unix-like teaching operating system</a>, Russ Cox, Frans Kaashoek, Robert Morris, MIT, 5 September 2022, <em>5.1 Code: Console input</em> (P53 - 55)</li><li><a href="https://github.com/mit-pdos/xv6-riscv/blob/riscv/kernel/uart.c">xv6-riscv&#x2F;uart.c at riscv Â· mit-pdos&#x2F;xv6-riscv</a></li><li><a href="https://en.wikipedia.org/wiki/16550_UART">16550 UART - Wikipedia</a></li><li><a href="https://github.com/qemu/qemu/blob/master/hw/riscv/virt.c">qemu&#x2F;virt.c at master Â· qemu&#x2F;qemu</a></li><li><a href="https://www.qemu.org/docs/master/system/invocation.html#:~:text=parallel%20port%20data.-,%2Dnographic,-Normally%2C%20if%20QEMU">QEMU documentation â€“nographic</a></li><li><a href="https://www.cnblogs.com/weijunji/p/xv6-study-8.html">XV6å­¦ä¹ ï¼ˆ8ï¼‰ä¸­æ–­å’Œè®¾å¤‡é©±åŠ¨ - æ˜Ÿè¦‹é¥ - åšå®¢å›­</a></li><li><a href="https://en.wikipedia.org/wiki/Cross_compiler">Cross compiler - Wikipedia</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Operating System &amp; Architecture</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Register</tag>
      
      <tag>C</tag>
      
      <tag>xv6</tag>
      
      <tag>QEMU</tag>
      
      <tag>Emulation</tag>
      
      <tag>Peripheral</tag>
      
      <tag>UART</tag>
      
      <tag>Baud Rate</tag>
      
      <tag>Polling</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RISC-V Machine Boot Code</title>
    <link href="/2023/02/23/boot-risc-v/"/>
    <url>/2023/02/23/boot-risc-v/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="RISC-V-Machine-Boot-Code"><a href="#RISC-V-Machine-Boot-Code" class="headerlink" title="RISC-V Machine Boot Code"></a>RISC-V Machine Boot Code</h1><p>Basically, when a RISC-V machine powers on, the bootloader built in hardware or emulator will go to memory address <a href="#Loading-Address"><code>0x8000_0000</code></a> to load an OS.</p><p>At this time, the computer works in <strong>machine</strong> mode, and our <code>boot.S</code> needs to do something that can only be done in this privilege level. And here is a line-by-line explanation.</p><h2 id="Some-Definitions"><a href="#Some-Definitions" class="headerlink" title="Some Definitions"></a>Some Definitions</h2><p>If you want, you can take a glance at <a href="#Code">code</a> first, and come back when encountering any problems.</p><h3 id="Directives"><a href="#Directives" class="headerlink" title="Directives"></a>Directives</h3><p>All keywords begin with a period are called <a href="https://sourceware.org/binutils/docs-2.40/as/Pseudo-Ops.html"><strong>directives</strong></a>. They are not defined in RISC-V specification, but in assemblerâ€™s side, to give some hints to assembler. Its syntax may be different from assembler to assembler, and itâ€™s not corresponding to any specific instruction.</p><h3 id="Pseudoinstructions"><a href="#Pseudoinstructions" class="headerlink" title="Pseudoinstructions"></a>Pseudoinstructions</h3><p>Technically, <a href="https://github.com/riscv-non-isa/riscv-asm-manual/blob/master/riscv-asm.md#-a-listing-of-standard-risc-v-pseudoinstructions"><strong>pseudoinstructions</strong></a> are not instruction. They resemble common instructions and are used to improve programming efficiency. One line of pseudo instruction may correspond to more than one instruction when assembled by assembler.</p><p>For example, <code>li</code> (<a href="https://github.com/riscv-non-isa/riscv-asm-manual/blob/master/riscv-asm.md#load-immediate">load immediate</a>) is a common pseudoinstruction.</p><h3 id="ABI"><a href="#ABI" class="headerlink" title="ABI"></a>ABI</h3><p>ABI stands for <strong>application binary interface</strong>. Instead of naming registersâ€™ absolute location, say, <code>x0</code>, <code>x1</code> and so on, it is highly recommended to refer them with their <a href="https://github.com/riscv-non-isa/riscv-asm-manual/blob/master/riscv-asm.md#general-registers">ABI</a>, such as <code>zero</code>, <code>ra</code> and so on.</p><h3 id="CSR-and-Zicsr"><a href="#CSR-and-Zicsr" class="headerlink" title="CSR and Zicsr"></a>CSR and Zicsr</h3><p><strong>Control and status registers</strong> (CSR) are used to control and monitor the operation of various hardware components. They are part of privileged component in architechure, and thus, accessible by using different opcodes. These opcodes for CSRs are differently categorized and named as <strong>Zicsr</strong>.</p><h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs RISCV">.globl _start<br><br>.equ STACK_SIZE, 1024<br>.equ CPU_NUM, 8<br><br>.section .text<br><br>_start:<br>    csrr t0, mhartid<br>    bnez t0, pend<br><br>    slli t0, t0, 10<br>    la sp, stacks + STACK_SIZE<br>    add sp, sp, t0<br><br>    j enter<br><br>stacks:<br>    .space STACK_SIZE * CPU_NUM<br><br>pend:<br>    wfi<br>    j pend<br><br>.end<br></code></pre></td></tr></table></figure><h2 id="Branching-out-Other-Harts"><a href="#Branching-out-Other-Harts" class="headerlink" title="Branching out Other Harts"></a>Branching out Other Harts</h2><p><strong>Hart</strong> is a conventional name for a <strong>Hardware Thread</strong>. </p><p>In <em>line 9</em>, <code>csrr</code> is a <a href="#Pseudoinstructions">pseudoinstruction</a> meaning â€˜read CSRâ€™. You can simply understand it as â€˜read <code>mhartid</code> and save into <code>t0</code>â€˜, but since <code>mhartid</code> is a <a href="#CSR-and-Zicsr">CSR</a>, it requires using <code>csrr</code>, which is also in Zicsr, to read it.</p><p><code>mhartid</code> can be understood as â€˜machine mode hart idâ€™. When hardware boots, all its harts are activated and run this assembly code, whereas this snippet is only intended to use one hart.</p><p><code>t0</code> is the first <a href="#ABI"><strong>temporary register</strong></a>, mapping to register <code>x5</code>.</p><p>In <em>line 10</em>, <code>bnez</code> is also a pseudoinstruction, standing for â€˜branch if not equal to zeroâ€™.</p><p>So this two lines are trying to figure out which hart is running, and then lead it to the <code>pend</code> label, unless it is the first hart.</p><p>Let a hart jump endlessly is a common way to pend it. And in <em>line 22</em>, we added an instruction called <code>wfi</code>, meaning â€˜wait for interruptâ€™. It could be seen as entering sleep mode for this hart.</p><h2 id="Setting-up-Stacks"><a href="#Setting-up-Stacks" class="headerlink" title="Setting up Stacks"></a>Setting up Stacks</h2><p>The layout of stacks is quite baffling and took me a lot of time to figure out.</p><p>In general, we assign a bunch of memory, let <code>sp</code> points to the end of first hartâ€™s stack, and move <code>sp</code> to its corresponding hartâ€™s stack, with respect to label <code>stacks</code>(<em>line 18-19</em>), <em>line 13</em> and <em>line 14</em> accordingly.</p><p>The stacks have a gross size of <code>STACK_SIZE * CPU_NUM</code> in bytes. The <a href="#Directives">directive</a> <code>.space</code> means fill these size with zeros automatically, the same as <code>.skip</code>. When <em>line 13</em> refers to <code>stacks</code>, it refers to the beginning, or in other words, smallest address of this assigned memory. By adding exactly one <code>STACK_SIZE</code>, the sum should be the end address of first hartâ€™s stack.</p><p>Always remember these rules when trying to understand this part:</p><ol><li>The low address is the start of the stack, whereas the high address is its end.</li><li>The stack pointer <code>sp</code> always points to the end of the stack.</li><li>Hart id starts at 0.</li></ol><p>Since we designed the size of the stack to be 1024 bytes, which is 2<sup>10</sup>, we can left shift the hart ID 10 bits and add it to location of the first stack to find its own stack. <em>Line 12</em> is the instruction that exactly does this. The opcode <code>slli</code> instructs the hart to logical shift <code>t0</code> left, which also means multiplying it by 1024.</p><h2 id="Going-to-C"><a href="#Going-to-C" class="headerlink" title="Going to C"></a>Going to C</h2><p>In <em>line 16</em>, the program jumps to <code>enter</code> which is declared in C language. Calling a C function is just like calling an assembly function since they are both converted to binary and located in <code>text</code> section. When booting, quickly switching to high-level programming language can be helpful.</p><p>Initializing stacks can also be done in C. Referring to <a href="https://github.com/mit-pdos/xv6-riscv/blob/riscv/kernel/start.c"><code>xv6-riscv/kernel/start.c</code></a>, it is written as: </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-comment">// entry.S needs one stack per CPU.</span><br>__attribute__ ((aligned (<span class="hljs-number">16</span>))) <span class="hljs-type">char</span> stack0[<span class="hljs-number">4096</span> * NCPU];<br></code></pre></td></tr></table></figure><p>Here <code>__attribute__</code> is a GNU GCC feature used to provide additional information to the compiler. In this case, it ensures that <code>stack0</code> is aligned on a 16-byte boundary. It gives each hart 4096 bytes and <code>NCPU</code> stands for the number of harts.</p><h2 id="Loading-Address"><a href="#Loading-Address" class="headerlink" title="Loading Address"></a>Loading Address</h2><p>Note that address <code>0x8000_0000</code> is different from so-called <em>magic number</em>, which is <code>0xAA55</code>, in x86. The latter is defined as the end of boot sector. BIOS would go through all storage devices and try to boot from this section.</p><p>Thus, when linking objects together, we need to add flag <code>-Ttext=0x80000000</code> to make sure the <code>.text</code> section is located at where we want. From the <a href="https://sourceware.org/binutils/docs-2.40/ld/Options.html#index-_002d_002dsection_002dstart_003dsectionname_003dorg">doc</a>, <code>-Ttext</code> here is a short hand for <code>--section-start=.text</code>.</p><p>This <code>8000_0000</code> is not standardized, but conventionally, it should be this location, as you can find out in QEMU source code. For example, in <a href="https://github.com/qemu/qemu/blob/master/hw/riscv/virt.c"><code>qemu/hw/riscv/virt.c</code></a>, in the array of memory map <code>virt_memap</code>, the last one is <code>VIRT_DRAM</code> and starts at <code>0x8000_0000</code>.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://pdos.csail.mit.edu/6.828/2022/xv6/book-riscv-rev3.pdf">xv6: a simple, Unix-like teaching operating system</a>, Russ Cox, Frans Kaashoek, Robert Morris, MIT, 5 September 2022, <em>2.6 Code: starting xv6, the first process and system call</em> (P27 - 28)</li><li><a href="https://github.com/mit-pdos/xv6-riscv/blob/riscv/kernel/entry.S">xv6-riscv&#x2F;entry.S at riscv Â· mit-pdos&#x2F;xv6-riscv</a></li><li><a href="https://www.cs.bham.ac.uk/~exr/lectures/opsys/10_11/lectures/os-dev.pdf">Writing a Simple Operating System â€“ from Scratch</a>, Nick Blundell, University of Birmingham, 2 December 2010, <em>Chapter 2 Computer Architecture and the Boot Process</em> (P3 - 7)</li><li><a href="https://medium.com/@iotapioneer/55-and-aa-8c06b8719c1">55 and AA. Whatâ€™s special about 55 and AA? Or moreâ€¦ | by Larry K. | Medium</a></li><li><a href="https://github.com/riscv-non-isa/riscv-asm-manual/blob/master/riscv-asm.md">riscv-asm-manual&#x2F;riscv-asm.md at master Â· riscv-non-isa&#x2F;riscv-asm-manual</a></li><li><a href="https://sourceware.org/binutils/docs-2.40/as/Pseudo-Ops.html">Pseudo Ops (Using as)</a></li><li><a href="https://sourceware.org/binutils/docs-2.40/ld/Options.html">Options (LD)</a></li><li><a href="https://sourceware.org/binutils/docs-2.40/">Documentation for binutils 2.40</a></li><li><a href="https://www.bilibili.com/video/BV1Q5411w7z5?p=16">[å®Œç»“] å¾ªåºæ¸è¿›ï¼Œå­¦ä¹ å¼€å‘ä¸€ä¸ªRISC-Vä¸Šçš„æ“ä½œç³»ç»Ÿ - æ±ªè¾° - ç¬¬7ç« ï¼ˆä¸Šï¼‰-Hello RVOS_å“”å“©å“”å“©_bilibili</a></li><li><a href="https://github.com/plctlab/riscv-operating-system-mooc/blob/main/code/os/01-helloRVOS/start.S">riscv-operating-system-mooc&#x2F;start.S at main Â· plctlab&#x2F;riscv-operating-system-mooc</a></li><li><a href="https://www.qemu.org/docs/master/system/target-riscv.html">RISC-V System emulator â€” QEMU documentation</a></li><li><a href="https://github.com/qemu/qemu/blob/master/hw/riscv/virt.c">qemu&#x2F;virt.c at master Â· qemu&#x2F;qemu</a></li><li><a href="https://riscv.org/technical/specifications/">Specifications - RISC-V International</a></li><li><a href="https://five-embeddev.com/riscv-isa-manual/latest/csr.html">RISC-V Instruction Set Manual, Volume I: RISC-V User-Level ISA | Five EmbedDev</a></li><li><a href="https://osblog.stephenmarz.com/ch1.html">Taking control of RISC-V: RISCV OS in Rust</a></li><li><a href="https://github.com/sgmarz/osblog/blob/master/risc_v/chapters/ch1/src/asm/boot.S">osblog&#x2F;boot.S at master Â· sgmarz&#x2F;osblog</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Operating System &amp; Architecture</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RISC-V</tag>
      
      <tag>Register</tag>
      
      <tag>C</tag>
      
      <tag>Memory</tag>
      
      <tag>xv6</tag>
      
      <tag>Bootstrap</tag>
      
      <tag>Assembly</tag>
      
      <tag>Stack</tag>
      
      <tag>QEMU</tag>
      
      <tag>Emulation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>éšæƒ³ä¸¤åˆ™</title>
    <link href="/2023/02/22/prose01/"/>
    <url>/2023/02/22/prose01/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="éšæƒ³ä¸¤åˆ™"><a href="#éšæƒ³ä¸¤åˆ™" class="headerlink" title="éšæƒ³ä¸¤åˆ™"></a>éšæƒ³ä¸¤åˆ™</h1><h2 id="ä¸€ã€"><a href="#ä¸€ã€" class="headerlink" title="ä¸€ã€"></a>ä¸€ã€</h2><p>æœ€è¿‘æ‚„æ‚„ç»™ç½‘ç«™ä¸Šçº¿äº† <a href="https://lingkkang.github.io/atom.xml">RSS</a>ã€‚</p><p>åŽŸæœ¬ä¸æ€Žä¹ˆæ‰“ç®—å¼„è¿™ä¸ªçš„ï¼Œå› ä¸ºè§‰å¾—è¿™æ ·å›žå›žç›´æŽ¥æŠŠæ–°å†…å®¹ç›´æŽ¥æŽ¨åˆ°è®¢é˜…è€…é¢å‰ï¼Œå¥½åƒæ¯›é‚è‡ªèä¸€æ ·ï¼Œä¼¼ä¹Žå¾ˆç”Ÿç¡¬ã€‚ç”šè‡³æ„Ÿè§‰å¾ˆå”çªã€‚</p><p>è€Œä¸”ä¸€ç›´ä»¥ä¸ºéƒ¨ç½²å¾ˆéº»çƒ¦çš„ï¼Œæ²¡æƒ³åˆ°è¿™ä¹ˆæ–¹ä¾¿ã€‚</p><p>å½“ç„¶ï¼Œæœ€ç»ˆè¿˜æ˜¯å¼„äº†â€”â€”ä¸»è¦æ˜¯å¤§å®¶éƒ½åŠ äº†ï¼Œè€Œä¸” RSS é˜…è¯»å™¨èƒ½é›†æˆå„ä¸ªåšå®¢çš„æºï¼Œè¯»èµ·æ¥æ¯”ä¸“é—¨åŽ»ä¸€ä¸ªä¸€ä¸ªç½‘ç«™ç¿»æ–¹ä¾¿å¤šäº†ã€‚ä¹Ÿå¾ˆå°‘ä¼šæœ‰äººä¸“é—¨åŽ»åˆ·æ–°åˆ«äººç½‘ç«™çœ‹çœ‹æœ‰æ²¡æœ‰æ›´æ–°å§ã€‚</p><p>è‡ªå·±æ—¥å¸¸åœ¨ç”¨ï¼Œæ€Žä¹ˆèƒ½æœ‰ç†ç”±ä¸åŠ å‘¢ï¼Ÿ</p><h2 id="äºŒã€"><a href="#äºŒã€" class="headerlink" title="äºŒã€"></a>äºŒã€</h2><p>ä¹‹å‰ç”¨ä¸Šäº† ChatGPTï¼ŒçœŸçš„å¾ˆæƒŠè‰³ã€‚å·²ç»é€æ¸æŠŠå®ƒçº³å…¥æ—¥å¸¸ä¿¡æ¯æœç´¢æµä¸­äº†ã€‚</p><p>ç›´æŽ¥é—®ç­”è¿˜æ˜¯æ¯”æœç´¢å’Œæ£€ç´¢æ–¹ä¾¿å¤ªå¤šï¼Œå°¤å…¶åœ¨äºŽå®ƒèƒ½å¤Ÿç»“åˆä¸Šä¸‹æ–‡ã€‚è€Œä¸”å¾—åˆ°ç­”æ¡ˆä¹‹å¿«é€Ÿä¹ŸåŸºæœ¬èƒœè¿‡åœ¨è®ºå›ä¸Šæé—®äº†ã€‚å°½ç®¡è¿˜æ˜¯è¦è®°å¾—éªŒè¯ä¸€ä¸‹å®ƒçš„ç­”æ¡ˆã€‚</p><p>ä»¥åŽä¼šè¶Šæ¥è¶Šå¦‚æ­¤å§ã€‚</p><p>æ„Ÿè§‰å°±åƒè¿›å…¥å¤§å­¦åŽé€æ¸ä¹ æƒ¯äº† <code>ctrl + f</code> çš„æœç´¢å¿«æ·é”®ï¼Œå·²ç»åŸºæœ¬å—ä¸äº†å†åƒä»¥å‰ä¸€æ ·å‡­è‚‰çœ¼æ‰«ææ–‡æœ¬å¯»æ‰¾å…³é”®å­—äº†ã€‚åˆå¥½åƒä¹ æƒ¯äº†æœç´¢å¼•æ“Žï¼Œä¹Ÿå¾ˆéš¾ä¹ æƒ¯å†åƒå‡ åå¹´å‰ä¸€æ ·ä»Žç™¾ç§‘å…¨ä¹¦ã€å‚è€ƒæ–‡çŒ®ã€ç´¢å¼•é‡Œå¯»æ‰¾çº¿ç´¢ï¼Œå†åœ¨å›¾ä¹¦é¦†ä¸€æŽ’æŽ’ä¹¦æž¶ä¸Šè‹¦è‹¦æœå¯»äº†å§ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç”Ÿæ´»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Application of Cofactor Expansion</title>
    <link href="/2023/01/08/cofactor-expansion/"/>
    <url>/2023/01/08/cofactor-expansion/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Application-of-Cofactor-Expansion"><a href="#Application-of-Cofactor-Expansion" class="headerlink" title="Application of Cofactor Expansion"></a>Application of Cofactor Expansion</h1><p><a href="https://en.wikipedia.org/wiki/Laplace_expansion"><strong>Laplace expansion</strong></a>, also known as <strong>cofactor expansion</strong> or <strong>first Laplace theorems on determinants</strong>, is a recursive way to calculate determinant of a square matrix.</p><p>But itâ€™s also clear that for a generic matrix, using <strong>cofactor expansion</strong> is much slower than using <a href="https://en.wikipedia.org/wiki/LU_decomposition">LU decomposition</a>. So, whatâ€™s the real advantage of Laplace expansion? In what kind of situation can we use this method?</p><p>To give a quick answer: when a matrix comes with many zeros.</p><p>Additionally, when a matrix constitutes some variables.</p><h2 id="From-the-Definition"><a href="#From-the-Definition" class="headerlink" title="From the Definition"></a>From the Definition</h2><p>Besides expressing the theorem with sigma notaion (Î£), there is also another equivalent form accroding to <em>Linear Algebra for Computational Sciences and Engineering</em>:</p><blockquote><p>The determinant of a matrix is equal to scalar product of a row (column) vector by the corresponding vector of cofactors.</p></blockquote><p>I rather like this definition.</p><h3 id="Being-Lazy"><a href="#Being-Lazy" class="headerlink" title="Being Lazy"></a>Being Lazy</h3><p>We can note that each term of summation is the product of a matrix entry and its cofactor.</p><p>So, itâ€™s clear that if any of the two factors is zero, this term will be zero and we can calculate one thing less.</p><p>Although an entryâ€™s cofactor needs some complex arithmetic, zero entries in a matrix can be easily determined.</p><h3 id="Handling-Some-Uncertainty"><a href="#Handling-Some-Uncertainty" class="headerlink" title="Handling Some Uncertainty"></a>Handling Some Uncertainty</h3><p>Thinking from the opposite, lower-upper decomposition is probably not completely applicable to a matrix with some variables. In this case, we cannot determine an entry is a pivot or not if it contain some unknowns. </p><p>At this point, cofactor expansion can help, but this is not the focus of this post.</p><h2 id="Real-Stuff"><a href="#Real-Stuff" class="headerlink" title="Real Stuff"></a>Real Stuff</h2><p>Letâ€™s realize it in Python and check what outcome exactly could be when there are some zeros in a matrix.</p><h3 id="Reinvent-the-Wheel"><a href="#Reinvent-the-Wheel" class="headerlink" title="Reinvent the Wheel"></a>Reinvent the Wheel</h3><p>Firstly, we need to gengerate a square matrix randomly.</p><h4 id="Generate-a-Matrix"><a href="#Generate-a-Matrix" class="headerlink" title="Generate a Matrix"></a>Generate a Matrix</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> random<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">square_matrix_gen</span>(<span class="hljs-params">n, a, b, zeros=<span class="hljs-number">0</span></span>):<br>    m = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        row = []<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            entry = <span class="hljs-built_in">int</span>(random.uniform(a, b))<br>            <span class="hljs-keyword">if</span> entry == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">if</span> zeros == <span class="hljs-number">0</span>:<br>                    <span class="hljs-keyword">while</span> (entry == <span class="hljs-number">0</span>):<br>                        entry = <span class="hljs-built_in">int</span>(random.uniform(a, b))<br>                <span class="hljs-keyword">if</span> zeros &gt; <span class="hljs-number">0</span>:<br>                    zeros = zeros -<span class="hljs-number">1</span><br>            row.append(entry)<br>        m.append(row)<br>    <span class="hljs-keyword">while</span> zeros != <span class="hljs-number">0</span>:<br>        i = <span class="hljs-built_in">int</span>(random.randrange(n))<br>        j = <span class="hljs-built_in">int</span>(random.randrange(n))<br>        <span class="hljs-keyword">if</span> m[i][j] != <span class="hljs-number">0</span>:<br>            m[i][j] = <span class="hljs-number">0</span><br>            zeros = zeros -<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> m<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_matrix</span>(<span class="hljs-params">m</span>):<br>    n = <span class="hljs-built_in">len</span>(m)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-built_in">print</span>(m[i][j], end=<span class="hljs-string">&#x27;\t&#x27;</span>)<br>        <span class="hljs-built_in">print</span>()<br></code></pre></td></tr></table></figure><p>In <em>Line 8</em>, <code>int(random.uniform(lower, upper))</code> returns a value in continuous uniform distribution. Bounds <code>lower</code> and <code>upper</code> are not included since there is a type cast with <code>int()</code>.</p><p>Note that <code>0</code> is also in the bounds, so from <em>Line 9</em> to <em>Line 14</em> we are handling this problem, trying to make sure that the number of zeros in the returned matrix is exactly the same as <code>zeros</code> we passed in. This may demolish the idea of <em>uniform distribution</em>, but not impact the purpose of this demonstration.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs Python">A = square_matrix_gen(<span class="hljs-number">3</span>, -<span class="hljs-number">100</span>, <span class="hljs-number">100</span>)<br>print_matrix(A)<br><br>B = square_matrix_gen(<span class="hljs-number">5</span>, -<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">4</span>)<br>print_matrix(B)<br></code></pre></td></tr></table></figure><p>Output (probably):</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs TXT">-11     -9      -89<br>39      44      72<br>-96     -14     70<br></code></pre></td></tr></table></figure><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs TXT">-14     0       -99     47      0<br>0       7       18      85      -66<br>66      66      30      -4      4<br>-98     12      -83     20      0<br>-21     15      48      1       -93<br></code></pre></td></tr></table></figure><h4 id="Realization"><a href="#Realization" class="headerlink" title="Realization"></a>Realization</h4><p>To calculate determinant, according to <strong>cofactor expansion</strong>, we need cofactor. As for cofactor, we need complement minor, which comes from complement submatrix.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">det</span>(<span class="hljs-params">m</span>):<br>    n = <span class="hljs-built_in">len</span>(m)<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">raise</span> ValueError<br>    <span class="hljs-keyword">elif</span> n == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> m[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    i = <span class="hljs-built_in">int</span>(random.randrange(n))<br>    summation = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">if</span> m[i][j] != <span class="hljs-number">0</span>:<br>            summation += m[i][j] * cofactor(m, i, j)<br>    <span class="hljs-keyword">return</span> summation<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cofactor</span>(<span class="hljs-params">m, i, j</span>):<br>    co = (-<span class="hljs-number">1</span>) ** (i + j) * complement_minor(m, i, j)<br>    <span class="hljs-keyword">return</span> co<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">complement_minor</span>(<span class="hljs-params">m, i, j</span>):<br>    submatrix = complement_submatrix(m, i, j)<br>    minor = det(submatrix)<br>    <span class="hljs-keyword">return</span> minor<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">complement_submatrix</span>(<span class="hljs-params">m, i, j</span>):<br>    n = <span class="hljs-built_in">len</span>(m)<br>    sub = m[:i] + m[i+<span class="hljs-number">1</span>:]<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n-<span class="hljs-number">1</span>):<br>        sub[x] = sub[x][:j] + sub[x][j+<span class="hljs-number">1</span>:]<br>    <span class="hljs-keyword">return</span> sub<br></code></pre></td></tr></table></figure><p>Complement minor is exactly the determinant of complement submatrix, so the sequence of function call expands in a recursive manner. </p><p>In <em>Line 7</em>, we selected a random row to apply <strong>first Laplace theorem</strong>. Note that all rows and columns begin with <code>0</code> index and end with <code>n-1</code>.</p><p>Function of complement submatrix is a little bit fancy. Essentially, itâ€™s just a bunch of <a href="https://docs.python.org/3/tutorial/introduction.html#lists">list slicing</a>.</p><h3 id="Benchmarking"><a href="#Benchmarking" class="headerlink" title="Benchmarking"></a>Benchmarking</h3><blockquote><p>Cofactors are useful when matrices have many zeros.</p></blockquote><div style='text-align: right'><p>Gilbert Strang, <em>Introduction to Linear Algebra</em></p></div><p>To test its convenience, we can simply measure running time it used. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Num of zeros\tTime used&#x27;</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>, <span class="hljs-number">26</span>):<br>    m = square_matrix_gen(<span class="hljs-number">10</span>, -<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, i)<br>    t1 = datetime.now()<br>    det(m)<br>    t2 = datetime.now()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;i&#125;</span>\t\t<span class="hljs-subst">&#123;t2-t1&#125;</span>&#x27;</span>)<br></code></pre></td></tr></table></figure><p>Output:</p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs txt">Num of zeros    Time used<br>10              0:00:04.076951<br>11              0:00:03.756362<br>12              0:00:02.944325<br>13              0:00:02.906601<br>14              0:00:02.848988<br>15              0:00:02.384444<br>16              0:00:02.215670<br>17              0:00:02.151262<br>18              0:00:02.014808<br>19              0:00:01.391330<br>20              0:00:01.436479<br>21              0:00:01.417628<br>22              0:00:01.162688<br>23              0:00:00.958879<br>24              0:00:01.125304<br>25              0:00:00.949000<br></code></pre></td></tr></table></figure><p>We can see that with the number of zeros in matrix increase, time needed to calculate <code>det()</code> is getting less rapidly.</p><p>Here is a result in terms of a 10 by 10 matrix with number of zeros ranging from 0 to 45, plotted with <code>matplotlib.pyplot</code> (for full script, please refer to <a href="#Appendix-Full-Script">Appendix</a>):</p><p><img src="/images/cofactor/Figure_1.png" alt="Figure 1"></p><p>From <em>Figure 1</em> we can see that only a few zeros can reduce calculation time to a large extend. </p><p>Here we just pick a random row to calculate <code>det()</code>, and if we chose a row (column) with the most zeros, the time might have been reduced even faster.</p><h2 id="Remark"><a href="#Remark" class="headerlink" title="Remark"></a>Remark</h2><p>When learning linear algebra and going through the textbook, tons of jargons come in, with many definitions, theorems, proofs and properties. But as a student major in computer science, I really want to know whatâ€™s the usage of them, in what circumstances can we use them. I care more about real-life application and realization. </p><p>In terms of <strong>cofactor expansion</strong>, to calculate determinant recursively is a fun topic, but not a very efficient manner, as recursion always occupy a large amount of memory and hard to optimize. </p><p>So does almost every industrial implementation of determinant come from <strong>LU decomposition</strong>. </p><p>However, <strong>Laplace expansion</strong> is not meaningless, and thatâ€™s why I wrote this post.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://doi.org/10.1007/978-3-030-21321-3">Linear Algebra for Computational Sciences and Engineering, 2nd Edition</a>, Ferrante Neri, Springer Cham, 2019.</li><li><a href="https://math.mit.edu/~gs/linearalgebra/ila5/indexila5.html">Introduction to Linear Algebra, 5th Edition</a>, Gilbert Strang, Wellesley-Cambridge Press, 2016.</li><li><a href="https://textbooks.math.gatech.edu/ila/determinants-cofactors.html">Cofactor Expansions</a></li><li><a href="https://en.wikipedia.org/wiki/Laplace_expansion">Laplace expansion - Wikipedia</a></li><li><a href="https://en.wikipedia.org/wiki/Minor_(linear_algebra)#Applications_of_minors_and_cofactors">Applications of minors and cofactors</a></li><li><a href="https://en.wikipedia.org/wiki/LU_decomposition">LU decomposition - Wikipedia</a></li><li><a href="https://johnfoster.pge.utexas.edu/numerical-methods-book/LinearAlgebra_LU.html">LU Factorization</a></li><li><a href="https://docs.python.org/3/library/stdtypes.html?highlight=list#mutable-sequence-types">Mutable Sequence Types - Built-in Types - Python 3.11.1 documentation</a></li><li><a href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.det.html">numpy.linalg.det â€” NumPy v1.24 Manual</a></li></ol><h2 id="Appendix-Full-Script"><a href="#Appendix-Full-Script" class="headerlink" title="Appendix: Full Script"></a>Appendix: Full Script</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs Python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">square_matrix_gen</span>(<span class="hljs-params">n, a, b, zeros=<span class="hljs-number">0</span></span>):<br>    m = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        row = []<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            entry = <span class="hljs-built_in">int</span>(random.uniform(a, b))<br>            <span class="hljs-keyword">if</span> entry == <span class="hljs-number">0</span>:<br>                <span class="hljs-keyword">if</span> zeros == <span class="hljs-number">0</span>:<br>                    <span class="hljs-keyword">while</span> (entry == <span class="hljs-number">0</span>):<br>                        entry = <span class="hljs-built_in">int</span>(random.uniform(a, b))<br>                <span class="hljs-keyword">if</span> zeros &gt; <span class="hljs-number">0</span>:<br>                    zeros = zeros -<span class="hljs-number">1</span><br>            row.append(entry)<br>        m.append(row)<br>    <span class="hljs-keyword">while</span> zeros != <span class="hljs-number">0</span>:<br>        i = <span class="hljs-built_in">int</span>(random.randrange(n))<br>        j = <span class="hljs-built_in">int</span>(random.randrange(n))<br>        <span class="hljs-keyword">if</span> m[i][j] != <span class="hljs-number">0</span>:<br>            m[i][j] = <span class="hljs-number">0</span><br>            zeros = zeros -<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> m<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">print_matrix</span>(<span class="hljs-params">m</span>):<br>    n = <span class="hljs-built_in">len</span>(m)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>            <span class="hljs-built_in">print</span>(m[i][j], end=<span class="hljs-string">&#x27;\t&#x27;</span>)<br>        <span class="hljs-built_in">print</span>()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">det</span>(<span class="hljs-params">m</span>):<br>    n = <span class="hljs-built_in">len</span>(m)<br>    <span class="hljs-keyword">if</span> n == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">raise</span> ValueError<br>    <span class="hljs-keyword">elif</span> n == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> m[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]<br>    i = <span class="hljs-built_in">int</span>(random.randrange(n))<br>    summation = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n):<br>        <span class="hljs-keyword">if</span> m[i][j] != <span class="hljs-number">0</span>:<br>            summation += m[i][j] * cofactor(m, i, j)<br>    <span class="hljs-keyword">return</span> summation<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cofactor</span>(<span class="hljs-params">m, i, j</span>):<br>    co = (-<span class="hljs-number">1</span>) ** (i + j) * complement_minor(m, i, j)<br>    <span class="hljs-keyword">return</span> co<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">complement_minor</span>(<span class="hljs-params">m, i, j</span>):<br>    submatrix = complement_submatrix(m, i, j)<br>    minor = det(submatrix)<br>    <span class="hljs-keyword">return</span> minor<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">complement_submatrix</span>(<span class="hljs-params">m, i, j</span>):<br>    n = <span class="hljs-built_in">len</span>(m)<br>    sub = m[:i] + m[i+<span class="hljs-number">1</span>:]<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n-<span class="hljs-number">1</span>):<br>        sub[x] = sub[x][:j] + sub[x][j+<span class="hljs-number">1</span>:]<br>    <span class="hljs-keyword">return</span> sub<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">timedelt_to_seconds</span>(<span class="hljs-params">t</span>):<br>    <span class="hljs-keyword">return</span> t.seconds + t.microseconds / <span class="hljs-number">1000000</span><br><br>index = []<br>time = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">46</span>):<br>    m = square_matrix_gen(<span class="hljs-number">10</span>, -<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, i)<br>    t1 = datetime.now()<br>    det(m)<br>    t2 = datetime.now()<br>    tdelt = t2 - t1<br>    time.append(timedelt_to_seconds(tdelt))<br>    index.append(i)<br><br><span class="hljs-keyword">for</span> xy <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>([index[<span class="hljs-number">0</span>], index[-<span class="hljs-number">1</span>]], [time[<span class="hljs-number">0</span>], time[-<span class="hljs-number">1</span>]]):<br>    <span class="hljs-comment"># draw coordinates of the first and last points</span><br>    plt.annotate(<span class="hljs-string">&#x27;(%d, %.2f)&#x27;</span> % xy, xy=xy)<br><br>plt.plot(index, time, <span class="hljs-string">&#x27;o&#x27;</span>)<br>plt.title(<span class="hljs-string">&#x27;For a 10 by 10 matrix&#x27;</span>)<br>plt.xlabel(<span class="hljs-string">&#x27;Zeros in matrix&#x27;</span>)<br>plt.ylabel(<span class="hljs-string">&#x27;Time used to calculate det (in seconds)&#x27;</span>)<br>plt.xlim([-<span class="hljs-number">2</span>, <span class="hljs-number">55</span>])<br>plt.show()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Mathematics</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Linear Algebra</tag>
      
      <tag>Matrix</tag>
      
      <tag>Determinant</tag>
      
      <tag>Sparse Matrix</tag>
      
      <tag>Recursion</tag>
      
      <tag>Sparsity</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Connect to Local Machine in Hyper-V with SSH</title>
    <link href="/2022/12/31/ssh-hyper-v/"/>
    <url>/2022/12/31/ssh-hyper-v/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Connect-to-Local-Machine-in-Hyper-V-with-SSH"><a href="#Connect-to-Local-Machine-in-Hyper-V-with-SSH" class="headerlink" title="Connect to Local Machine in Hyper-V with SSH"></a>Connect to Local Machine in Hyper-V with SSH</h1><h2 id="After-Boot"><a href="#After-Boot" class="headerlink" title="After Boot"></a>After Boot</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ip address<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl status sshd<br>sudo systemctl start sshd<br></code></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://wiki.archlinux.org/title/OpenSSH">OpenSSH - ArchWiki</a></li><li><a href="https://superuser.com/questions/681213/how-to-connect-to-a-local-hyper-v-virtual-machine-via-ssh">linux - How to connect to a local hyper-v virtual machine via SSH? - Super User</a></li><li><a href="https://linuxhint.com/arch_linux_ssh_server/">Arch Linux SSH Server Setup, Customization and Optimization</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>DevOps</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ssh</tag>
      
      <tag>Hyper-V</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Test Malloc Failure with Macros in C</title>
    <link href="/2022/12/08/test-malloc-failure/"/>
    <url>/2022/12/08/test-malloc-failure/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Test-Malloc-Failure-with-Macros-in-C"><a href="#Test-Malloc-Failure-with-Macros-in-C" class="headerlink" title="Test Malloc Failure with Macros in C"></a>Test Malloc Failure with Macros in C</h1><p>We already know that if <code>malloc()</code> failed, it will return <code>NULL</code>, so almost every <code>C</code> programmer would write the following snippet in their code:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">char</span> *<span class="hljs-built_in">string</span> = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(<span class="hljs-number">10</span> * <span class="hljs-keyword">sizeof</span>(<span class="hljs-type">char</span>));<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">string</span> == <span class="hljs-literal">NULL</span>) &#123;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br><span class="hljs-comment">// do something ...</span><br></code></pre></td></tr></table></figure><p>However, if we want to do something else if the reture value is <code>NULL</code> for memory allocation? It is easy to put some code into it (i.e., <strong>line 3</strong> of above snippet), but the real problem is, how can we test this part?</p><p>To make sure the robustness of our program, every part of the code should be massively tested. But it is almost impossible for us to run out of memory manually, we need some technique to emulate allocation failure.</p><p>And here is the way.</p><h2 id="Handle-malloc"><a href="#Handle-malloc" class="headerlink" title="Handle malloc()"></a>Handle <code>malloc()</code></h2><h3 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h3><p>Take a quick look at the code and I will explain them later.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-type">int</span> set_null = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">void</span> *<span class="hljs-title function_">my_malloc</span><span class="hljs-params">(<span class="hljs-type">size_t</span> n)</span> &#123;<br>    set_null += <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (set_null == <span class="hljs-number">497</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">malloc</span>(n);<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> malloc(x) my_malloc(x)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;file_to_test.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">undef</span> malloc</span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    function_to_test();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><p>Firstly, we need some basic knowledge of <strong>preprocessor</strong> and <strong>macro</strong> in c.</p><p>Donâ€™t worry, in this context, they could be simply recognized as some kind of <strong>replacement</strong>. The essence is to replace the standard <code>malloc</code> function to a function defined by us, say <code>my_malloc</code>, so that we can make it return <code>NULL</code> if we want.</p><p>So in <strong>line 13</strong>, we specify that we want to replace the standard <code>malloc()</code> with our <code>my_malloc()</code>, and the parameter <code>x</code> is just a placeholder to tell compiler that we only have one argument to pass to the macro.</p><p>And secondly, we <code>include</code> our source code into our file. Note that we do not â€˜closeâ€™ our macro (i.e., <code>undef</code>), so every time <code>malloc()</code> occurs in <code>file_to_test.h</code>, what actually called is our <code>my_malloc()</code> function.</p><p>Next step, we undefine <code>malloc</code>, which means give control to real <code>malloc</code> function. So for every code after this line, when compiler encounter a <code>malloc()</code>, it calls the genuine one.</p><p>Note that we define our <code>my_maclloc()</code> function before the macro, so in <strong>line 10</strong>, real <code>malloc()</code> is called.</p><p>Also, we need a way to decide when should our fake malloc should return <code>NULL</code>. We can have a global variable to track it, and when it fullfills some condition, function returns <code>NULL</code>.</p><p>At this point, you may have know that there are almost countless ways to do this. We can take modulo of it, use random function and so on. Here I simply check itâ€™s value, and we can fake a allocation failure at anywhere we want.</p><h2 id="Handle-realloc"><a href="#Handle-realloc" class="headerlink" title="Handle realloc()"></a>Handle <code>realloc()</code></h2><p>Similar to <code>malloc()</code>, <code>realloc</code> can be replace with our own function, but itâ€™s a little bit trickier.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> set_null = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">void</span> *<span class="hljs-title function_">my_realloc</span><span class="hljs-params">(<span class="hljs-type">void</span> *ptr, <span class="hljs-type">size_t</span> n)</span> &#123;<br>    set_null += <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (set_null == <span class="hljs-number">223</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">realloc</span>(ptr, n);<br>&#125;<br><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> realloc(a, b) my_realloc(a, b)</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;file_to_test.c&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">undef</span> realloc</span><br></code></pre></td></tr></table></figure><p>Note that the common usage of <code>realloc</code> is <code>ptr_a = realloc(ptr_b, new_size);</code> If this reallocation failed, <code>ptr_a</code> is set to <code>NULL</code>, but <code>ptr_b</code> is remaining unchanged.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">void</span> *<span class="hljs-title function_">realloc</span><span class="hljs-params">(<span class="hljs-type">void</span> *ptr, <span class="hljs-type">size_t</span> new_size)</span>;<br></code></pre></td></tr></table></figure><p>Accroding to the <a href="https://en.cppreference.com/w/c/memory/realloc">documentation of <code>realloc</code></a>, original memory is never changed.</p><blockquote><p>If there is not enough memory, the old memory block is not freed and null pointer is returned.</p></blockquote><p>So in our simulation, <code>ptr_a</code> also remains unchanged.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">int</span> set_null = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">void</span> *<span class="hljs-title function_">my_realloc</span><span class="hljs-params">(<span class="hljs-type">void</span> *ptr, <span class="hljs-type">size_t</span> n)</span> &#123;<br>    set_null += <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span> (set_null == <span class="hljs-number">223</span>) &#123;<br>        <span class="hljs-built_in">free</span>(ptr); <span class="hljs-comment">// don&#x27;t do this!</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">NULL</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">realloc</span>(ptr, n);<br>&#125;<br></code></pre></td></tr></table></figure><p>Otherwise, you may pass your test but still get a memory leak when realloc failure occurs.</p><h2 id="Remark-on-realloc"><a href="#Remark-on-realloc" class="headerlink" title="Remark on realloc()"></a>Remark on <code>realloc()</code></h2><p>Additionally, never do something like <code>ptr_a = realloc(ptr_a, new_size);</code> In this case, if real reallocation occurs, <code>ptr_a</code> would be set to <code>NULL</code>, whereas the memory location pointed by <code>ptr_a</code> is still there. The compiler is not intelligent enough to <code>free(ptr_a)</code> before assignment. Thus, we lose the access to original memory, and eventually we will receive a memory leak. </p><p>So always do like this:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs C">temp = <span class="hljs-built_in">realloc</span>(ptr_a, new_size);<br><span class="hljs-keyword">if</span> (temp == <span class="hljs-literal">NULL</span>) &#123;<br>    <span class="hljs-comment">// handle realloc failure</span><br>&#125;<br>ptr_a = temp;<br></code></pre></td></tr></table></figure><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://stackoverflow.com/questions/1986538/how-to-handle-realloc-when-it-fails-due-to-memory">How to handle realloc when it fails due to memory? - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/74711886/how-to-test-malloc-failure-in-c">How to test malloc failure in C? - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/1607004/does-realloc-free-the-former-buffer-if-it-fails">Does realloc free the former buffer if it fails? - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/1986538/how-to-handle-realloc-when-it-fails-due-to-memory">c - How to handle realloc when it fails due to memory? - Stack Overflow</a></li><li><a href="https://en.cppreference.com/w/cpp/preprocessor/replace">Replacing text macros - cppreference.com</a></li><li><a href="https://www.scaler.com/topics/c/macros-in-c/">Macros in C | Types and Examples - Scaler Topics</a></li><li><a href="https://gcc.gnu.org/onlinedocs/gcc-3.2.3/cpp/Macro-Arguments.html">The C Preprocessor</a></li><li><a href="https://learn.microsoft.com/en-us/cpp/preprocessor/hash-undef-directive-c-cpp">#undef directive (C&#x2F;C++) | Microsoft Learn</a></li><li><a href="https://www.programiz.com/c-programming/c-preprocessor-macros">C Preprocessor and Macros</a></li><li><a href="https://en.cppreference.com/w/c/memory/realloc">realloc - cppreference.com</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Programming Language</category>
      
    </categories>
    
    
    <tags>
      
      <tag>C</tag>
      
      <tag>Memory</tag>
      
      <tag>Debug</tag>
      
      <tag>Dynamic Memory Allocation</tag>
      
      <tag>Robustness</tag>
      
      <tag>Testing</tag>
      
      <tag>C Macro</tag>
      
      <tag>C Preprocessor</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Advanced Concatenate with Sqlite3</title>
    <link href="/2022/10/28/concat/"/>
    <url>/2022/10/28/concat/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Advanced-Concatenate-with-Sqlite3"><a href="#Advanced-Concatenate-with-Sqlite3" class="headerlink" title="Advanced Concatenate with Sqlite3"></a>Advanced Concatenate with Sqlite3</h1><p><code>CONCATENATE()</code> is a useful function which can be found in <code>Excel</code>, <code>numpy</code>, etc. It could be simply interpreted as <strong>adding</strong> two or more strings together. The concatenate operator <code>||</code> could be used to add strings in SQL, but only use <code>||</code> can not satisfy us in much complicated context, i.e., string separated across columns. But as a powerful database manage system, Sqlite3 (and probably other DBMS) allows us to do this advanced <code>CONCATENATE</code>, even though there is no keyword or function written as <strong>CONCATENATE</strong> in SQL. </p><h2 id="Quick-Sample"><a href="#Quick-Sample" class="headerlink" title="Quick Sample"></a>Quick Sample</h2><h3 id="Create-Sample-Table"><a href="#Create-Sample-Table" class="headerlink" title="Create Sample Table"></a>Create Sample Table</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> Alphabet (<br>    ID <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>    Letter <span class="hljs-type">CHAR</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span><br>);<br></code></pre></td></tr></table></figure><p>And insert values as follows: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> Alphabet (Letter)<br><span class="hljs-keyword">VALUES</span> <br>    (<span class="hljs-string">&#x27;A&#x27;</span>), (<span class="hljs-string">&#x27;B&#x27;</span>), (<span class="hljs-string">&#x27;C&#x27;</span>), (<span class="hljs-string">&#x27;D&#x27;</span>), (<span class="hljs-string">&#x27;E&#x27;</span>),<br>    (<span class="hljs-string">&#x27;F&#x27;</span>), (<span class="hljs-string">&#x27;G&#x27;</span>), (<span class="hljs-string">&#x27;H&#x27;</span>), (<span class="hljs-string">&#x27;I&#x27;</span>), (<span class="hljs-string">&#x27;J&#x27;</span>);<br></code></pre></td></tr></table></figure><p>So if now we select all entries from <code>Alphabet</code>, </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs SQL">.head <span class="hljs-keyword">on</span><br><br>.mode <span class="hljs-keyword">column</span> <span class="hljs-comment">-- make output more readable</span><br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> Alphabet;<br></code></pre></td></tr></table></figure><p>the output should look like this: </p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs txt">ID  Letter<br>--  ------<br>1   A     <br>2   B     <br>3   C     <br>4   D     <br>5   E     <br>6   F     <br>7   G     <br>8   H     <br>9   I     <br>10  J     <br></code></pre></td></tr></table></figure><h3 id="Requirement"><a href="#Requirement" class="headerlink" title="Requirement"></a>Requirement</h3><p>Print a single string containing all the letters in ascending order, and letters are separated by one comma and one space.   </p><h3 id="Implement"><a href="#Implement" class="headerlink" title="Implement"></a>Implement</h3><p>So by means of <strong>CONCATENATE</strong>, we want to output some stuff like <code>A, B, C, D, E, F, G, H, I, J</code>. Since <code>Letter</code>s are stored in column, it does not work if we only use concatenate operator <code>||</code>. </p><p>The requirement sounds difficult, but if you see codes below, there is nothing too mysterious actually. </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">WITH</span> CTE <span class="hljs-keyword">AS</span> (<br>    <span class="hljs-keyword">SELECT</span><br>        ID,<br>        Letter<br>    <span class="hljs-keyword">FROM</span><br>        Alphabet<br>    <span class="hljs-keyword">WHERE</span><br>        ID <span class="hljs-operator">=</span> <span class="hljs-number">1</span><br>    <br>    <span class="hljs-keyword">UNION</span><br><br>    <span class="hljs-keyword">SELECT</span><br>        Alphabet.ID,<br>        CTE.Letter <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;, &#x27;</span> <span class="hljs-operator">||</span> Alphabet.Letter<br>    <span class="hljs-keyword">FROM</span><br>        Alphabet<br>    <span class="hljs-keyword">JOIN</span><br>        CTE <span class="hljs-keyword">ON</span> Alphabet.ID <span class="hljs-operator">=</span> CTE.ID <span class="hljs-operator">+</span> <span class="hljs-number">1</span><br>)<br><br><span class="hljs-keyword">SELECT</span><br>    Letter<br><span class="hljs-keyword">FROM</span><br>    CTE<br><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span><br>    ID <span class="hljs-keyword">DESC</span><br>LIMIT <span class="hljs-number">1</span>;<br></code></pre></td></tr></table></figure><h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><p>Firstly, we need to create a helper table <code>CTE</code>, which stands for <em>Common Table Expression</em>. The first row of <code>CTE</code> is the first row of <code>Alphabet</code>, this is where our story begins. </p><p>Next step is simple, we just need to add new lines into it, and for each line, itâ€™s <code>Letter</code> is the concat of previous line (in <code>CTE</code>) and previous letter (in <code>Alphabet</code>). </p><p>In <em>line 17</em>, it seems like we <code>JOIN</code> the <code>CTE</code> to itself, and here is explanation. We actually <code>JOIN</code> the newly generated line to the previous line, and you donâ€™t need to worry about <code>ID</code> exceeding boundary. Donâ€™t confuse it with <a href="https://www.sqlitetutorial.net/sqlite-self-join/">Self-Join</a>. It is another topic and out of scope of this blog. </p><p>Note that in <em>line 18</em>, itâ€™s <code>Alphabet.ID = CTE.ID + 1</code>, and this <code>+ 1</code> is very important. Without it, the query goes infinitely, and actually generate something like <code>A, A, A, A, A, A, ...</code> endlessly. </p><p>And we use <code>UNION</code> to combine two selected table. </p><p>So if you check what <code>CTE</code> really generate, execute query: </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs SQL"><span class="hljs-keyword">WITH</span> CTE <span class="hljs-keyword">AS</span> (<br>    ...<br>    <span class="hljs-comment">-- same as above</span><br>)<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> CTE;<br></code></pre></td></tr></table></figure><p>And the output is surprisingly clear. </p><figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs txt">ID  Letter                      <br>--  ----------------------------<br>1   A                           <br>2   A, B                        <br>3   A, B, C                     <br>4   A, B, C, D                  <br>5   A, B, C, D, E               <br>6   A, B, C, D, E, F            <br>7   A, B, C, D, E, F, G         <br>8   A, B, C, D, E, F, G, H      <br>9   A, B, C, D, E, F, G, H, I   <br>10  A, B, C, D, E, F, G, H, I, J<br></code></pre></td></tr></table></figure><p>This output may to large extent help you understand how this query works. </p><p>The final step is just to sort them and output the line we want. </p><h2 id="Remark"><a href="#Remark" class="headerlink" title="Remark"></a>Remark</h2><p>This is just like doing query recursivly, and Sqlite3 started supporting <code>RECURSIVE</code> keyword since version 3.34.0. <a href="https://sqlite.org/lang_with.html">Read more</a>. </p><p>In real implementation, probably there is no consecutive <code>ID</code> and you may think of using a window function <code>ROW_NUMBER()</code> to help you. </p><p>Furthermore, this piece of SQL could be re-used every time you want to concatenate items cross different rows. It can be used as a fixed pattern only with minor modification. </p><h2 id="Much-More-Complicated-Ones"><a href="#Much-More-Complicated-Ones" class="headerlink" title="Much More Complicated Ones"></a>Much More Complicated Ones</h2><p>There are some more complex questions from <a href="https://15445.courses.cs.cmu.edu/">CMU 15-445&#x2F;645 :: Intro to Database Systems</a>. In its homework 1, many questions are quite demanding, and <strong>Q10</strong> is always linked to this blogâ€™s topic. </p><h3 id="2022-Fall-Q10"><a href="#2022-Fall-Q10" class="headerlink" title="2022 Fall Q10"></a>2022 Fall Q10</h3><p><a href="https://15445.courses.cs.cmu.edu/fall2022/homework1/">Homework #1 - SQL</a> <strong>Question 10</strong> with <a href="https://15445.courses.cs.cmu.edu/fall2022/files/hw1-sols.zip">official solution</a>, and my code can be found <a href="https://github.com/LingkKang/CMU15-445_fa22/blob/master/hw1_SQL/q10_house_of_the_dragon.sql">here</a>. </p><h3 id="2021-Fall-Q10"><a href="#2021-Fall-Q10" class="headerlink" title="2021 Fall Q10"></a>2021 Fall Q10</h3><p><a href="https://15445.courses.cs.cmu.edu/fall2021/homework1/">Homework #1 - SQL</a> <strong>Question 10</strong> with <a href="https://15445.courses.cs.cmu.edu/fall2021/files/hw1_sol.zip">official solution</a>, and my code can be found <a href="https://github.com/LingkKang/CMU15-445_fa22/blob/master/history_hw/fa21_hw1_SQL/q10_christmas.sql">here</a>. </p><p>Although added many other requirements and combined with other concepts, the essence never got changed. </p>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SQL</tag>
      
      <tag>SQLite</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>University 100 Miles Relay Competition 2022 Fall</title>
    <link href="/2022/10/24/100miles/"/>
    <url>/2022/10/24/100miles/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="é«˜ç™¾-2022-ç§‹"><a href="#é«˜ç™¾-2022-ç§‹" class="headerlink" title="é«˜ç™¾ 2022 ç§‹"></a>é«˜ç™¾ 2022 ç§‹</h1><h2 id="ä¸€ã€"><a href="#ä¸€ã€" class="headerlink" title="ä¸€ã€"></a>ä¸€ã€</h2><p>æœ€åŽŸæœ¬è¯´å‚åŠ é«˜æ ¡ç™¾è‹±é‡Œæ˜¯å°†è¿‘åŠå¹´å‰äº†ã€‚å½“æ—¶è®²äº†å¾ˆä¹…æœ€ç»ˆå› ä¸ºäººæ•°å·®ä¸€äººæ²¡èƒ½æˆè¡Œï¼ŒåŽé¢çš„è·‘é‡èµ›ä¹Ÿå› ä¸ºæš‘å‡ï¼Œå¤§å®¶éƒ½æ•£å¼€äº†æ²¡äº†ä¸‹æ–‡ã€‚</p><p>æ–°å­¦æœŸæ¥äº†è®¸å¤šå¤§ä¸€çš„åŒå­¦ï¼ŒæŠ¥äº†åä¹‹åŽä¸ä»…äººæ•°åˆ°äº†ï¼Œç”šè‡³åˆšå¥½ä¸‰åäººæ»¡ç¼–ã€‚æ“åœºä¸Šå‰å‰åŽåŽèƒ½çœ‹åˆ°æœ‰è¿™ä¹ˆå¤šäººåœ¨ä¸€èµ·è·‘çœŸæ˜¯è›®è®©äººæ„Ÿæ…¨çš„ï¼Œç”šè‡³æœ‰ä¸€äº›äº›æ„ŸåŠ¨ã€‚</p><h2 id="äºŒã€"><a href="#äºŒã€" class="headerlink" title="äºŒã€"></a>äºŒã€</h2><p>æœ€è¿‘å‡ æ¬¡è·‘æ­¥éƒ½æœ‰ä¸€ç§ä½“éªŒï¼Œä¸€ç§â€œè·Ÿä½â€çš„ä½“éªŒã€‚è®¸å¤šç»å¸¸åœ¨è·‘çš„äººéƒ½ä¼šæœ‰è‡ªå·±è·‘æ­¥çš„èŠ‚å¥ï¼Œè¿™æ ·çš„èŠ‚å¥ç»è¿‡å¤§è·‘é‡çš„æµ‹è¯•ï¼Œä¸€èˆ¬éƒ½å¾ˆé è°±ï¼Œå½“ç„¶ä¹Ÿå¾ˆç§äººåŒ–ã€‚ç„¶åŽåƒæˆ‘è¿™æ ·æ²¡æ€Žä¹ˆè·‘è¿‡ 10 å…¬é‡Œçš„äººï¼Œå¯ä»¥åœ¨åˆ«äººåŽé¢è·Ÿç€è¿™ç§èŠ‚å¥ï¼Œç®—æ˜¯ä¸€ç§æŠ•æœºå–å·§å§ã€‚ä¸åŒçš„äººèŠ‚å¥ä¹Ÿä¸ä¸€æ ·ï¼Œæœ‰çš„äººå¾ˆç¨³é‡ï¼Œæœ‰çš„äººè·Ÿèµ·æ¥åƒæ˜¯åœ¨é£žâ€¦â€¦</p><p>å½“ç„¶å¾ˆéš¾ä¸€ç›´è·Ÿä½ä¸€ä¸ªäººï¼Œè¿™å›žä¹Ÿè¢«å¥—åœˆäº†è®¸å¤šè®¸å¤šæ¬¡ï¼Œä½†ä½“éªŒæ˜¯éžæ¯”å¯»å¸¸çš„ã€‚ä¸åŒäºŽä¸€ä¸ªäººåœ¨æ“åœºæˆ–åœ¨å…¬å›­è·‘ï¼Œè®¸å¤šäººåœ¨è·‘çš„çŽ¯å¢ƒä¹Ÿèƒ½æ¿€å‘èµ·ä¸€äº›äº›èƒœè´Ÿæ¬²ã€‚è¿™æ¬¡çš„æ°›å›´æ›´æ˜¯çƒ­çƒˆè®¸å¤šã€‚å¦‚æ­¤å¤šçš„äººåœ¨ä¸ºæˆ‘ä»¬åŠ æ²¹é¼“æŽŒï¼Œè¿˜æœ‰äººé€’æ°´ã€‚è¿™äº›éƒ½è®©æˆ‘å¾ˆæ„ŸåŠ¨ã€‚è°¢è°¢ä½ ä»¬æ¯ä¸€ä¸ªäººï¼</p><h2 id="ä¸‰ã€"><a href="#ä¸‰ã€" class="headerlink" title="ä¸‰ã€"></a>ä¸‰ã€</h2><p>è¿™æ¬¡ä¹Ÿåˆšå¥½åˆæ˜¯äº”å…¬é‡Œå’Œåå…¬é‡Œéƒ½çªç ´äº† PBã€‚è®¸å¤šäººéƒ½æ˜¯å¦‚æ­¤å§ï¼Œè¿™æ ·çƒ­çƒˆçš„æ°›å›´æœ‰ä¸å°‘åŠ æˆå‘¢ã€‚è·‘çš„æ—¶å€™ä¸€ç›´æƒ³ç€ â€œThe best is always yet to comeâ€ï¼Œâ€œæœ€å¥½çš„æ€»æ˜¯å³å°†åˆ°æ¥â€ã€‚å°½ç®¡äº”å…­å…¬é‡Œæ—¶ä¸»è§‚ä½“æ„Ÿå¾ˆç³Ÿç³•ï¼Œç”šè‡³æœ‰äº›å²”æ°”ï¼Œä½†æœ€ç»ˆç»“æžœè¿˜æ˜¯æ¯”ä¸Šä¸€æ¬¡å¿«äº†ä¸€äº›ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç”Ÿæ´»</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Binary Tree in Python</title>
    <link href="/2022/08/30/Binary-Tree-in-Python/"/>
    <url>/2022/08/30/Binary-Tree-in-Python/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Binary-Tree-in-Python"><a href="#Binary-Tree-in-Python" class="headerlink" title="Binary Tree in Python"></a>Binary Tree in Python</h1><h2 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h2><p>A binary tree might be the simplest tree data structure. It only have three attributes: the value of the node, its left and right child node. If its child node is <code>None</code>, this child node do not have value or child nodes anymore. </p><p>Here is the definition of a typical binary tree from LeetCode: </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, val=<span class="hljs-number">0</span>, left=<span class="hljs-literal">None</span>, right=<span class="hljs-literal">None</span></span>):<br>        self.val = val<br>        self.left = left<br>        self.right = right<br></code></pre></td></tr></table></figure><p>Similar to linked list, binary tree is also a one direction data type. Once moved to its child node, there is no way to trace back, except going through it from the head node again. </p><p>In LeetCode, the <code>input</code> is a list-like binary tree, which is probably difficult to understand at the first glance. For example, inputs wirtten as <code>[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]</code> and <code>[1, 2, 3, 4, 5, null, 7, 8, 9, 10, 11, 12]</code> should be interpretered as image below. </p><p><img src="/../images/binary_tree/bt.png" alt="Image created in XMind"></p><p>It is not extremely significant, however, since we just need to cope with its attributes in our implementation. </p><h2 id="Binary-Tree-Inorder-Traversal"><a href="#Binary-Tree-Inorder-Traversal" class="headerlink" title="Binary Tree Inorder Traversal"></a>Binary Tree Inorder Traversal</h2><p><a href="https://leetcode.com/problems/binary-tree-inorder-traversal/">94. Binary Tree Inorder Traversal (Easy)</a></p><p>This problem is really a great intro to the understandment of binary tree. It require atraversal of given binary tree. </p><p>By inspecting the <code>output</code>, it should be implemented in depth first search (DFS), with left child node searched first. This sounds like nonsense as the <code>input</code> is given layer by layer. But this really confused me at very first. </p><p>Unquestionably, this problem could be solved by recursion. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Recursive Solution</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inorderTraversal</span>(<span class="hljs-params">self, root: <span class="hljs-type">Optional</span>[TreeNode]</span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>]:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">re</span>(<span class="hljs-params">lis, tree</span>):<br>            <span class="hljs-keyword">if</span> tree:<br>                re(lis, tree.left) <span class="hljs-comment"># Go to its left child node</span><br>                lis.append(tree.val)<br>                re(lis, tree.right) <span class="hljs-comment"># Go to its right child node</span><br>            <span class="hljs-keyword">return</span> lis<br>        <span class="hljs-keyword">return</span> re([], root)<br></code></pre></td></tr></table></figure><p>Donâ€™t need to worry about what if itâ€™s <code>left</code> or <code>right</code> attribute is null, it would pass in next function call. </p><!-- Since it could be done by recursion, it could also be done by iteration.  --><h2 id="Some-Similar-Questions"><a href="#Some-Similar-Questions" class="headerlink" title="Some Similar Questions"></a>Some Similar Questions</h2><h3 id="Same-Tree"><a href="#Same-Tree" class="headerlink" title="Same Tree"></a>Same Tree</h3><p>We can apply similar logic to the question <a href="https://leetcode.com/problems/same-tree/">100. Same Tree (Easy)</a>. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">isSameTree</span>(<span class="hljs-params">self, p: <span class="hljs-type">Optional</span>[TreeNode], q: <span class="hljs-type">Optional</span>[TreeNode]</span>) -&gt; <span class="hljs-built_in">bool</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">re</span>(<span class="hljs-params">t1, t2</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> t1 <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> t2:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">elif</span> t1 <span class="hljs-keyword">and</span> t2:<br>                <span class="hljs-keyword">if</span> t1.val != t2.val:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>                <span class="hljs-keyword">if</span> re(t1.left, t2.left):<br>                    <span class="hljs-keyword">return</span> re(t1.right, t2.right)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> re(p, q)<br></code></pre></td></tr></table></figure><h3 id="Symmetric-Tree"><a href="#Symmetric-Tree" class="headerlink" title="Symmetric Tree"></a>Symmetric Tree</h3><p>And the question <a href="https://leetcode.com/problems/symmetric-tree/">101. Symmetric Tree (Easy)</a>. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">isSymmetric</span>(<span class="hljs-params">self, root: <span class="hljs-type">Optional</span>[TreeNode]</span>) -&gt; <span class="hljs-built_in">bool</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">re</span>(<span class="hljs-params">t1, t2</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> t1 <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> t2:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">elif</span> t1 <span class="hljs-keyword">and</span> t2:<br>                <span class="hljs-keyword">if</span> t1.val != t2.val:<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>                <span class="hljs-keyword">if</span> re(t1.left, t2.right):<br>                    <span class="hljs-keyword">return</span> re(t1.right, t2.left)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> re(root.left, root.right)<br></code></pre></td></tr></table></figure><h3 id="Maximum-Depth-of-Binary-Tree"><a href="#Maximum-Depth-of-Binary-Tree" class="headerlink" title="Maximum Depth of Binary Tree"></a>Maximum Depth of Binary Tree</h3><p><a href="https://leetcode.com/problems/maximum-depth-of-binary-tree/">104. Maximum Depth of Binary Tree (Easy)</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">maxDepth</span>(<span class="hljs-params">self, root: <span class="hljs-type">Optional</span>[TreeNode]</span>) -&gt; <span class="hljs-built_in">int</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">re</span>(<span class="hljs-params">t</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> t:<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>            left_depth = re(t.left)<br>            right_depth = re(t.right)<br>            <span class="hljs-keyword">return</span> <span class="hljs-built_in">max</span>(left_depth, right_depth) + <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> re(root)<br></code></pre></td></tr></table></figure><p>Recursion is probably the simplist way to manage a binary tree, and there is no waste on calculating same base cases.</p><h3 id="Balanced-Binary-Tree"><a href="#Balanced-Binary-Tree" class="headerlink" title="Balanced Binary Tree"></a>Balanced Binary Tree</h3><p><a href="https://leetcode.com/problems/balanced-binary-tree/">110. Balanced Binary Tree (Easy)</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">isBalanced</span>(<span class="hljs-params">self, root: <span class="hljs-type">Optional</span>[TreeNode]</span>) -&gt; <span class="hljs-built_in">bool</span>:<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_length</span>(<span class="hljs-params">a</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> a:<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>            left_depth = get_length(a.left)<br>            right_depth = get_length(a.right)<br>            l = <span class="hljs-built_in">max</span>(left_depth, right_depth) + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">return</span> l<br>        <br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">re</span>(<span class="hljs-params">t</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> t:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span><br>            left_len = get_length(t.left)<br>            right_len = get_length(t.right)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">abs</span>(left_len - right_len) &gt; <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">if</span> re(t.left):<br>                <span class="hljs-keyword">return</span> re(t.right)<br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>        <span class="hljs-keyword">return</span> re(root)<br></code></pre></td></tr></table></figure><p>Here, for the first time, comes some waste calculation.</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://leetcode.com/problems/binary-tree-inorder-traversal/">Binary Tree Inorder Traversal - LeetCode</a></li><li><a href="https://leetcode.com/explore/learn/card/data-structure-tree/">Introduction to Data Structure - Binary Tree - LeetCode</a></li><li><a href="http://composingprograms.com/pages/23-sequences.html#trees">Trees - Composing Programs</a></li><li><a href="https://www.cs.cmu.edu/~clo/www/CMU/DataStructures/Lessons/lesson4_1.htm">Tree Data Structure</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Algorithms &amp; Data Structures</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tree</tag>
      
      <tag>Binary Tree</tag>
      
      <tag>Python</tag>
      
      <tag>LeetCode</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Bumi mana yang tak ditimpa hujan</title>
    <link href="/2022/08/25/Hujan/"/>
    <url>/2022/08/25/Hujan/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="æ²¡é•¿è‰çš„åœ°æ–¹å°±æ˜¯è·¯"><a href="#æ²¡é•¿è‰çš„åœ°æ–¹å°±æ˜¯è·¯" class="headerlink" title="æ²¡é•¿è‰çš„åœ°æ–¹å°±æ˜¯è·¯"></a>æ²¡é•¿è‰çš„åœ°æ–¹å°±æ˜¯è·¯</h1><blockquote><p>Laut mana yang tak berombak, bumi mana yang tak ditimpa hujan. </p><p>å¤§æµ·ä½•å¤„ä¸èµ·æµªï¼Œå¤§åœ°ä½•å¤„æœªé­é›¨ã€‚</p></blockquote><p>åˆšæŠŠé»„é”¦æ ‘çš„ã€Šé›¨ã€‹çœ‹å®Œã€‚æ­£å¥½è¿™å‡ å¤©ä¸€ç›´æ—¶é›¨æ—¶åœï¼Œä»¿ä½›åœ¨åº”å’Œä¹¦é‡Œå¤šé›¨çš„çƒ­å¸¦èƒ¶å›­ã€‚</p><p>è¿˜è®°å¾—åˆšå¼€å§‹çœ‹çš„æ—¶å€™ä¹Ÿæ˜¯å¤šé›¨çš„æ—¶èŠ‚ï¼Œåªä¸è¿‡å½“æ—¶é›¨è¶Šä¸‹ï¼Œå¤©è¶Šçƒ­ï¼›çŽ°åœ¨ä¸¤ä¸ªæœˆåŽï¼Œé›¨ä¸‹ç€æ€»èƒ½å‡‰çˆ½ä¸€äº›ã€‚</p><div class="note note-success">            <p>æ–‡ä¸­æ‰€æœ‰å¼•ç”¨å‡æ¥è‡ªé»„é”¦æ ‘çš„ã€Šé›¨ã€‹ï¼Œä¹¦åå·å†…ä¸ºå…·ä½“ç¯‡åã€‚</p>          </div><h2 id="ä¸€ã€"><a href="#ä¸€ã€" class="headerlink" title="ä¸€ã€"></a>ä¸€ã€</h2><blockquote><p>ä½†é‚£äº›æ¢¦å¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œå³ä½¿æ˜¯åœ¨åšæ¢¦çš„äººæ­»åŽã€‚å®ƒä»¬å˜æˆäº†æ‚è‰çš„ç§å­ï¼Œéšé£Žé£˜æ•£ï¼Œå½“ç„¶ä¹Ÿä¸æ›¾è®°å¾—è‡ªå·±æ›¾ç»æ˜¯æ¢¦ï¼Œä¹Ÿå°±è·Ÿä¸€èˆ¬çš„æ‚è‰ç§å­æ²¡ä»€ä¹ˆä¸¤æ ·äº†ã€‚</p><p>é›¨åŽï¼Œå¤§åœ°å¤„å¤„é‡æ–°é•¿èµ·äº†æ‚è‰ã€‚<br>ã€Šæ‹¿ç£å…¬ã€‹</p></blockquote><p>è¿™ä¸€ç¯‡å¤ªæ²‰é‡äº†ã€‚</p><h2 id="äºŒã€"><a href="#äºŒã€" class="headerlink" title="äºŒã€"></a>äºŒã€</h2><blockquote><p>ç¦»ä¹¡å‡ºå›½ä¹‹åŽå°±å†æ²¡å›žåŽ»ï¼Œä¸æ–™è¿™åœ°æ–¹å¥½åƒæ²¡ä»€ä¹ˆå˜ã€‚å¥½åƒè¿™ç©ºé—´æœ‰å®ƒè‡ªå·±ä¸“å±žçš„æ—¶é—´ã€‚</p><p>ã€Šé¾™èˆŸã€‹</p></blockquote><p>å¿½ç„¶å›žæƒ³èµ·ä¸Šæ¬¡è·¯è¿‡æ ¡å›­ã€‚</p><p>é‚£æ¬¡å¸¦ç€åŒå­¦åœ¨å¸‚åŒºæ•£æ­¥è§…é£Ÿï¼Œå¤©è¿˜ä¸å¤ªçƒ­ï¼Œæ…¢æ…¢èµ°å‡ºåŽ»å¾ˆè¿œæ‰å¾®å¾®å‡ºæ±—ã€‚ä¸€è·¯ä¸Šè·¯è¿‡äº†å°å­¦ï¼Œåˆä¸­ã€‚ä»Žå›´å¢™å¤–æœ›è¿›åŽ»ï¼Œæ“åœºã€æ•™å­¦æ¥¼ã€ä½“è‚²é¦†Â·Â·Â·Â·Â·Â·å‡ ä¹Žä¸€åˆ‡éƒ½æ²¡ä»€ä¹ˆå˜åŒ–ï¼Œä¸Žå°è±¡é‡Œä¸åŒçš„å‡ ä¸ªç¯®çƒæž¶å¥½åƒè¿˜æ˜¯åˆšæ¯•ä¸šé‚£å¹´æ‰ç¿»æ–°è¿‡ã€‚</p><blockquote><p>å˜åŒ–ä¹Ÿè®¸ä¸å¯é¿å…åœ°å‘ç”Ÿç€ï¼Œä½†æœ‰ä¸€å µæ— å½¢çš„å¢™è®©å®ƒå˜æ…¢äº†ã€‚</p><p>ã€Šä»¿ä½›ç©¿è¿‡æž—å­ä¾¿æ˜¯æµ·ã€‹</p></blockquote><p>æ—¶éš”ä¹Ÿæ²¡å‡ å¹´å§ï¼Œä½†çœ‹åˆ°æ—¶é—´åœæ»žçš„æ ¡å›­æ€»è¿˜æœ‰äº›æƒŠè®¶ã€‚æ€»ä¼šæƒ³èµ·é‚£ä¸ªæ—¶å€™åœ¨æ ¡é—¨å£æŒ¤ç€ä¹°çƒ¤ä¸²ã€ç”Ÿç…ŽåŒ…ã€‚å°½ç®¡é‚£å®¶åº—é‡Œå¾ˆæ²¹è…»ï¼Œä½†æ¯æ¬¡ä¹Ÿå°±åªåƒå‡ ä¸ªï¼Œæ€»èƒ½åœ¨åƒè…»ä¹‹å‰è¸ç¦»æ‹¥æŒ¤çš„é—¨é¢ã€‚</p><h2 id="ä¸‰ã€"><a href="#ä¸‰ã€" class="headerlink" title="ä¸‰ã€"></a>ä¸‰ã€</h2><p>æŒºå–œæ¬¢ã€Šè€è™Žï¼Œè€è™Žã€‹è¿™ä¸€ç¯‡ã€‚</p><blockquote><p>é›¨å£°å……å¡žäºŽå¤©åœ°ä¹‹é—´ã€‚é›¨ä¸‹æ»¡äº†æ•´ä¸ªå¤œã€‚æ— è¾¹æ— é™…ï¼Œä¹Ÿä»¿ä½›æ— å§‹æ— ç»ˆçš„ã€‚</p><p>ã€Šè€è™Žï¼Œè€è™Žã€‹</p></blockquote><p>è®°å¿†ä¸­ä¼¼ä¹Žä¹Ÿæœ‰é›¶æ˜Ÿå‡ ä¸ªå¤œæ™šï¼Œè¢«å¤§é›¨æ·‹åœ¨çª—æˆ·çš„å˜€å—’å£°åµé†’ã€‚ææƒšä¹‹é—´ä¼¼ä¹Žä¸–ç•Œéƒ½åªå‰©é›¨å£°ï¼Œå¤§å¾—å¥½åƒå¤§ç¦¹æ¥ä¸åŠæ²»æ°´ï¼Œè¯ºäºšæ–¹èˆŸä¹Ÿè¢«å†²åž®ã€‚</p><p>åŽæ¥æ¸æ¸äº«å—èµ·é›¨å£°æ¥ï¼Œæœ‰æ—¶ä¹Ÿä¼šç‰¹åœ°æ‰¾ä¸‹é›¨çš„ç™½å™ªéŸ³ç»™ç”Ÿæ´»ä¼´å¥ã€‚ä¼¼ä¹Žä¸å•å•æ˜¯äº«å—é›¨å£°ï¼Œæ›´æ˜¯äº«å—å¤§é›¨æ—¶èº«æœ‰åº‡æŠ¤çš„æ„Ÿè§‰å§ã€‚</p><p>å¯æ•…äº‹é‡Œå°±æ²¡æœ‰è¿™ä¹ˆèˆ’é€‚äº†ã€‚</p><p>å¤§é›¨æ»‚æ²±ï¼Œè¾›ä¸€å®¶ä¹Ÿæ²¡äº†æ´»å¹²ï¼Œåªèƒ½åœ¨å®¶å¹²ç­‰â€”â€”åŽŸæœ¬çš„æ—©èµ·å‰²èƒ¶æ— æ³•åœ¨å¤§é›¨ä¸­è¿›è¡Œï¼Œå‰²å‡ºçš„èƒ¶è¢«é›¨ç¨€é‡Šå°±å–ä¸å‡ºå¥½ä»·é’±ã€‚</p><p>è¾›å¾ˆå–œæ¬¢è€è™Žï¼Œä½†æ¯äº²å¾ˆæ€•ã€‚</p><p>ä¹Ÿè®¸è€è™Žå°±æ˜¯ç¥–çˆ¶å§ï¼Ÿå½“è¾›é—»è§ç¥–çˆ¶çš„å‘³é“æ—¶ï¼Œçœ¼å‰ä¹Ÿæ€»æœ‰è€è™Žçš„èº«å½±ä»Žé—¨ç¼åˆ’è¿‡ã€‚è¾›å› é—»åˆ°å‘³é“è€Œé—®èµ·æ˜¯å¦æ˜¯ç¥–çˆ¶æ¥äº†æ—¶ï¼Œæ¯äº²æ€»ä¼šè„¸è‰²å‰§å˜ã€‚å¯¹äºŽæ¯äº²æ¥è¯´ï¼Œç¥–çˆ¶ä¸æ˜¯ä»€ä¹ˆç¾Žå¥½çš„å›žå¿†ï¼Œå¥¹å®³æ€•åŽŒæ¶ç¥–çˆ¶å°±åƒå¥¹å®³æ€•åŽŒæ¶è€è™Žã€‚</p><p>ä½†åŽæ¥å¤§é›¨ä¾æ—§ï¼Œè€è™Žæœ€ç»ˆå‡ºçŽ°åœ¨äº†è¾›çš„å®¶é—¨å£ã€‚</p><h2 id="å››ã€"><a href="#å››ã€" class="headerlink" title="å››ã€"></a>å››ã€</h2><p>é‡è¯»äº†ã€Šä»¿ä½›ç©¿è¿‡æž—å­ä¾¿æ˜¯æµ·ã€‹ã€‚æ„Ÿè§‰æœ¦æœ¦èƒ§èƒ§çš„ï¼Œè®¸å¤šä¸ªâ€œå¥¹â€çš„å½±å­å åŠ åœ¨ä¸€èµ·ã€‚æˆ–è®¸ç”Ÿå‘½ä¸­å°è±¡æ·±åˆ»çš„å¹¶ä¸ä¸€å®šæ˜¯ç†ŸçŸ¥çš„äººå§ï¼Œä¹Ÿè®¸æ˜¯æŸä¸ªå¶ç„¶çš„åœºæ™¯ï¼Œä¹Ÿè®¸ä¹Ÿä¼šæœ‰æ¢¦å¢ƒã€‚</p><p>å¥‡æ€ªçš„æ˜¯ï¼Œä¹¦ä¸­å¥³å­©çš„ä»£è¯å¤§éƒ¨åˆ†æ—¶å€™æ˜¯â€œå¥¹â€ï¼Œä½†åˆä¼šæœ‰å¶å°”æ˜¯â€œä¼Šâ€ã€‚ä¼¼ä¹Žæ˜¯åœ¨â€œå¥¹â€å·²ç»å ç”¨åŽï¼Œä¼šç”¨â€œä¼Šâ€æŒ‡ä»£å¦ä¸€ä½å¥³æ€§ï¼Œä½†åˆä¼¼ä¹Žå¹¶ä¸æ˜¯è¿™æ ·ï¼Œæœ‰äº›è®©äººä¸çŸ¥æ‰€æŽªã€‚</p><p>ç©¿è¿‡æž—å­ä¾¿æ˜¯æµ·å—ï¼Ÿ</p><blockquote><p>ä½ è¿˜ä¸æ‡‚å¾—æ—¶é—´çš„å¾®å¦™ã€‚å®ƒä¸æ˜¯åªä¼šæµé€ï¼Œè¿˜ä¼šå›žå·ï¼Œåƒæ¶¨æ½®æ—¶çš„æµªã€‚</p><p>ã€Šä»¿ä½›ç©¿è¿‡æž—å­ä¾¿æ˜¯æµ·ã€‹</p></blockquote><p>ç»ˆäºŽçœ‹åˆ°æµ·äº†ï¼Œä¸ä»…æ˜¯æ¶¨è½çš„æ¶›å£°ã€‚</p><p>ä½†æœ€ç»ˆæ— æ³•è§¦åŠã€‚</p><blockquote><p>æ½®æ°´å·²é€€åˆ°è¿œæ–¹ï¼Œæ·±è‰²çš„ç¤çŸ³è£¸éœ²ï¼Œåƒä¸€ç‰‡å¤©ç„¶çš„åºŸå¢Ÿã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¯»ä¹¦</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linked List with Python Built-in List</title>
    <link href="/2022/08/18/Linked-List-with-Python-Built-in-List/"/>
    <url>/2022/08/18/Linked-List-with-Python-Built-in-List/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Linked-List-with-Python-Built-in-List"><a href="#Linked-List-with-Python-Built-in-List" class="headerlink" title="Linked List with Python Built-in List"></a>Linked List with Python Built-in List</h1><h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><p>I was currently reading the <a href="http://composingprograms.com/">Composing Programs</a>, which amazed me over and over again. </p><p>In section <a href="http://composingprograms.com/pages/23-sequences.html#linked-lists">2.3.7 Linked Lists</a>, a definition of linked list was introduced by using the python built-in type <code>list</code> only. It used <code>empty = &#39;empty&#39;</code> to suggest the end of the linked list, whereas I plan to use <code>NoneType</code> to standardize the code. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">link0 = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, [<span class="hljs-number">3</span>, [<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;empty&#x27;</span>]]]]  <span class="hljs-comment"># Linked list from book</span><br>link1 = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, [<span class="hljs-number">3</span>, [<span class="hljs-number">4</span>, <span class="hljs-literal">None</span>]]]]     <span class="hljs-comment"># Linked list with NoneType</span><br></code></pre></td></tr></table></figure><h2 id="Construct"><a href="#Construct" class="headerlink" title="Construct"></a>Construct</h2><p>Firstly, we need a function to check a given list is a linked list or not: </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_link</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;return True if formal parameter s is a linked list. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> s == <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> (<span class="hljs-built_in">len</span>(s) == <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> is_link(s[<span class="hljs-number">1</span>]))<br></code></pre></td></tr></table></figure><p>And naturally, the function <code>link()</code> can help us wrap up the <code>head</code> and <code>rest</code> two part into a new list whose length is 2. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">link</span>(<span class="hljs-params">head, rest=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">assert</span> is_link(rest), <span class="hljs-string">&quot;The rest part must be a linked list. &quot;</span><br>    <span class="hljs-keyword">return</span> [head, rest]<br></code></pre></td></tr></table></figure><p>Different from the definition I written in <a href="https://lingkkang.github.io/2022/05/16/Linked-List-in-Python/">my previous post</a>, this definition generates a linked list from tail side to head. But nothing changed actually. Letâ€™s take a closer look at it. </p><div class="note note-success">            <p>Notice:</p><p>According to this definition, <code>None</code> is a legal linked list, whereas <code>[None]</code> is illegal. </p><p>This detail could be helpful to the functions coming ahead. </p>          </div><h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>We need some useful functions to manipulate our new data type. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">head</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Get value of current node. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> is_link(s), <span class="hljs-string">&quot;The function must be applied to a linked list. &quot;</span><br>    <span class="hljs-keyword">assert</span> s != <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;No empty linked list. &quot;</span><br>    <span class="hljs-keyword">return</span> s[<span class="hljs-number">0</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">rest</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Move onto next node. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> is_link(s), <span class="hljs-string">&quot;The function must be applied to a linked list. &quot;</span><br>    <span class="hljs-keyword">assert</span> s != <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;No empty linked list. &quot;</span><br>    <span class="hljs-keyword">return</span> s[<span class="hljs-number">1</span>]<br></code></pre></td></tr></table></figure><p>Except these functions unwrapping the linked list, we also need to measure itâ€™s length and evaluate the value of arbitrary node. </p><h3 id="Iterative"><a href="#Iterative" class="headerlink" title="Iterative"></a>Iterative</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">len_link</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Return the length of the linked list. &quot;&quot;&quot;</span><br>    length = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">while</span> s:<br>        s, length = rest(s), length + <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> length<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_item_link</span>(<span class="hljs-params">s, i</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Return the i-th term value of given linked list s. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> i &gt;= <span class="hljs-number">0</span>, <span class="hljs-string">&quot;item&#x27;s index should bigger than or equal to zero. &quot;</span><br>    <span class="hljs-keyword">assert</span> i &lt;= len_link(s)-<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Given index exceeds the length of list. &quot;</span><br>    <span class="hljs-comment"># First item&#x27;s index is zero. </span><br>    <span class="hljs-keyword">while</span> i &gt; <span class="hljs-number">0</span>:<br>        s, i = rest(s), i - <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> head(s)<br></code></pre></td></tr></table></figure><p>Based on these fuctions, we can preliminarily manipulate our linked list. </p><h3 id="Recursive"><a href="#Recursive" class="headerlink" title="Recursive"></a>Recursive</h3><p>We can also rewrite our <code>len_link()</code> and <code>get_item_link()</code> functions in a recursive manner. This concept will emerge again later and is quite significant. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">len_link_recursive</span>(<span class="hljs-params">s</span>): <br>    <span class="hljs-string">&quot;&quot;&quot;Return the length of the linked list. Recursive version. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> s:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> + len_link_recursive(rest(s))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_item_link_recursive</span>(<span class="hljs-params">s, i</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Return the i-th term value of given linked list s. Recursive version. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> i &gt;= <span class="hljs-number">0</span>, <span class="hljs-string">&quot;item&#x27;s index should bigger than or equal to zero. &quot;</span><br>    <span class="hljs-keyword">assert</span> i &lt;= len_link_recursive(s)-<span class="hljs-number">1</span>, <span class="hljs-string">&quot;Given index exceeds the length of list. &quot;</span><br>    <span class="hljs-comment"># First item&#x27;s index is zero. </span><br>    <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>: <br>        <span class="hljs-keyword">return</span> head(s)<br>    <span class="hljs-keyword">return</span> get_item_link_recursive(rest(s), i-<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h2 id="Abstraction"><a href="#Abstraction" class="headerlink" title="Abstraction"></a>Abstraction</h2><h3 id="Append"><a href="#Append" class="headerlink" title="Append"></a>Append</h3><p>Next step, we need to append the linked list. It seems that extending a <em>node-form</em> linked list - by simply altering itâ€™s <code>Next</code> attribute - is handy, while appending the <em>list-form</em> linked list sounds not so intuitive. Well, partially true. </p><p>Here is the function from Composing Programs.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">extend_link</span>(<span class="hljs-params">s, t</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Return a list with the elements of s followed by those of t.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> is_link(s) <span class="hljs-keyword">and</span> is_link(t)<br>    <span class="hljs-keyword">if</span> s == <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> t<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> link(first(s), extend_link(rest(s), t))<br></code></pre></td></tr></table></figure><p>This is a quite standard recursive function.  And here is the function I typed when I was first conceiving it. To make life much easier, I prefer writing them separately.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">append_link</span>(<span class="hljs-params">s, item</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Return a new linked list which was appended with &#x27;item&#x27; from s. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> is_link(s) <span class="hljs-keyword">and</span> is_link(item), <span class="hljs-string">&quot;Input should be linked list. &quot;</span><br>    i = len_link_recursive(s)<br>    <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>:<br>        <span class="hljs-comment"># Special case for empty list</span><br>        <span class="hljs-keyword">return</span> link(item)<br>    <span class="hljs-keyword">elif</span> i == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> link(head(s), item)<br>    <span class="hljs-keyword">else</span>:<br>        lk =  append_link(rest(s), item)<br>    <span class="hljs-keyword">return</span> link(head(s), lk)<br></code></pre></td></tr></table></figure><p>Similarly, we can manage any other function with the concepts of <strong>higher-order function</strong> and <strong>recursion</strong>. </p><p>For example, apply a function to all entries in a linked list. </p><h3 id="Apply-to-all"><a href="#Apply-to-all" class="headerlink" title="Apply to all"></a>Apply to all</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">apply_to_all_link</span>(<span class="hljs-params">f, s</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Apply function f to all elements of s. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> is_link(s), <span class="hljs-string">&quot;Only apply to a linked list. &quot;</span><br>    <span class="hljs-keyword">if</span> s == <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">return</span> s<br>    <span class="hljs-keyword">return</span> link(f(first(s)), apply_to_all_link(f, rest(s)))<br></code></pre></td></tr></table></figure><h2 id="Conversion"><a href="#Conversion" class="headerlink" title="Conversion"></a>Conversion</h2><p>So how to convert a linked list into a normal list? And vice versa? </p><p>Inherited from methods above, answers may not be very complicated. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">link_to_list</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Convert a linked list into a normal list. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">assert</span> is_link(s), <span class="hljs-string">&quot;Should be a linked list. &quot;</span><br>    <span class="hljs-keyword">if</span> rest(s) <span class="hljs-keyword">and</span> s:<br>        <span class="hljs-keyword">return</span> [head(s)] + link_to_list(rest(s))<br>    <span class="hljs-keyword">return</span> [head(s)]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">list_to_link</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Convert a normal list into a linked list. &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s) == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> link(s[<span class="hljs-number">0</span>])<br>    <span class="hljs-keyword">return</span> link(s[<span class="hljs-number">0</span>], list_to_link(s[<span class="hljs-number">1</span>:]))<br></code></pre></td></tr></table></figure><h2 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h2><p>Using python built-in list to form a linked list, this probably is not a vary popular approach, and its efficiency is open to discussion. </p><p>However, what truly intriguing here is that even only one data type can be realized in various way. Also, every function in this post can be achieved in diverse manners. The possibilities in programming are always charming and charismatic. </p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://composingprograms.com/pages/23-sequences.html">Composing Programs</a> by John DeNero;</li><li><a href="https://pythontutor.com/composingprograms.html">Online Python Tutor</a>;</li></ol>]]></content>
    
    
    <categories>
      
      <category>Algorithms &amp; Data Structures</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Linked List</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Prism Plugin ERROR</title>
    <link href="/2022/08/17/Prism-Plugin-ERROR/"/>
    <url>/2022/08/17/Prism-Plugin-ERROR/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Prism-Plugin-ERROR"><a href="#Prism-Plugin-ERROR" class="headerlink" title="Prism Plugin ERROR"></a>Prism Plugin ERROR</h1><p>ä»Šå¤©æŠŠ Hexo ä¸»é¢˜æ¢æˆäº† <a href="https://github.com/fluid-dev/hexo-theme-fluid">fluid</a>ï¼Œæ„Ÿè§‰æŒºä¸é”™ï¼Œä½†æ˜¯åœ¨æ›´æ”¹é…ç½®æ–‡ä»¶åŽå‡ºçŽ°äº†ä¸€äº›å°é—®é¢˜ã€‚</p><h2 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h2><p>æ›´æ¢å¥½ä¸»é¢˜åŽè¿è¡Œ <code>hexo clean</code>ï¼Œhexo ä¼šæŠ¥é”™ï¼Œæ— æ³•åŠ è½½æ’ä»¶ <a href="https://www.npmjs.com/package/hexo-prism-plugin">hexo-prism-plugin</a>ã€‚</p><div class="note note-danger">            <p>INFO  Validating config<br>ERROR Plugin load failed: hexo-prism-plugin</p>          </div><p>è¿™æ˜¯ä¸€ä¸ªä»£ç å—é«˜äº®çš„æ’ä»¶ï¼Œfluid é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>highlightjs</code>, è¿™ä¸ªæ’ä»¶åº”è¯¥æ˜¯åŽŸæ¥ä¸»é¢˜çš„ä¾èµ–ã€‚</p><p>ä½†å¥‡æ€ªçš„æ˜¯ï¼Œå°½ç®¡æ–°ä¸»é¢˜å¹¶ä¸ä¼šç”¨åˆ°è¿™ä¸ªæ’ä»¶ï¼Œhexo ä»ä¼šä¸æ–­æŠ¥é”™ã€‚</p><p>å°è¯•æ›´æ–° hexo å’Œæ’ä»¶æœ¬èº«éƒ½å§‹ç»ˆä¼šæŠ¥é”™ï¼Œå¹¶ä¸”åœ¨è¿è¡Œ <code>hexo g</code> å’Œ <code>hexo s</code> æ—¶å‡ä¼šæŠ¥ <code>ERROR</code>ã€‚åœ¨ <a href="https://hexo.io/docs/troubleshooting">hexo troubleshooting</a> åŠäº’è”ç½‘ä¸Šéƒ½æ— æ³•æ‰¾åˆ°ç±»ä¼¼æƒ…å†µã€‚åœ¨å¦ä¸€ä¸»é¢˜ä¸‹æ‰¾åˆ°<a href="https://github.com/Fechin/hexo-theme-diaspora/issues/35">ç±»ä¼¼æƒ…å†µ</a>ï¼Œä¸‹é¢å›žç­”æ˜¯ hexo çš„é—®é¢˜ã€‚</p><p>è¿è¡Œ <code>npm audix</code>, æ˜¾ç¤ºå…¶ä¸­å°±æœ‰è¯¥æ’ä»¶ï¼Œä¸¥é‡ç¨‹åº¦ä¸º <em>high vulnerability</em>ã€‚</p><h2 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h2><ol><li>å¸è½½æ’ä»¶ï¼Œ<code>npm uninstall hexo-prism-plugin</code>ï¼›</li><li>åœ¨åšå®¢æ–‡ä»¶æ ¹ç›®å½•ä¸‹çš„ <code>package.json</code> ä¸­åˆ é™¤è¯¥æ’ä»¶ä¾èµ–ï¼›</li><li>é‡æ–°ç”Ÿæˆç½‘é¡µï¼Œæ ¹ç›®å½•ä¸­çš„ <code>package-lock.json</code> ä¼šè‡ªåŠ¨ä¿®æ”¹ï¼Œç§»é™¤æ’ä»¶ç›¸å…³å†…å®¹ã€‚</li></ol><p>è‡³æ­¤ï¼ŒæŠ¥é”™æ¶ˆå¤±ã€‚</p><h2 id="å°æ’æ›²"><a href="#å°æ’æ›²" class="headerlink" title="å°æ’æ›²"></a>å°æ’æ›²</h2><p>é¦–å…ˆä½¿ç”¨ç›´æŽ¥ä¸‹è½½çš„ <a href="https://github.com/fluid-dev/hexo-theme-fluid/releases/tag/v1.9.2">fluid ä¸»é¢˜æœ€æ–° release ç‰ˆæœ¬(v1.9.2)</a>ï¼Œå¹¶ä¸”æ›¿æ¢åˆ° <code>themes</code> æ–‡ä»¶å¤¹ï¼Œç½‘é¡µæ•ˆæžœåŸºæœ¬å¤±æ•ˆï¼Œä¸»é¡µæ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚åˆ é™¤å¹¶å°è¯•ä½¿ç”¨<a href="https://hexo.fluid-dev.com/docs/start/#%E6%96%B9%E5%BC%8F%E4%B8%80">ä½œè€…æŽ¨èçš„æ–¹æ³•</a>é€šè¿‡ npm å®‰è£…åŽåˆ™ä¸€åˆ‡æ­£å¸¸ã€‚ä¸çŸ¥é“åˆæ˜¯å“ªé‡Œå¡åˆ° bug äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Front End</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Front-End</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Preliminary Year Summary</title>
    <link href="/2022/05/19/year-1-summary/"/>
    <url>/2022/05/19/year-1-summary/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="å­¦å¹´æ€»ç»“"><a href="#å­¦å¹´æ€»ç»“" class="headerlink" title="å­¦å¹´æ€»ç»“"></a>å­¦å¹´æ€»ç»“</h1><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=3944160&auto=0&height=66"></iframe><blockquote><p>æ¶›å£°éšéšï¼Œé‚£æ—¶ï¼Œç©¿è¿‡æž—å­åº”è¯¥ä¾¿æ˜¯æµ·äº†ã€‚</p><p>é»„é”¦æ ‘ã€Šé›¨ã€‹</p></blockquote><p>æŒ‰å¾€å¸¸æ¥è¯´ï¼Œä¸Šä¸ªæš‘å‡å«â€œé«˜ä¸‰æš‘å‡â€ï¼Œé‚£è¿™ä¸ªæš‘å‡ä¾¿åº”è¯¥æ˜¯â€œå¤§ä¸€æš‘å‡â€â€”â€”ä¹Ÿå°±æ˜¯è¯´å¤§ä¸€è¿˜æ²¡æœ‰ç»“æŸã€‚ä½†åæ­£æ˜¥å­£å­¦æœŸå·²ç»ç»“æŸäº†ï¼Œä¾¿å½“ä½œè¿™ä¸€å­¦å¹´ä¹Ÿå·²ç»ç»“æŸäº†å§ã€‚</p><p>æœ¬æ¥è§‰å¾—æ²¡æœ‰å¤ªå¤šä¸œè¥¿å¯ä»¥å†™ï¼Œç¿»å¼€æ‰‹æœºç›¸å†Œå‘çŽ°ä¹Ÿè®¸èƒ½å†™çš„å¹¶ä¸ç®—å¤ªå°‘ã€‚éšä¾¿å†™ä¸€äº›ã€‚æœ‰è®¸å¤šç…§ç‰‡å·²ç»ä¸è®°å¾—ä¸ºä»€ä¹ˆæ‹ä¸‹äº†ï¼Œè­¬å¦‚è¯´å¥½å‡ ä¸ªå°è›‹ç³•ï¼Œå¤§æ¦‚æ˜¯ä¹°æ¥çŠ’åŠ³è‡ªå·±çš„ï¼Œä½†æ˜¯å› ä¸ºå®Œæˆäº†ä»€ä¹ˆäº‹è€ŒçŠ’åŠ³è‡ªå·±ï¼Œå·²ç»æ²¡å°è±¡äº†ã€‚</p><h2 id="ä¸€ã€"><a href="#ä¸€ã€" class="headerlink" title="ä¸€ã€"></a>ä¸€ã€</h2><p>è®°å¾—åˆšæ¥å­¦æ ¡çš„ç¬¬äºŒå¤©è¿˜æ˜¯ç¬¬ä¸‰å¤©æ™šä¸Šï¼Œåˆšåˆšå®‰é¡¿ä¸‹æ¥ï¼Œå°±åŽ»ç»•ç€å­¦æ ¡é‡Œè·‘äº†ä¸€åœˆã€‚çš„ç¡®æ˜¯æ„Ÿè§‰å­¦æ ¡çœŸçš„å¤ªå°äº†ï¼Œä¸€åœˆæ‰ä¸¤å…¬é‡Œã€‚ä¸è¿‡åŽæ¥ä¹Ÿæ„Ÿæ…¨ï¼Œå¤šäºå­¦æ ¡å°ï¼Œå°±ç®—ä¸Šè¯¾å‰äº”åˆ†é’Ÿæ‰é†’ä¹Ÿèµ¶å¾—ä¸Šæ—©è¯¾ã€‚</p><p><img src="/images/PreYearSum/first_run.jpg" alt="æ ¡å›­è·‘ï¼ˆä¸æ˜¯"> </p><h2 id="äºŒã€"><a href="#äºŒã€" class="headerlink" title="äºŒã€"></a>äºŒã€</h2><p>ç‰¹åˆ«å–œæ¬¢å­¦æ ¡çš„å›¾ä¹¦é¦†ï¼Œæ„Ÿè§‰å¥½åƒå¾ˆä¹…ä¹‹å‰å°±æ¥è¿‡ä¸€æ ·ã€‚</p><p><img src="/images/PreYearSum/lib1.jpg" alt="å›¾ä¹¦é¦†åˆå°è±¡"></p><p>æœ€è¿‘è¿™æ®µæ—¶é—´ç‰¹åˆ«å–œæ¬¢åœ¨å›¾ä¹¦é¦†çš„éœ²å°ä¸Šåç€ã€‚å¤§æ¦‚è¿˜æ˜¯å› ä¸ºè¿™ä¸¤å¤©å¤©æ°”å¥½çš„ç¼˜æ•…å§ã€‚æœ‰å¤ªé˜³åˆä¸å¤ªçƒ­ï¼Œæœ‰é£Žåˆä¸å¤ªå†·ã€‚å°±åç€çœ‹ä¹¦ï¼Œå¸¸å¸¸ååˆ°å¤ªé˜³ä¸‹å±±ã€‚å¿«æŠŠé»„é”¦æ ‘çš„ã€Šé›¨ã€‹ç»™çœ‹å®Œäº†ã€‚</p><p><img src="/images/PreYearSum/lib2.jpg" alt="å›¾ä¹¦é¦†çš„å¥‡å¦™ç»åŽ†"></p><p>ä¸Šå‘¨æœŸæœ«è€ƒè¯•çš„æ—¶å€™ä¸€æ•´å‘¨éƒ½åœ¨ä¸‹é›¨ã€‚ä¸‹é›¨ï¼Œä½†æ˜¯åˆä¸æ€Žä¹ˆä¸‹å¾—çŒ›çƒˆã€‚ä¸œè¥¿éƒ½è¢«é›¨æ²¾å¾—æ½®æ½®çš„ï¼Œæ°´æ±½æŠŠæ‰€æœ‰ä¸œè¥¿ç¬¼ç€ï¼Œè¡£æœå¹²å¾—æ…¢ï¼Œäººä¹Ÿæ€»ä¸èƒ½èˆ’çˆ½ã€‚æˆ‘è€æ˜¯æƒ³ï¼Œæ—¢ç„¶ä¸€ç›´ä¸‹ï¼Œä½•å¦¨ä¸ä¸‹å¾—å¤§ä¸€ç‚¹å‘¢ã€‚</p><blockquote><p>ç¬¬å‡ å¤©äº†ï¼Œå¤œé‡Œä¸‹èµ·å¤§é›¨ã€‚å¥½ä¼¼ä¸€å£ç€‘å¸ƒç›´æ³»åœ¨å±‹é¡¶ä¸Šã€‚ä»–ä»¬å…¨å®¶å°±å®‰ç¡äºŽé‚£è½°ç„¶ä¸€æ°”çš„é›¨å£°ä¸­ï¼Œå¹³æ—¶çš„è™«å£°è›™é¸£å¤§äººçš„é¼¾å£°æ¢¦è¯ç­‰ç­‰éƒ½å¬ä¸åˆ°äº†ã€‚é›¨å£°å……å¡žäºŽå¤©åœ°ä¹‹é—´ã€‚é›¨ä¸‹æ»¡äº†æ•´ä¸ªå¤œã€‚æ— è¾¹æ— é™…ï¼Œä¹Ÿä»¿ä½›æ— å§‹æ— ç»ˆçš„ã€‚</p><p>é»„é”¦æ ‘ã€Šè€è™Žï¼Œè€è™Žã€‹</p></blockquote><h2 id="ä¸‰ã€"><a href="#ä¸‰ã€" class="headerlink" title="ä¸‰ã€"></a>ä¸‰ã€</h2><p>å­¦æ ¡é‡ŒçŒ«çŒ«å¾ˆå¤šï¼Œä½†æ˜¯å’Œæˆ‘æ²¡ä»€ä¹ˆäº¤é›†ã€‚æˆ‘å¾ˆå–œæ¬¢é‚£äº›çŒ«çŒ«ï¼Œä½†æ˜¯å®ƒä»¬å¥½åƒéƒ½ä¸æ€Žä¹ˆå–œæ¬¢æˆ‘ã€‚æ¯æ¬¡è¿˜æ²¡æ¥å¾—åŠæ‹ç…§å°±æºœèµ°äº†ã€‚</p><p><img src="/images/PreYearSum/cat.jpg" alt="çŒ«çŒ«ä¸å›žå¤´"></p><p>ç„¶åŽè¿˜æœ‰å¾ˆå¤šé¸­é¸­ï¼Œä½†æ˜¯éƒ½å¾ˆéœ¸æ°”ï¼Œæˆ‘é è¿‘éƒ½ä¸å¸¦è®©è·¯çš„ã€‚</p><h2 id="å››ã€"><a href="#å››ã€" class="headerlink" title="å››ã€"></a>å››ã€</h2><p>åŽ»å¹´æœŸæœ«çš„æ—¶å€™ç”»äº†æ£µåœ£è¯žæ ‘ã€‚çœŸæ˜¯ç‹¬æ ‘ä¸€å¸œçš„é£Žæ ¼ã€‚æœ€å¼€å§‹çš„æ—¶å€™åœ¨ä¸Šé¢å†™äº† <code>&quot;Merry Christmas&quot;</code>ï¼Œä½†æ˜¯å¾ˆæžç¬‘åœ°æŠŠ<code>Merry</code>æ‹¼é”™äº†ã€‚è¿™æ˜¯ç¬¬äºŒç‰ˆï¼Œå·²ç»å­¦ä¹–äº†ï¼Œå¹²è„†ä¸å†™å­—äº†å“ˆå“ˆå“ˆã€‚</p><p><img src="/images/PreYearSum/Christmas.jpg" alt="Merry Christmas!"></p><h2 id="äº”ã€"><a href="#äº”ã€" class="headerlink" title="äº”ã€"></a>äº”ã€</h2><p><img src="/images/PreYearSum/5ht.jpg" alt="5-HT Week"> </p><p>ä¸Šä¸Šå‘¨å­¦æ ¡æœ‰å‡åŽ‹å‘¨çš„æ´»åŠ¨ï¼Œä½†æ˜¯æˆ‘åŸºæœ¬ä¸Šå•¥éƒ½æ²¡å‚åŠ ï¼Œåªè¹­äº†ä»¶Tæ¤å’Œå’–å•¡åˆ¸â€”â€”å½“æ‡’å’Œç¤¾æåˆåœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œäººæ€»æ˜¯æ— å¯æ•‘è¯çš„ã€‚</p><h2 id="å…­ã€"><a href="#å…­ã€" class="headerlink" title="å…­ã€"></a>å…­ã€</h2><p>ä»Šå¤©æ—©ä¸Šåˆšçœ‹äº†ä¸€éƒ¨ç”µå½±ï¼Œã€Šçž¬æ¯å…¨å®‡å®™ã€‹â€”â€”æˆ–è€…å«ã€Šå¦ˆçš„å¤šé‡å®‡å®™ã€‹å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆã€‚</p><p><img src="/images/PreYearSum/img1.png" alt="æ‘†çƒ‚ç®´è¨€"></p><p align=center>    <code>        â†‘æ˜¯å­¦ä¹ æ—¶çš„æˆ‘ï¼    </code></p><h2 id="ä¸ƒã€"><a href="#ä¸ƒã€" class="headerlink" title="ä¸ƒã€"></a>ä¸ƒã€</h2><p>æ„Ÿè°¢è¿™ä¸€å­¦å¹´é‡åˆ°çš„äººï¼Œniceçš„å®¤å‹ã€è€å¸ˆã€æœ‹å‹ã€åŒå­¦ã€å­¦é•¿å­¦å§Â·Â·Â·Â·Â·Â·</p><h2 id="å…«ã€"><a href="#å…«ã€" class="headerlink" title="å…«ã€"></a>å…«ã€</h2><p>ç„¶åŽæ˜¯ä¸¤å¼ æ— æ„ä¹‰çš„ç…§ç‰‡ã€‚ç»å¸¸å–œæ¬¢ä¸€ä¸ªäººåœ¨æ“åœºä¹±èµ°â€”â€”æˆ–è€…è¯´ï¼Œå«ä½œæ•£æ­¥ã€‚</p><p><img src="/images/PreYearSum/playground.jpg" alt="æ“åœºåœ¨å‘å‘†ï¼Œæ‰€ä»¥å¤±ç„¦äº†ï¼›ä¸è¿‡ä¹Ÿæœ‰å¯èƒ½æ˜¯é•œå¤´åœ¨å‘å‘†"></p><p><img src="/images/PreYearSum/littlebird.jpg" alt="ä¸€åªå°å°å°å°é¸Ÿ"></p><p><img src="/images/PreYearSum/res.jpg" alt="é£Ÿå ‚è’¸æ±½æœ‹å…‹è½¦é—´"></p><p>ä¸å†™å¤ªå¤šäº†ï¼Œæ’å…¥å›¾ç‰‡è¿˜æŒºéº»çƒ¦ï¼Œé¢„è§ˆèµ·æ¥ä¹Ÿä¸å¤ªå¥½çœ‹ï¼Œç­‰æˆ‘æžæ‡‚æ€Žä¹ˆæŽ§åˆ¶å›¾ç‰‡çš„å¤§å°å†è¯´ã€‚</p><p>æœ€åŽæœ‰ä¸€æ®µè¯ï¼Œé€ç»™è‡ªå·±å§ï¼Œè™½ç„¶å·²ç»æŠ„åœ¨ç¬”è®°æœ¬é‡Œå¾ˆä¹…äº†ï¼Œä¹Ÿä¸å¦¨å†ç ä¸€éã€‚</p><blockquote><p>é“ƒæœ¨å›æ˜¯ä¸ªèªæ˜Žäººï¼Œä»–å¾ˆæ¸…æ¥šï¼Œåœ¨è¿™ä¸ªåº”è¯¥å°½é‡é¿å…æ— ç•ä¹‹æŠµæŠ—çš„ä¸–ä¸Šï¼Œæ¯«æ— å¿…è¦çš„è®®è®ºç®€ç›´å°±æ˜¯å°å»ºæ—¶ä»£çš„æµæ¯’ã€‚è¦å®žçŽ°äººç”Ÿçš„ç›®æ ‡ä¸åœ¨äºŽå£èˆŒè€Œåœ¨äºŽèº«ä½“åŠ›è¡Œã€‚å‡¡äº‹åªè¦èƒ½æŒ‰ç…§è‡ªå·±çš„æ„æ„¿ä¸æ–­æŽ¨è¿›ï¼Œäººç”Ÿç›®æ ‡å°±ä¼šè¾¾æˆã€‚æ²¡æœ‰è¾›åŠ³ã€æ‹…å¿ƒã€äº‰è®ºè€Œäº‹æƒ…èƒ½å¤Ÿé¡ºåˆ©è¿›è¡Œï¼Œäººç”Ÿä¾¿å¯ä»¥â€œæžä¹æµâ€çš„æ–¹å¼è€Œè¾¾æˆã€‚</p><p>å¤ç›®æ¼±çŸ³ã€Šæˆ‘æ˜¯çŒ«ã€‹</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>éšç¬”</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¯»ä¹¦</tag>
      
      <tag>ç”Ÿæ´»</tag>
      
      <tag>Summary</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linked List in Python</title>
    <link href="/2022/05/16/Linked-List-in-Python/"/>
    <url>/2022/05/16/Linked-List-in-Python/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="Linked-List-in-Python"><a href="#Linked-List-in-Python" class="headerlink" title="Linked List in Python"></a>Linked List in Python</h1><h2 id="åŽŸé¢˜"><a href="#åŽŸé¢˜" class="headerlink" title="åŽŸé¢˜"></a>åŽŸé¢˜</h2><h3 id="5æœˆ16æ—¥"><a href="#5æœˆ16æ—¥" class="headerlink" title="5æœˆ16æ—¥"></a>5æœˆ16æ—¥</h3><p>è¿™ä¸¤å¤©å†™äº†ä¸¤é“ LeetCode é¢˜ç›®ï¼Œéƒ½æ˜¯å…³äºŽå•å‘é“¾è¡¨(Singly linked list)çš„ï¼Œåˆ†åˆ«æ˜¯ <a href="https://leetcode.com/problems/add-two-numbers/">2. Add Two Numbers (Medium)</a> ä»¥åŠ <a href="https://leetcode.com/problems/merge-two-sorted-lists/">21. Merge Two Sorted Lists (Easy)</a>ã€‚ç”±ç®€åˆ°éš¾ï¼Œå…ˆåšäº†åŽè€…å†åŽ»å°è¯•äº†å‰è€…ã€‚</p><p>éžå¸¸å·§çš„æ˜¯ï¼Œåœ¨åšç¬¬21é¢˜å‰ï¼Œåˆšå¥½äº†è§£åˆ°äº†å½’å¹¶æŽ’åº(Merge sort)ï¼Œå¹¶ä¸”è¯•ç€ç”¨pythonå†™äº†ä¸€ä¸ªå½’å¹¶è„šæœ¬ï¼Œåªä¸è¿‡å½“æ—¶åªç”¨äº† python å†…ç½®çš„æ•°ç»„ã€‚</p><h3 id="5æœˆ27æ—¥æ›´æ–°"><a href="#5æœˆ27æ—¥æ›´æ–°" class="headerlink" title="5æœˆ27æ—¥æ›´æ–°"></a>5æœˆ27æ—¥æ›´æ–°</h3><p>åˆšåˆšå®Œæˆäº† <a href="https://leetcode.com/problems/sort-list/">148. Sort List (Medium)</a>ï¼Œç”¨å•å‘é“¾è¡¨å®žçŽ°æŽ’åºã€‚</p><h2 id="å•å‘é“¾è¡¨ä¸ŽèŠ‚ç‚¹"><a href="#å•å‘é“¾è¡¨ä¸ŽèŠ‚ç‚¹" class="headerlink" title="å•å‘é“¾è¡¨ä¸ŽèŠ‚ç‚¹"></a>å•å‘é“¾è¡¨ä¸ŽèŠ‚ç‚¹</h2><p>å•å‘é“¾è¡¨ï¼Œé¡¾åæ€ä¹‰åªæœ‰ä»Žå‰å¾€åŽçš„å•å‘è¿žæŽ¥ï¼Œåä¹‹åˆ™ä¸è¡Œã€‚ä½¿ç”¨å•å‘åˆ—è¡¨çš„å¥½å¤„åœ¨äºŽï¼Œå½“éœ€è¦åœ¨é“¾è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œåªéœ€è¦éåŽ†é“¾è¡¨æ‰¾åˆ°éœ€è¦æ’å…¥æ•°æ®çš„ä½ç½®ï¼Œå°†å‰ä¸€ä¸ªèŠ‚ç‚¹æ”¹ä¸ºæŒ‡å‘æ–°èŠ‚ç‚¹ï¼Œå¹¶ä¸”è®©æ–°èŠ‚ç‚¹æŒ‡å‘åŽç»§èŠ‚ç‚¹å³å¯ï¼ŒçœåŽ»äº†æ•°ç»„ä¸­å…ƒç´ åŽç§»çš„éº»çƒ¦ã€‚åˆ é™¤åŒç†ã€‚</p><p>åœ¨å®žé™…ä»£ç ä¸­å¾€å¾€ç”¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ¥æŒ‡ä»£æ•´ä¸ªé“¾è¡¨ã€‚</p><p>åœ¨ LeetCode é¢˜ç›®ä¸­ï¼Œå•ä¸ªèŠ‚ç‚¹çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ListNode</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, val=<span class="hljs-number">0</span>, <span class="hljs-built_in">next</span>=<span class="hljs-literal">None</span></span>):<br>        self.val = val<br>        self.<span class="hljs-built_in">next</span> = <span class="hljs-built_in">next</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªèŠ‚ç‚¹åªæœ‰å®ƒæœ¬èº«çš„å€¼(val)ä»¥åŠnextä¸¤ä¸ªå±žæ€§ï¼Œå…¶ä¸­ next ç”¨æ¥æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚é€šè¿‡ <code>list1 = list.next</code> æ¥ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå½“ <code>list1 == None</code> æ—¶ï¼ˆæˆ– <code>list1.next == None</code>ï¼Œå³æ²¡æœ‰åŽç»§èŠ‚ç‚¹ï¼‰ï¼Œé“¾è¡¨ç»“æŸã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹è¿˜ä¼šå®šä¹‰ä¸€ä¸ª <code>LinkedList</code> ç±»ï¼ŒæŠŠæŸ¥æ‰¾ã€æ’å…¥ã€åˆ é™¤ç­‰å‡½æ•°éƒ½æ‰“åŒ…è¿›ç±»é‡Œã€‚LeetCodeè¿™é‡Œå±žäºŽæ˜¯æžç®€é…ç½®äº†ï¼Œä½†ä¸å½±å“æ•°æ®ç»“æž„çš„è®¨è®ºã€‚</p><h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><p>å…ˆçœ‹ç®€å•çš„ç¬¬21é¢˜ã€‚</p><h3 id="ç¬¬21é¢˜-åˆå¹¶æœ‰åºé“¾è¡¨"><a href="#ç¬¬21é¢˜-åˆå¹¶æœ‰åºé“¾è¡¨" class="headerlink" title="ç¬¬21é¢˜ åˆå¹¶æœ‰åºé“¾è¡¨"></a>ç¬¬21é¢˜ åˆå¹¶æœ‰åºé“¾è¡¨</h3><p><a href="https://leetcode.com/problems/merge-two-sorted-lists/">21. Merge Two Sorted Lists</a></p><p>é¢˜ç›®è¦æ±‚å°†ä¸¤ä¸ªç”±å°åˆ°å¤§æŽ’åºçš„å•å‘é“¾è¡¨åˆå¹¶æˆä¸€ä¸ªï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ ListNode å®žä¾‹ã€‚</p><p>å…ˆä¸Šä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mergeTwoLists</span>(<span class="hljs-params">self, list1: <span class="hljs-type">Optional</span>[ListNode], list2: <span class="hljs-type">Optional</span>[ListNode]</span>) -&gt; <span class="hljs-type">Optional</span>[ListNode]:   <br>        <br>        <span class="hljs-comment"># å¦‚æžœæœ‰ç©ºé“¾è¡¨ï¼Œç›´æŽ¥è¿”å›žå¦ä¸€ä¸ªé“¾è¡¨</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> list1:<br>            <span class="hljs-keyword">return</span> list2 <br>        <span class="hljs-keyword">elif</span> <span class="hljs-keyword">not</span> list2:<br>            <span class="hljs-keyword">return</span> list1<br>        <br>        <span class="hljs-comment"># å°†ç¬¬ä¸€ä¸ªå€¼å°çš„åˆå§‹åŒ–ä¸ºè¾“å‡ºé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå€¼</span><br>        <span class="hljs-keyword">if</span> list1.val &lt;= list2.val:<br>            output = list1<br>            list1 = list1.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">else</span>:<br>            output = list2<br>            list2 = list2.<span class="hljs-built_in">next</span><br>        head = output<br><br>        <span class="hljs-keyword">while</span> list1 != <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> list2 != <span class="hljs-literal">None</span>:<br>            <span class="hljs-comment"># å°†è¾ƒå°çš„å€¼èµ‹ç»™currentï¼Œå¹¶å°†é“¾è¡¨ç§»åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br>            <span class="hljs-keyword">if</span> list1.val &lt;= list2.val:<br>                current = list1<br>                list1 = list1.<span class="hljs-built_in">next</span><br>            <span class="hljs-keyword">else</span>:<br>                current = list2<br>                list2 = list2.<span class="hljs-built_in">next</span><br>            output.<span class="hljs-built_in">next</span> = current<br>            output = output.<span class="hljs-built_in">next</span><br><br>        <span class="hljs-comment"># å¦‚æžœæœ‰ä¸€ä¸ªé“¾è¡¨å·²ç»æ²¡æœ‰åŽç»§èŠ‚ç‚¹</span><br>        <span class="hljs-comment"># åˆ™ç›´æŽ¥å°†å¦ä¸€ä¸ªé“¾è¡¨å‰©ä½™èŠ‚ç‚¹åŠ åœ¨è¾“å‡ºé“¾è¡¨æœ«å°¾</span><br>        <span class="hljs-keyword">if</span> list1 != <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">while</span> list1 != <span class="hljs-literal">None</span>:<br>                output.<span class="hljs-built_in">next</span> = list1<br>                list1 = list1.<span class="hljs-built_in">next</span><br>                output = output.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">elif</span> list2 != <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">while</span> list2 != <span class="hljs-literal">None</span>:<br>                output.<span class="hljs-built_in">next</span> = list2<br>                list2 = list2.<span class="hljs-built_in">next</span><br>                output = output.<span class="hljs-built_in">next</span><br><br>        <span class="hljs-keyword">return</span> head <span class="hljs-comment">#ç”¨é“¾è¡¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ¥æŒ‡ä»£é“¾è¡¨ï¼Œåªè¦è¿”å›žç¬¬ä¸€ä¸ªèŠ‚ç‚¹å³å¯</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯å’Œpythonå†…ç½®çš„æ•°ç»„ä¸€æ ·ï¼Œ<code>while list1 != None:</code> å’Œ <code>while list1:</code> æ„ä¹‰ç›¸åŒï¼Œéƒ½è¡¨ç¤ºâ€˜ä¸ä¸ºç©ºæ—¶â€™ã€‚å½“èŠ‚ç‚¹ä¸º <code>None</code> æ—¶ï¼Œé€»è¾‘å€¼ç›¸å½“äºŽ <code>False</code>ã€‚</p><p>è¿™ä¸ªè§£æ³•çœ‹èµ·æ¥ç•¥æ˜¾ç¹çï¼Œä½†æ˜¯è¿è¡Œæ—¶é—´å’Œå ç”¨å†…å­˜éƒ½å¹¶ä¸å¤§ï¼Œä¹Ÿå¾ˆå®¹æ˜“ç†è§£ã€‚</p><h3 id="ç¬¬2é¢˜-åå‘æ±‚å’Œ"><a href="#ç¬¬2é¢˜-åå‘æ±‚å’Œ" class="headerlink" title="ç¬¬2é¢˜ åå‘æ±‚å’Œ"></a>ç¬¬2é¢˜ åå‘æ±‚å’Œ</h3><p><a href="https://leetcode.com/problems/add-two-numbers/">2. Add Two Numbers (Medium)</a></p><p>è¿™é“é¢˜ç›®æœ¬èº«è¿˜æŒºæžçš„ï¼ŒæŠŠä¸¤ä¸ªéœ€è¦ç›¸åŠ çš„æ•°å€’äº†è¿‡æ¥ï¼Œæ¯ä¸ªæ•°ä½éƒ½æ”¾åœ¨é“¾è¡¨çš„èŠ‚ç‚¹ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://assets.leetcode.com/uploads/2020/10/02/addtwonumber1.jpg" alt="342 + 465 = 807" title="AddTwoNumbers"></p><p>è¿™é‡Œæ³¨æ„åˆ°çš„æ˜¯æ•°å­—é«˜ä½å’Œä½Žä½é¢ å€’äº†è¿‡æ¥ï¼Œå› æ­¤ç›¸åŠ æ—¶æ–°çš„æ•°ä½äº§ç”Ÿåœ¨æœ€å³ä¾§ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">addTwoNumbers</span>(<span class="hljs-params">self, l1: <span class="hljs-type">Optional</span>[ListNode], l2: <span class="hljs-type">Optional</span>[ListNode]</span>) -&gt; <span class="hljs-type">Optional</span>[ListNode]:<br>        output = ListNode()<br>        header = output<br>        upper = <span class="hljs-number">0</span> <span class="hljs-comment"># è¡¨ç¤ºè¿›ä½</span><br>        <span class="hljs-keyword">while</span> l1 != <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">if</span> l2 != <span class="hljs-literal">None</span>:<br>                ans = l1.val + l2.val + upper<br>                upper = <span class="hljs-number">0</span><br>                <span class="hljs-keyword">if</span> ans &gt; <span class="hljs-number">9</span>:<br>                    output.val = ans - <span class="hljs-number">10</span><br>                    upper = <span class="hljs-number">1</span><br>                <span class="hljs-keyword">else</span>:<br>                    output.val = ans<br>                l2 = l2.<span class="hljs-built_in">next</span><br>            <span class="hljs-keyword">else</span>:<br>                ans = l1.val + upper<br>                upper = <span class="hljs-number">0</span><br>                <span class="hljs-keyword">if</span> ans &gt; <span class="hljs-number">9</span>:<br>                    output.val = ans - <span class="hljs-number">10</span><br>                    upper = <span class="hljs-number">1</span><br>                <span class="hljs-keyword">else</span>:<br>                    output.val = ans<br>            <br>            <span class="hljs-comment"># å½“è¾¾åˆ°é“¾è¡¨æœ«å°¾æ—¶ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦è¦ç•™å‡ºä¸€ä½æ¥å­˜æ”¾è¿›ä½</span><br>            <span class="hljs-comment"># ç¬¬40è¡ŒåŒç†</span><br>            <span class="hljs-keyword">if</span> l1.<span class="hljs-built_in">next</span> != <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> upper == <span class="hljs-number">1</span> <span class="hljs-keyword">or</span> l2 != <span class="hljs-literal">None</span>:<br>                output.<span class="hljs-built_in">next</span> = ListNode()<br>            output = output.<span class="hljs-built_in">next</span><br>            l1 = l1.<span class="hljs-built_in">next</span><br>            <br>        <span class="hljs-keyword">while</span> l2 != <span class="hljs-literal">None</span>:<br>            ans = l2.val + upper<br>            upper = <span class="hljs-number">0</span><br>            <span class="hljs-keyword">if</span> ans &gt; <span class="hljs-number">9</span>:<br>                output.val = ans - <span class="hljs-number">10</span><br>                upper = <span class="hljs-number">1</span><br>            <span class="hljs-keyword">else</span>: <br>                output.val = ans<br>            <span class="hljs-keyword">if</span> l2.<span class="hljs-built_in">next</span> != <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> upper == <span class="hljs-number">1</span>:<br>                output.<span class="hljs-built_in">next</span> = ListNode()<br>            output = output.<span class="hljs-built_in">next</span><br>            l2 = l2.<span class="hljs-built_in">next</span><br>            <br>        <span class="hljs-keyword">if</span> upper == <span class="hljs-number">1</span>:<br>            output.val = <span class="hljs-number">1</span><br>        <br>        <span class="hljs-keyword">return</span> header<br></code></pre></td></tr></table></figure><p>æ€è·¯å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œå–å‡ºä¸€ä¸ªæ•°åŽç§»åŠ¨èŠ‚ç‚¹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é€¢åè¿›ä¸€ã€‚<em>æ­¤å¤„è¿˜æœ‰ä¼˜åŒ–ç©ºé—´ã€‚</em></p><p>ä½†æ˜¯è¿™æ¬¡ä¸åŒçš„æ˜¯æˆ‘é€‰æ‹©æ–°åˆ›å»ºäº†ä¸€ä¸ªèŠ‚ç‚¹å®žä¾‹æ¥è¡¨ç¤ºè¾“å‡ºé“¾è¡¨(<code>output = ListNode()</code>)ï¼Œå®žé™…ä¸Šå’Œä½¿ç”¨å·²æœ‰é“¾è¡¨æ¥åˆå§‹åŒ–ä½œç”¨ç›¸åŒã€‚</p><h3 id="ç¬¬148é¢˜-é“¾è¡¨æŽ’åº"><a href="#ç¬¬148é¢˜-é“¾è¡¨æŽ’åº" class="headerlink" title="ç¬¬148é¢˜ é“¾è¡¨æŽ’åº"></a>ç¬¬148é¢˜ é“¾è¡¨æŽ’åº</h3><p><a href="https://leetcode.com/problems/sort-list/">148. Sort List (Medium)</a></p><p>é¢˜ç›®è¦æ±‚å¾ˆç®€å•ï¼Œå°†è¾“å…¥é“¾è¡¨æŽ’åºåŽè¾“å‡ºã€‚</p><h4 id="å†’æ³¡"><a href="#å†’æ³¡" class="headerlink" title="å†’æ³¡"></a>å†’æ³¡</h4><p>å¾ˆæ˜¾ç„¶ï¼Œæœ€å®¹æ˜“æƒ³åˆ°å’Œä»£ç å®žçŽ°çš„æŽ’åºæ–¹æ³•å°±æ˜¯å†’æ³¡æŽ’åºã€‚ä»¥ä¸‹æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å°è¯•æ—¶å†™çš„ä»£ç ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sortList</span>(<span class="hljs-params">self, head: <span class="hljs-type">Optional</span>[ListNode]</span>) -&gt; <span class="hljs-type">Optional</span>[ListNode]:<br>        <span class="hljs-comment"># bubble sort</span><br>        current = head<br>        exchange = <span class="hljs-literal">True</span><br>        <span class="hljs-keyword">while</span> exchange:<br>            exchange = <span class="hljs-literal">False</span><br>            <span class="hljs-keyword">while</span> current <span class="hljs-keyword">and</span> current.<span class="hljs-built_in">next</span>:<br>                <span class="hljs-keyword">if</span> current.val &gt; current.<span class="hljs-built_in">next</span>.val:<br>                    mid = current.val<br>                    current.val = current.<span class="hljs-built_in">next</span>.val<br>                    current.<span class="hljs-built_in">next</span>.val = mid<br>                    exchange = <span class="hljs-literal">True</span><br>                current = current.<span class="hljs-built_in">next</span><br>            current = head<br>        <span class="hljs-keyword">return</span> head<br></code></pre></td></tr></table></figure><p>ä½†éžå¸¸å¯æƒœçš„æ˜¯ï¼Œå½“æµ‹è¯•ç”¨ä¾‹æžå¤§æ—¶ï¼Œä½¿ç”¨å†’æ³¡æŽ’åºä¼šè¶…æ—¶ã€‚</p><blockquote><p>Time Limit Exceeded </p></blockquote><h4 id="å½’å¹¶"><a href="#å½’å¹¶" class="headerlink" title="å½’å¹¶"></a>å½’å¹¶</h4><p>æ„å¤–å‘çŽ°ç”¨å•å‘é“¾è¡¨å®žçŽ°å½’å¹¶æŽ’åºä¼šæ¯”ç”¨ <code>list</code> æ–¹ä¾¿å¾ˆå¤šï¼Œå°¤å…¶æ˜¯å½’å¹¶è¿™ä¸€æ­¥ï¼Œä½†æ˜¯ä¸å¤ªå®¹æ˜“æƒ³åˆ°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Solution</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">sortList</span>(<span class="hljs-params">self, head: <span class="hljs-type">Optional</span>[ListNode]</span>) -&gt; <span class="hljs-type">Optional</span>[ListNode]:<br>        <span class="hljs-comment"># merge sort</span><br>        <span class="hljs-keyword">if</span> head <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> head.<span class="hljs-built_in">next</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span> head<br>        left = head<br>        right = self.get_mid(head)<br>        transection = right.<span class="hljs-built_in">next</span><br>        right.<span class="hljs-built_in">next</span> = <span class="hljs-literal">None</span><br>        left = self.sortList(left)<br>        right = self.sortList(transection)<br>        merge = self.merge(left, right)<br>        <span class="hljs-keyword">return</span> merge<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">merge</span>(<span class="hljs-params">self, LN1, LN2</span>):<br>        tail = ListNode()<br>        out = tail<br>        <span class="hljs-keyword">while</span> LN1 <span class="hljs-keyword">and</span> LN2:<br>            <span class="hljs-keyword">if</span> LN1.val &lt; LN2.val:<br>                tail.<span class="hljs-built_in">next</span> = LN1<br>                LN1 = LN1.<span class="hljs-built_in">next</span><br>            <span class="hljs-keyword">else</span>:<br>                tail.<span class="hljs-built_in">next</span> = LN2<br>                LN2 = LN2.<span class="hljs-built_in">next</span><br>            tail = tail.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">if</span> LN1:<br>            tail.<span class="hljs-built_in">next</span> = LN1<br>        <span class="hljs-keyword">elif</span> LN2:<br>            tail.<span class="hljs-built_in">next</span> = LN2<br>        out = out.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">return</span> out<br>            <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_mid</span>(<span class="hljs-params">self, head</span>):<br>        a = head<br>        b = head.<span class="hljs-built_in">next</span><br>        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>            <span class="hljs-keyword">if</span> b <span class="hljs-keyword">and</span> b.<span class="hljs-built_in">next</span>:<br>                a = a.<span class="hljs-built_in">next</span><br>                b = b.<span class="hljs-built_in">next</span>.<span class="hljs-built_in">next</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">return</span> a<br></code></pre></td></tr></table></figure><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><p>åœ¨æ•´ä¸ªç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œæœ€éœ€è¦æ³¨æ„çš„è¿˜æ˜¯é“¾è¡¨çš„æœ«å°¾ã€‚ä¸€ä¸å°å¿ƒç»å¸¸å®¹æ˜“å‡ºçŽ°èµ‹å€¼ç»™ <code>None</code> æˆ–è€…å–å€¼ <code>None.next</code> çš„æŠ¥é”™ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Algorithms &amp; Data Structures</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>LeetCode</tag>
      
      <tag>Linked List</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Test Article</title>
    <link href="/2022/05/15/test-article/"/>
    <url>/2022/05/15/test-article/</url>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><h1 id="A-Simple-test"><a href="#A-Simple-test" class="headerlink" title="A Simple test"></a>A Simple test</h1><p>This is a simple test.<br>Pages hoseted on GitHub.<br>Build in Hexo with theme fluid. </p>]]></content>
    
    
    <categories>
      
      <category>Front End</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Hexo</tag>
      
      <tag>Front-End</tag>
      
      <tag>Markdown</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
